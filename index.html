<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Onyx Programming Language Quick Reference</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Onyx Programming Language Quick Reference</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_todo">1. TODO:</a></li>
<li><a href="#_document">2. Document</a></li>
<li><a href="#_philosophy">3. Philosophy</a></li>
<li><a href="#_design_goals">4. Design goals</a></li>
<li><a href="#_notation">5. Notation</a></li>
<li><a href="#_comments">6. Comments</a>
<ul class="sectlevel2">
<li><a href="#_comment_intrinsics">6.1. Comment intrinsics</a>
<ul class="sectlevel3">
<li><a href="#_ditto">6.1.1. <code>:ditto:</code></a></li>
<li><a href="#_super">6.1.2. <code>:super:</code></a></li>
<li><a href="#_nodoc">6.1.3. <code>:nodoc:</code></a></li>
<li><a href="#_patt">6.1.4. <code>:patt:</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_entities">7. Entities</a>
<ul class="sectlevel2">
<li><a href="#_decl">7.1. <code>decl</code></a></li>
<li><a href="#_impl">7.2. <code>impl</code></a></li>
<li><a href="#_def">7.3. <code>def</code></a></li>
<li><a href="#_moveimpl">7.4. <code>moveimpl</code></a></li>
<li><a href="#_reimpl">7.5. <code>reimpl</code></a></li>
<li><a href="#_undecl">7.6. <code>undecl</code></a></li>
<li><a href="#_alias">7.7. <code>alias</code></a></li>
<li><a href="#_visibility_modifiers">7.8. Visibility modifiers</a></li>
</ul>
</li>
<li><a href="#_directives">8. Directives</a>
<ul class="sectlevel2">
<li><a href="#_require">8.1. <code>require</code></a></li>
<li><a href="#_import">8.2. <code>import</code></a></li>
<li><a href="#_using">8.3. <code>using</code></a></li>
</ul>
</li>
<li><a href="#_interoperability">9. Interoperability</a>
<ul class="sectlevel2">
<li><a href="#_c_data_types">9.1. C data types</a></li>
<li><a href="#_c_variables">9.2. C variables</a></li>
<li><a href="#_c_macros">9.3. C macros</a></li>
<li><a href="#_external_declarations">9.4. External declarations</a></li>
</ul>
</li>
<li><a href="#_literals">10. Literals</a>
<ul class="sectlevel2">
<li><a href="#_literal_constrainment">10.1. Literal constrainment</a></li>
<li><a href="#_range_literals">10.2. Range literals</a></li>
</ul>
</li>
<li><a href="#_values">11. Values</a>
<ul class="sectlevel2">
<li><a href="#_assigning_values">11.1. Assigning values</a></li>
<li><a href="#_moving_values">11.2. Moving values</a></li>
<li><a href="#_pushing_values">11.3. Pushing values</a></li>
<li><a href="#_swapping_values">11.4. Swapping values</a></li>
</ul>
</li>
<li><a href="#_indirect_values">12. Indirect values</a>
<ul class="sectlevel2">
<li><a href="#_references">12.1. References</a></li>
<li><a href="#_pointers">12.2. Pointers</a></li>
<li><a href="#_accessibility">12.3. Accessibility</a></li>
<li><a href="#_spaces">12.4. Spaces</a></li>
</ul>
</li>
<li><a href="#_scopes">13. Scopes</a>
<ul class="sectlevel2">
<li><a href="#_scope_casting">13.1. Scope casting</a></li>
<li><a href="#_indirect_value_argument_autocasting">13.2. Indirect value argument autocasting</a></li>
<li><a href="#_returned_indirect_value_scope_autocasting">13.3. Returned indirect value scope autocasting</a></li>
<li><a href="#_temporal_scope">13.4. Temporal scope</a></li>
<li><a href="#_local_scope">13.5. Local scope</a></li>
<li><a href="#_caller_scope">13.6. Caller scope</a></li>
<li><a href="#_instance_scope">13.7. Instance scope</a></li>
<li><a href="#_static_scope">13.8. Static scope</a></li>
<li><a href="#_undefined_scope">13.9. Undefined scope</a></li>
</ul>
</li>
<li><a href="#_functions">14. Functions</a>
<ul class="sectlevel2">
<li><a href="#_function_declarations">14.1. Function declarations</a></li>
<li><a href="#_methods_new">14.2. Methods new</a></li>
<li><a href="#_methods">14.3. Methods</a></li>
</ul>
</li>
<li><a href="#_arguments">15. Arguments</a></li>
<li><a href="#_types">16. Types</a>
<ul class="sectlevel2">
<li><a href="#_type_instances">16.1. Type instances</a></li>
<li><a href="#_literal_instances">16.2. Literal instances</a></li>
<li><a href="#_generic_types">16.3. Generic types</a></li>
<li><a href="#_type_specialization">16.4. Type specialization</a></li>
<li><a href="#_members">16.5. Members</a></li>
<li><a href="#_behavioural_erasure">16.6. Behavioural erasure</a></li>
<li><a href="#_type_expressions">16.7. Type expressions</a></li>
<li><a href="#_type_restriction">16.8. Type restriction</a></li>
<li><a href="#_fuzzy_type_restriction">16.9. Fuzzy type restriction</a></li>
</ul>
</li>
<li><a href="#_namespaces">17. Namespaces</a></li>
<li><a href="#_data_types">18. Data types</a>
<ul class="sectlevel2">
<li><a href="#_structs">18.1. Structs</a></li>
<li><a href="#_classes">18.2. Classes</a></li>
<li><a href="#_enums">18.3. Enums</a></li>
</ul>
</li>
<li><a href="#_built_in_types">19. Built-in types</a>
<ul class="sectlevel2">
<li><a href="#_variants">19.1. Variants</a></li>
</ul>
</li>
<li><a href="#_lifetime">20. Lifetime</a></li>
<li><a href="#_piping">21. Piping</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_todo"><a class="link" href="#_todo">1. TODO:</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Static means outside of call stack, but not necessarily program-wide.</p>
</div>
<div class="paragraph">
<p>Think about having <code>caller</code> (<code>c</code>) and <code>stack</code> (<code>k</code>) scopes separately; returning <code>c</code> casts to local, returning <code>k</code> casts to <code>k</code>?</p>
</div>
<div class="paragraph">
<p>Think on passing scoped variables to lambda, i.e. closure.
Done: it may only accept static or undefined pointers.</p>
</div>
<div class="paragraph">
<p>Variants and atomics have their own semantics on assigning.</p>
</div>
<div class="paragraph">
<p>Only classes may have traits.
It allows to have <code>mut</code> for trait methods.</p>
</div>
<div class="paragraph">
<p>Remove units, because it&#8217;s not defined on where to store them, in which address space.</p>
</div>
<div class="paragraph">
<p><code>is?</code> and <code>of?</code> affect compilation, they are called on a <strong>real</strong> type instead of imaginary.
All other methods are called on imaginary.
But <code>as</code> is called on imaginary?
No, on real as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">final var = Std@rand(42, 0.5) : Variant&lt;SBin32, FBin64&gt;
var.abs()
# var~Numeric.abs()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Real type is constant, while imaginary type can change during runtime.</p>
</div>
<div class="paragraph">
<p>Restricting on a real type makes the imaginary type equal to the real type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">trait Drawable2D { decl draw() }
trait Drawable3D { decl draw() }

class Point
  derive Drawable2D
    impl ~draw as draw2d;
  end

  derive Drawable3D
    impl ~draw as draw3d;
  end
end

# Changing `Drawable2D` to `Drawable3D` here
# shall not change the branch contents.
def foo(x : Drawable2D)
  @typeof(x)  # =&gt; Undef~Drawable2D
  \@typeof(x) # =&gt; Point~Drawable2D

  x.draw() == x~Drawable2D.draw()

  # NOTE:
  if \@typeof(x)[0] == Point
    @typeof(x) # =&gt; Undef~Drawable2D

  # BUT: (`is?` is SpEcIaL)
  if x is? Point
    @typeof(x) # =&gt; Point~Point
    x.point()
    # x.draw()
    x~Drawable2D.draw()
    x.draw2d()
    x.draw3d()
    x~Drawable3D.draw()
  end
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Returned type may have <code>Auto</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_document"><a class="link" href="#_document">2. Document</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>It contains explainations and rationale, which are rare in the Standard.
It also "speaks" with a reader (e.g. "you", "we").</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_philosophy"><a class="link" href="#_philosophy">3. Philosophy</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Target agnosticism.
No assumptions are made about target in the language.
All that&#8217;s known is that there is processing unit, registers and instructions.</p>
</div>
<div class="paragraph">
<p>Onyx defines concept of function, abstract data structures (Array, Tuple, namespaces, trait, union, struct, class, enum, Variant, Union, Lambda, Function, Type, Block, Literal, Reference, Pointer), storages (local, caller, instance, static, undefined), lifetime, common math types.</p>
</div>
<div class="paragraph">
<p>TODO: Only functions may be exported.
Structs, enums, typedefs are externed instead.</p>
</div>
<div class="paragraph">
<p>A target may be binary, decimal or even quantum; to contain ALU and FPU or not.
It is possible to query if target implements any type natively.
A entity is a blackbox until observed.
Interchange formats are defined: <code>SBin8</code> is not necessarily stored in 8 bits, but <code>.bits</code> method returns <code>Bit[8]</code>, formatted in special way.</p>
</div>
<div class="paragraph">
<p><code>Pointer</code> is just a pointer to data.
It may be a pointer to memory, or register.
Size of a <code>Pointer</code> is undefined.
But <code>Pointer</code> has <code>to($int*)</code> methods defined, which allocate memory on stack.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_goals"><a class="link" href="#_design_goals">4. Design goals</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stay low-level, but give tools for powerful abstractions.
For example, C pointer is target-dependent; what we known of Onyx pointer is storage.
We call <code>ptr.to($int*)</code>, and target may allocate it on stack.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notation"><a class="link" href="#_notation">5. Notation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Keywords are written like this: <code>\$bb"let"\$</code>.
Example identifiers are written like this: <code>\$"foo"\$</code>.
For example, <code>\$bb"let"\$ \$"foo"\$ = \$"bar"\$()</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments"><a class="link" href="#_comments">6. Comments</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A comment begins with <code>#</code> and spans until the end of the line.</p>
</div>
<div class="paragraph">
<p>A comment adjacent to a member declaration or implementation statement is called <em>documentation</em>.</p>
</div>
<div class="paragraph">
<p>The Standard contains an informative appendix for comment styling.</p>
</div>
<div class="paragraph">
<p>An implementation is required to provide a command to generate API documentation data, e.g. <code>nxc api -fjson -o main.json main.nx</code>.
Only documentation comments are included in the generated API data.
The API data format is a normative part of the Standard, and provides specifications for C header (see <a href="#_interoperability">Section 9, &#8220;Interoperability&#8221;</a>), JSON, YAML, XML, MessagePack and NXAPI binary transfer formats.</p>
</div>
<div class="sect2">
<h3 id="_comment_intrinsics"><a class="link" href="#_comment_intrinsics">6.1. Comment intrinsics</a></h3>
<div class="paragraph">
<p>The Standard contains an informative list of <em>comment intrinsics</em> for special treatment.</p>
</div>
<div class="paragraph">
<p>A comment intrinsic syntax is <code>:\$"intrinsic"\$(\$"args"\$):</code>, whereas the argument part may be omitted if having zero arity.</p>
</div>
<div class="paragraph">
<p>A comment intrinsic does not expand during API data generation, e.g. <code>:ditto:</code> is preserved as-is.
It is an API data consumer (expected) responsibility to consume and handle intrinsics properly.
A non-standardized intrinsic is thus not a error, e.g. <code>:unknown:</code> is legal during API data generation.
A misused intrinsic, e.g. a missing <code>:fmt:</code> pattern reference is also not a error during API data generation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The intrinsics ignorance behaviour is dictated by the fact that comments are not a part of the resulting program.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Below goes the list of standardized comment intrinsics.</p>
</div>
<div class="sect3">
<h4 id="_ditto"><a class="link" href="#_ditto">6.1.1. <code>:ditto:</code></a></h4>
<div class="paragraph">
<p>A <code>:ditto:</code> comment intrinsic copies documentation from the previous member in current file.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># This is doc.
let x = 42

# This is a comment.
#

# :ditto:
let y = 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># This is doc.
let x = 42

# This is doc.
let y = 42</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_super"><a class="link" href="#_super">6.1.2. <code>:super:</code></a></h4>
<div class="paragraph">
<p>A <code>:super:</code> comment intrinsic copies comment from the super declaration, applicable to overwrites, inherited functions etc.</p>
</div>
<div class="paragraph">
<p>Without <code>:super:</code>, a documentation comment fully replaces previous documentation.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo
  # A doc.
  def a;

  # B doc.
  def b;
end

struct Bar
  extend Foo
    # C doc.
    reimpl a;

    # :super:
    # D doc.
    reimpl b;
  end
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Bar
  # C doc.
  def a;

  # B doc.
  # D doc.
  def b;
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nodoc"><a class="link" href="#_nodoc">6.1.3. <code>:nodoc:</code></a></h4>
<div class="paragraph">
<p>A <code>:nodoc:</code> comment intrinsic disables documentation for the currently documented member until a matching <code>:doc:</code> intrinsic is met.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># :nodoc:
# Is useless in non-doc comments.
#

# This is doc.
# :nodoc: This would not be included.
# :doc: And this would.
# :nodoc: This would not again.
let x = 42

# Note that previous nodoc does not matter here.
let y = 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># This is doc.
# And this would.
let x = 42

# Note that previous nodoc does not matter here.
let y = 42</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_patt"><a class="link" href="#_patt">6.1.4. <code>:patt:</code></a></h4>
<div class="paragraph">
<p><code>:patt(\$"name"\$, \$"args"\$):</code>, <code>:endpatt(\$"name"\$):</code> and <code>:fmt(\$"name"\$, \$"args"\$):</code> comment intrinsics are used for comment patterns.</p>
</div>
<div class="paragraph">
<p>Within a pattern, the <code>%{\$"var"\$}</code> syntax is used to insert a variable.</p>
</div>
<div class="paragraph">
<p>For \$"name"\$ and \$"args"\$, double or single quotes are optional, but required if the text contains possibly misinterpred symbols, i.e. <code>)</code>, <code>:</code>, <code>,</code>.</p>
</div>
<div class="paragraph">
<p>Patterns are local to the file.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># :patt("trg-dep", entity, default):
# %{entity} is target-dependent, defaults to %{default}.
# :endpatt:

# :fmt("trg-dep", 'Alignment', 8):
let x = 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># Alignment is target-dependent, defaults to 8.
let x = 42</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_entities"><a class="link" href="#_entities">7. Entities</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Onyx, a entity may be declared and possibly implemented.</p>
</div>
<div class="paragraph">
<p>During the compilation process, the program AST is continuosuly being appended to, in real time.
Therefore, the order of declaration matters.
Unlike in other languages, referencing an undeclared yet entity triggers panic.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This code panics, because <code>y</code> is not declared prior to usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># let x = y + 1 # Panic!
let y = 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the following code leads to undefined behavior, because the <code>x</code> expression is evaluated immediately:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let y = unsafe! uninitialized SInt32
let x = y + 1 # Undefined behaviour
y = 42</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_decl"><a class="link" href="#_decl">7.1. <code>decl</code></a></h3>
<div class="paragraph">
<p>A declaration statement (<code>decl</code>) of a entity tells or reminds a compiler that such a entity exists.</p>
</div>
<div class="paragraph">
<p>Namespace, annotation, trait and unit types are implicitly declared; for example, <code>namespace Foo</code> is equivalent to <code>decl namespace Foo</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_impl"><a class="link" href="#_impl">7.2. <code>impl</code></a></h3>
<div class="paragraph">
<p>An implementation statement (<code>impl</code>) implements a previously declared entity.</p>
</div>
<div class="paragraph">
<p>Only a data type, or function or macro member may be implemented.</p>
</div>
</div>
<div class="sect2">
<h3 id="_def"><a class="link" href="#_def">7.3. <code>def</code></a></h3>
<div class="paragraph">
<p>A definition (<code>def</code>) is a declaration and implementation of a entity in the same statement.</p>
</div>
<div class="paragraph">
<p>Struct, class and enum types, as well as reference, function and macro members are implicitly defined; for example, <code>struct Foo</code> is equivalent to <code>def struct Foo</code>.
However, even such a entity may be explicitly declared prior to implementation, for example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl struct Foo;

# Either one would be valid,
# but a struct may only
# be implemented once!
#

impl struct Foo;
def struct Foo;
struct Foo; # `def` is implied</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_moveimpl"><a class="link" href="#_moveimpl">7.4. <code>moveimpl</code></a></h3>
<div class="paragraph">
<p>A entity implementation may be moved under another name using a <code>moveimpl</code> statement.
For example, <code>moveimpl foo as bar</code> statement moves implementation from <code>foo</code> to <code>bar</code>, effectively un-declaring <code>foo</code>.</p>
</div>
<div class="paragraph">
<p>However, only the specified declaration is moved.
For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo(arg ~ Real) { x }
moveimpl foo(arg ~ SInt) to bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>Leads to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo(arg ~ Real &amp;&amp; !SInt) { x }
def bar(arg ~ SInt) { x }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reimpl"><a class="link" href="#_reimpl">7.5. <code>reimpl</code></a></h3>
<div class="paragraph">
<p>A entity implementation may be re-implemented using a <code>reimpl</code> statement.
For example, <code>def foo { return 1 }; reimpl foo { return 2 }</code> results in <code>def foo { return 2 }</code>.</p>
</div>
<div class="paragraph">
<p>Akin to <a href="#_moveimpl">Section 7.4, &#8220;<code>moveimpl</code>&#8221;</a>, only the specified declaration is re-implemented.</p>
</div>
<div class="paragraph">
<p>Having a <code>as</code> clause acts as <a href="#_moveimpl">Section 7.4, &#8220;<code>moveimpl</code>&#8221;</a>, for example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo(arg ~ Real) { return 1 }
reimpl foo(arg ~ SInt) as bar { return 2 }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo(arg ~ Real &amp;&amp; !SInt) { return 1 }
def bar(arg ~ SInt) { return 2 }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_undecl"><a class="link" href="#_undecl">7.6. <code>undecl</code></a></h3>
<div class="paragraph">
<p>A declaration may be un-declared using an <code>undecl</code> statement, e.g <code>undecl foo</code>.
From that point, a compiler no more aware of the declaration until the entity is declared again.</p>
</div>
</div>
<div class="sect2">
<h3 id="_alias"><a class="link" href="#_alias">7.7. <code>alias</code></a></h3>
<div class="paragraph">
<p>An <code>alias</code> statement declares an alias to a entity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ebnf" data-lang="ebnf">alias =
  "alias",
  ref, {",", ref},
  ("=" | "to"),
  ref;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Forwarded and recursive aliases are allowed while resolve-able.</p>
</div>
<div class="paragraph">
<p>An <code>alias</code> statement conveys arguments to the target entity.
An omitted arguments list implies conveying all of the arguments.
A <code>*</code> in the arguments list captures all the arguments left and passes them to the target entity, e.g. <code>alias SInt32Pointer&lt;*&gt; = Pointer&lt;SInt32, *&gt;</code>.</p>
</div>
<div class="paragraph">
<p>A single <code>alias</code> statement may contain multiple aliases to the target entity, separated by commas.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">primitive Int&lt;Bitsize ~ \%nat, Signed ~ \%bool&gt;
  def subtract(another : self) : self;
  alias sub, - to subtract
end

alias SInt&lt;Bitsize: Z&gt; = Int&lt;Z, true&gt;
alias UInt&lt;Bitsize: Z&gt; = Int&lt;Signed: false, Bitsize: Z&gt;

alias UInt1 = UInt&lt;1&gt;
alias Bit, Bool = UInt1 # Multiple forwarded aliases</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_visibility_modifiers"><a class="link" href="#_visibility_modifiers">7.8. Visibility modifiers</a></h3>
<div class="paragraph">
<p>A <code>decl</code>, hence also <code>def</code>, statement may have a <em>visibility modifer</em>, which affects the visibility of the declared entity.</p>
</div>
<div class="paragraph">
<p>A entity declared <code>public</code> is visible outside of the current scope.
A entity declared <code>protected</code> is only visible in the same or child scope.
A entity declared <code>private</code> is only visible in the current scope.</p>
</div>
<div class="paragraph">
<p>A top-level entity can not be declared <code>protected</code>.
A top-level entity declared <code>private</code> is only visible in the current file.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_directives"><a class="link" href="#_directives">8. Directives</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>directive</em> is an instruction to the compiler.</p>
</div>
<div class="paragraph">
<p>File dependency directives instruct the compiler to depend on certain files.</p>
</div>
<div class="sect2">
<h3 id="_require"><a class="link" href="#_require">8.1. <code>require</code></a></h3>
<div class="paragraph">
<p>Files can be required using a <code>require</code> directive.</p>
</div>
<div class="paragraph">
<p>The same file may be required multiple times.
It is guaranteed to be only processed once required for the first time.</p>
</div>
<div class="paragraph">
<p>If a required file is missing extension, <code>.nx</code> would be appended.</p>
</div>
<div class="paragraph">
<p>A <code>require</code> directive may list multiple files to require, and an optional path to prepend to each required file path.
For example, <code>require "foo", "bar/baz.nx" from "/myloc"</code> is equivalent to <code>require "/myloc/foo.nx", "/myloc/bar/baz.nx"</code>.</p>
</div>
<div class="paragraph">
<p>A non-relative file path is first looked up relatively to the folder the file is contained in, i.e. <code>./</code>.</p>
</div>
<div class="paragraph">
<p>A compiler is required to provide a way to pass folder paths to lookup required files in, e.g. <code>-R/usr/nx</code>.
These paths would be prepended if a <code>require</code> statement is missing <code>from</code> clause.
For example, given <code>-R/usr/nx</code> flag, a <code>require "foo"</code> statement would lookup the file in the following order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>./foo</code></p>
</li>
<li>
<p><code>./foo.nx</code></p>
</li>
<li>
<p><code>/usr/nx/foo</code></p>
</li>
<li>
<p><code>/usr/nx/foo.nx</code></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>-R</code> feature comes in handy when need to flip the dependencies source folder, for example to match the target.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Wildcard requirements are possible, as defined by the POSIX standards, e.g. <code>require "./*"</code> or <code>require "./**"</code>.
The order of wildcard lookups is standardized.</p>
</div>
<div class="paragraph">
<p>A translation environment maintains the being-compiled program AST, and the order of requiring files matters.
If a required file references an undeclared yet entity, a compiler panics.</p>
</div>
</div>
<div class="sect2">
<h3 id="_import"><a class="link" href="#_import">8.2. <code>import</code></a></h3>
<div class="paragraph">
<p>An <code>import</code> directive imports C header files.</p>
</div>
<div class="paragraph">
<p>Rules similar to <code>require</code> are applied to an <code>import</code> directive.
The default imported file extension is <code>.h</code>.
A compiler is required to provide a way to pass import lookup paths, e.g. <code>-I/usr/include</code>.</p>
</div>
<div class="paragraph">
<p>More information on handling imported entities is found at <a href="#_interoperability">Section 9, &#8220;Interoperability&#8221;</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using"><a class="link" href="#_using">8.3. <code>using</code></a></h3>
<div class="paragraph">
<p>A <code>using</code> directive allows to either include a namespace or apply a refinement in the current scope, limited to the file.</p>
</div>
<div class="paragraph">
<p>If <code>namespace</code> and <code>refinement</code> keywords are omitted, the exact kind of a <code>using</code> directive operand is inferred from the type being used.
Otherwise, the type is forced.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">namespace Foo
  let bar = 42
end

# bar = 43 # Panic! `bar` is not defined

using Foo
# using namespace Foo # To be more explicit

bar = 43 # OK</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interoperability"><a class="link" href="#_interoperability">9. Interoperability</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>An Onyx compiler is required to be aware of the C Standard.
Non-standard C conformance is optional, but discouraged.</p>
</div>
<div class="paragraph">
<p>There is no Onyx ABI, and Onyx functions have undefined symbols in assembly.
To make an Onyx function "visible" in an object file, hence callable from assembly, a developer should <code>export</code> it as a C function.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Standard does not define any built-in "entry" function semantics.
It is a linker&#8217;s responsibility to start a process with a function considered the entry one.
Luckily, an Onyx compiler is required to be able to emit AST.
A linker script may then be generated pointing to an annotated function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>C header files may be included (<em>imported</em> in Onyx terminology), and all the C entities imported throughout the program compilation are accessible via the <code>$<em>&lt;id&gt;</em></code> notation, e.g. <code>$printf</code>.</p>
</div>
<div class="paragraph">
<p>A C function call is unsafe, and shall have parentheses regardless of arity.</p>
</div>
<div class="paragraph">
<p>Some Onyx type specializations can be autocast to a C type upon calling a C function, e.g. <code>String&lt;10, UTF8&gt;</code> is <code>char[10]</code>.
Unfortunately, looseness of the C Standard restricts automatic convertsion of, say, <code>String&lt;10, UTF16LE&gt;</code> to <code>char16_t[10]</code>, because <code>char16_t</code> is not guaranteed to contain exactly UTF-16 encoded characters.
In such cases, explicit, maybe unsafe, conversion or coercion is required.
Moreover, a C function has undefined scope, thus passing an Onyx pointer to it would likely be unsafe for itself.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">import "stdio.h"

export void main(int argc, char** argv) {
  # Threadsafe Onyx code inside
  # an exported function body
  #

  let msg = "Hello, world!\0" : String&lt;15, UTF8&gt;
  unsafe! $puts(&amp;msg)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Despite of that the Onyx safety within an exported function is the default threadsafe, an exported function call is still unsafe.</p>
</div>
<div class="paragraph">
<p>An exported function shall not be throwing.</p>
</div>
<div class="paragraph">
<p>An exported function, as well as its argument declarations, may be annotated.
An exported function argument reference is writeable by default, unless has a <code>const</code> qualifier.</p>
</div>
<div class="paragraph">
<p>An exported function, as well as its argument declarations, may be documented using Onyx comments.
Only an exported function documentation is preserved on exported; argument documentation is ignored.</p>
</div>
<div class="paragraph">
<p>A C primitive type has layout defined per compilation.
It usually depends on the target platform data model.
For example, passing <code>{ c: { int { size: 32, signedness: 2c } } }</code> to an Onyx compiler would make all <code>$int</code> instances 32 bit and 2&#8217;s complement within Onyx context.
However, due to the target dependency, an explicit conversion is still required.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
An advanced Onyx compiler usually has built-in mapping for C data type sizes, so you won&#8217;t need to pass them every time you compile your code.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An Onyx compiler is required to implement a subset of C operators.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">export int sum(int a, int b) {
  return a + b # Use native C summation operator
}

export int sub(int a, int b) {
  # `$int` may be greater than 32 bits,
  # thus data loss is possible.
  let onyx_a = a.to!(SBin32)

  # Would only work with `{ c: { int {
  # size: 32, signedness: 2c } } }`.
  # Otherwise, the behaviour is undefined.
  let onyx_b = unsafe! b as SBin32

  let result = onyx_a - onyx_b

  # Data loss is possible if
  # `$int` bitsize is &lt; 32.
  return result.to!($int)
}

export void main() {
  try
    # Native C equation operator
    @assert(unsafe! sum(1, 2) == 3)

    @assert(unsafe! sub(1, 2).to_i32!() == -1)
  catch
    unsafe! $exit($(EXIT_FAILURE))
  end
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_data_types"><a class="link" href="#_c_data_types">9.1. C data types</a></h3>
<div class="paragraph">
<p>A C struct or union definition may also be exported.
An exported data type is treated in as if it was imported.</p>
</div>
<div class="paragraph">
<p>An imported named C struct or union has semantics identical to an Onyx <code>struct</code> or <code>Union</code>.
This imples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default initializers, Onyx-style.
Note that exported C entities are zero-initialized.</p>
</li>
<li>
<p>Reopening with static function and method declaration thanks to UFCS.</p>
</li>
<li>
<p>Unsafe access to union options, which may be flattened to fields.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">import "math.h", "stdlib.h"

export struct struct_t {
  double x;
  double y;

  unsigned sw;
  union {
    float foo;
    short bar;
  };
};

reopen $strukt_t
  # Note that the function is not exported.
  #
  #  `public threadsafe def length(&amp;this : $strukt_t*cr) : $double`
  def length
    return unsafe! $sqrt($pow(this.x, 2) + $pow(y, 2))
  end

  def val : Variant&lt;$float, $short&gt;
    # Accessing union-ed fields is unsafe.
    (sw == 0) ? (unsafe! foo) : (unsafe! bar)
  end
end

export void main() {
  # `sw` is zero-initialized.
  let s : $strukt_t = $strukt_t(1,  2, foo: 42)

  try
    # Passes `s` by pointer.
    @assert(s.length().to_f64!().~=(2.236, 0.01))
    @assert(s.val().&lt;unsafe!&gt;as!(FBin64) == 42)
  catch
    unsafe! $exit($(EXIT_FAILURE))
  end
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_variables"><a class="link" href="#_c_variables">9.2. C variables</a></h3>
<div class="paragraph">
<p>A C variable may be exported as well.
In respect to C, zero initialization is implied if the value is omitted.</p>
</div>
<div class="paragraph">
<p>An exported variable reference has <code>static</code> scope in Onyx and is writeable unless has <code>const</code> qualifier.</p>
</div>
<div class="paragraph">
<p>It is possible to export a C-static variable as well.
It would be treated as <code>private</code> in terms of Onyx.</p>
</div>
<div class="paragraph">
<p>TODO: What happens upon taking a file-local variable&#8217;s address and passing it outside?
In regard to Onyx as well.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Exporting a C variable</div>
<div class="content">
<div class="paragraph">
<p>import "stdlib.h"</p>
</div>
<div class="paragraph">
<p>extern int foo;</p>
</div>
<div class="paragraph">
<p>export void main() {
  try
    @assert($foo : $int&amp;srw == 0)
  catch
    unsafe! $exit($(EXIT_FAILURE))
  end
}</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_macros"><a class="link" href="#_c_macros">9.3. C macros</a></h3>
<div class="paragraph">
<p>C preprocessor macros may also be imported and exported.</p>
</div>
<div class="paragraph">
<p>A C macro within Onyx context is used as follows: <code>$(MACRO)</code>.
The evaluation result of a macro is inserted into Onyx with prior processing.</p>
</div>
<div class="paragraph">
<p>Within an exporting context, C macros may intuitively be used as they&#8217;d be in pure C.
For example, <code>export MY_MACRO_VOID main() {</code> could theoretically expand to <code>export void main() {</code>.
The resulting code is then parsed as usual.</p>
</div>
</div>
<div class="sect2">
<h3 id="_external_declarations"><a class="link" href="#_external_declarations">9.4. External declarations</a></h3>
<div class="paragraph">
<p>A C function, struct, union or variable may be marked externally declared using the <code>extern</code> directive from Onyx code.
This is equivalent to importing a declaration.
That means that the entity would be defined at some later point of linkage.
The behaviour is similar to declaration in Onyx: a single entity may be `extern`ed multiple times, but only `export`ed or imported once.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Externing C entities</div>
<div class="content">
<div class="paragraph">
<p>The following code would fail to compile if symbol <code>foo</code> is not resolved during linkage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">import "stdio.h"

extern int foo;

export void main() {
  unsafe! $printf(&amp;"%d\n", $foo)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_literals"><a class="link" href="#_literals">10. Literals</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_literal_constrainment"><a class="link" href="#_literal_constrainment">10.1. Literal constrainment</a></h3>
<div class="paragraph">
<p>When read from source, a literal has inferred constrainment in accordance to <a href="#table-literal-constrainments">Table 1, &#8220;Basic literal constrainments&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>In code, a literal constrainment has form of <code>\&lt;<em>constrainment</em>&gt;</code>, e.g. <code>0.5 : \q</code>.
A literal constrainment is a type-level restriction, not an instance-level restriction.
It may be used to restrict a literal in-place or define a generic literal argument, e.g. <code>def foo(arg: _ : L) forall L : \q</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Both <code>def foo(arg: L) forall L : \q</code> and <code>def foo(arg : \q)</code> would panic, because a literal shall not be an instance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A constrainment is defined by a regular expression.
For example, <code>/f(?&lt;Bitsize&gt;\d+)/</code> defines <code>\f16</code>, <code>\f32</code> etc.</p>
</div>
<div class="paragraph">
<p>TODO: Restricting a literal to a concrete type is possible, but not vice versa, e.g. <code>42 : \%n : SBin32</code>, but not <code>42 : SBin32 : \%n</code>.
Also <code>42 : \%u : SBin32</code> is not possible.</p>
</div>
<div class="paragraph">
<p>TODO: Only basic <code>\%real</code>, <code>\%int</code>, <code>\%nat</code>, <code>\%bool</code>, <code>\%string</code> and <code>\%char</code> restictions are needed.
No literal instances.
Still can apply (partial) suffixes.</p>
</div>
<table id="table-literal-constrainments" class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-1" id="_table-1" class="table-caption-link">Table 1. Basic literal constrainments</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Literal examples</th>
<th class="tableblock halign-left valign-top">Constrainment regex</th>
<th class="tableblock halign-left valign-top">Default type</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>false</code>, <code>true</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/b/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Bool</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A boolean literal.</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>0</code>, <code>1</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/n</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>SBin32</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A <a href="https://en.wikipedia.org/wiki/Natural_number">natural number</a> (\$NN\$) literal.</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>-1</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/z/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>SBin32</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">An <a href="https://en.wikipedia.org/wiki/Integer">integer</a> (\$ZZ\$) literal.</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>1.0</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/q/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>FBin64</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A <a href="https://en.wikipedia.org/wiki/Rational_number">rational number</a> (\$QQ\$) literal.</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>'a'</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/c/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Char&lt;UCS&gt;</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A character literal.</p>
</td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4">                  <p class="tableblock">Special literals</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>:abc</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\y</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="gray">N\A</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A symbol literal.</p>
</td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Compound literals are basic literals with some modifications.
The inferred basic constrainment becomes a part of the compound constrainment.
For example, <code>0/1 : \rn</code> is a ratio of two natural literals.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-2" id="_table-2" class="table-caption-link">Table 2. Compound literal constraints</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Literal examples</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Constrainment regex</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Default type <i class="conum" data-value="1"></i><b>(1)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Notes</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>0//1</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/r(?&lt;Constraint&gt;.+)/</code>, e.g. <code>ri32</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Ratio&lt;<em>Constraint</em>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A ratio (as <a href="https://en.wikipedia.org/wiki/Quotient#Quotient_of_two_integers">quotient of two integers</a>) literal.</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>0j</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/j(?&lt;Constraint&gt;.+)/</code> , e.g. <code>ji32</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Imaginary&lt;<em>Constraint</em>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">An imaginary number literal.</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>0..1</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\..\$tt"L"\$</code>, e.g. <code>\..n</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Range&lt;\$tt"L"\$&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">An interval literal.</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>"abc"</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\s</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>String&lt;UTF8&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A string literal.</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>[0, 1]</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>stem:[tt"L"][\$tt"Z"\$]</code>, e.g. <code>\n[2]</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Array&lt;\$tt"L"\$, \$tt"Z"\$&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">An array literal.</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>&lt;0, 1&gt;</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>stem:[tt"L"]&lt;\$tt"Z"\$&gt;</code>, e.g. <code>\n&lt;2&gt;</code>; or <code>\(\$tt"L"\$)x\$tt"Z"\$</code>, e.g. <code>\(n)x2</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Vector&lt;\$tt"L"\$, \$tt"Z"\$&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A vector literal.</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>|[0, 1], [2, 3]|r</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\(\$tt"L"\$)x\${tt"Z"}\$\$tt"D"\$</code>, e.g. <code>\(n)x2x2r</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Tensor&lt;\$tt"L"\$, *\$tt"Z"\$, \$tt"D"\$&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A tensor literal.</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>(0, 1.0)</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>(\${tt"L"}\$)</code>, e.g. <code>(\n, \q)</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Tuple&lt;*\$tt"L"\$&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">A tuple of literals.</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>(foo: 0, bar: 1.0)</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>(\${tt"L"}\$)</code>, e.g. <code>(foo: \n, bar: \q)</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Struct&lt;*\$tt"L"\$&gt;</code></p>
</td>
</tr>
</tbody>
</table>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code><em>Constrainment</em></code> is the default type for the base literal, e.g. <code>1/0</code> would default to <code>Ration&lt;SBin32&gt;</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A complete constrainment is one constraining to a complete type.
For example, <code>\i32</code> is complete, but <code>\n</code> is not.</p>
</div>
<div class="paragraph">
<p>A numeric literal constrainment can be further constrained to a specific numeric type using a suffix from <a href="#table-numeric-literal-suffixes">Table 3, &#8220;Numeric literal contrainments&#8221;</a>.
The resulting constrainment equals to the suffix applied.
For example, <code>1u8 : \u8</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Simply constraining a literal has the same effect as applying a suffix to it, e.g. <code>1 : \u8</code> \$-=\$ <code>1u8</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>TODO: A specific-type constrainment (even partial) restricts the target type.
For example, <code>1u</code> can not be used as <code>FBin32</code>; also <code>1q</code> can not be used as an integer.</p>
</div>
<div class="paragraph">
<p>A character literal may also have a numeric suffix appended: it would turn it into a numeric literal, e.g. <code>'a&#8217;u8 : \u8 == 97</code>.
Appending a numeric suffix to a string turns it into an array of numeric literals representing the string&#8217;s codeunits, e.g. <code>"abc"u8 : \u8[3] == %u8[97 98 99]</code>.</p>
</div>
<div class="paragraph">
<p>Literal value and suffixes may be separated with underscores or wrapped in parentheses.
For example, <code>(42n)_i32</code>.
A constrainment is always flattened, thus e.g. <code>\(z)_fb64</code> is interchangeable with <code>\f64</code>.</p>
</div>
<table id="table-numeric-literal-suffixes" class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-3" id="_table-3" class="table-caption-link">Table 3. Numeric literal contrainments</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Regex</th>
<th class="tableblock halign-left valign-top">Applicable to <i class="conum" data-value="1"></i><b>(1)</b></th>
<th class="tableblock halign-left valign-top">Default type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>n</strong>/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>SBin32</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>z</strong>/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>SBin32</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>q</strong>/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code>, <code>\q</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>FBin64</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/s?<strong>i</strong>b?(?&lt;<em>Bitsize</em>&gt;\d+)?/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>SBin&lt;<em>Bitsize</em> = 32&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>u</strong>i?b?(?&lt;<em>Bitsize</em>&gt;\d+)?/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>UBin&lt;<em>Bitsize</em> = 32&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/(si?|<strong>i</strong>)<strong>d</strong>(?&lt;<em>Digits</em>&gt;\d+)/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>SDec&lt;<em>Digits</em>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>u</strong>i?<strong>d</strong>(?&lt;<em>Digits</em>&gt;\d+)/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>UDec&lt;<em>Digits</em>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>f</strong>b?(?&lt;<em>Bitsize</em>&gt;\d+)?/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code>, <code>\q</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>FBin\$&lt;&lt;\$<em>Bitsize</em> = 64\$&gt;&gt;\$</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/f?<strong>d</strong>(?&lt;<em>Bitsize</em>&gt;\d+)?/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code>, <code>\q</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>FDec\$&lt;&lt;\$<em>Bitsize</em> = 64\$&gt;&gt;\$</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/s?<strong>Q</strong>(?&lt;<em>Bitsize</em>&gt;\d+)?(e(?&lt;<em>Exponent</em>&gt;-?\d))?/</code> <i class="conum" data-value="2"></i><b>(2)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code>, <code>\q</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>SXBin&lt;<em>Bitsize</em>, <em>Exponent</em>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>uQ</strong>(?&lt;<em>Bitsize</em>&gt;\d+)?(e(?&lt;<em>Exponent</em>&gt;-?\d))?/</code> <i class="conum" data-value="2"></i><b>(2)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code>, <code>\q</code> <i class="conum" data-value="3"></i><b>(3)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>UXBin&lt;<em>Bitsize</em>, <em>Exponent</em>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/s?<strong>D</strong>(?&lt;<em>Total</em>&gt;\d+)?(f(?&lt;<em>Fractional</em>&gt;-?\d+))?/</code> <i class="conum" data-value="2"></i><b>(2)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code>, <code>\q</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>SXDec&lt;<em>Total</em>, <em>Fractional</em>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>uD</strong>(?&lt;<em>Total</em>&gt;\d+)?(f(?&lt;<em>Fractional</em>&gt;-?\d+))?/</code> <i class="conum" data-value="2"></i><b>(2)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code>, <code>\q</code> <i class="conum" data-value="3"></i><b>(3)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>UXDec&lt;<em>Total</em>, <em>Fractional</em>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/<strong>p</strong>(?&lt;<em>Bitsize</em>&gt;\d+)/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\n</code>, <code>\z</code>, <code>\q</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Posit\$&lt;&lt;\$<em>Bitsize</em>\$&gt;&gt;\$</code></p>
</td>
</tr>
</tbody>
</table>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Always applicable to <code>\c</code> and <code>\s</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Either one of generic arguments is required.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Literal signedness is checked.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A character literal (<code>\c</code>) may have a <a href="#table-character-set-literal-suffixes">character set suffix</a> appended before a numerical suffix.
A string literal (<code>\s</code>) may have an <a href="#table-encoding-literal-suffixes">encoding suffix</a> appended before a numerical suffix.</p>
</div>
<div class="paragraph">
<p>A text literal suffix replaces the constrainment, and makes it incompatible with the initial constrainment, e.g. <code>'a' : \ucs</code> is legal, but <code>'a&#8217;ucs : \c</code> is not.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The language is only aware of <a href="https://en.wikipedia.org/wiki/Unicode">Unicode</a> and its modern encodings, excluding other character sets.
</td>
</tr>
</table>
</div>
<table id="table-character-set-literal-suffixes" class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-4" id="_table-4" class="table-caption-link">Table 4. Character set literal suffixes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Regex</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/ucs/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Char&lt;UCS&gt;</code></p>
</td>
</tr>
</tbody>
</table>
<table id="table-encoding-literal-suffixes" class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-5" id="_table-5" class="table-caption-link">Table 5. Encoding literal suffixes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Regex</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/utf8/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>String&lt;<a href="https://en.wikipedia.org/wiki/UTF-8">UTF8</a>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/utf(16|32)[lb]e/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">E.g. <code>String&lt;<a href="https://en.wikipedia.org/wiki/UTF-16">UTF16LE</a>&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>/ucs(2|4)/</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">E.g. <code>String&lt;<a href="https://en.wikipedia.org/wiki/Universal_Coded_Character_Set">UCS2</a>&gt;</code></p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_range_literals"><a class="link" href="#_range_literals">10.2. Range literals</a></h3>
<div class="paragraph">
<p>TODO: Only have <code>[]</code> intervals?</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Literal</th>
<th class="tableblock halign-left valign-top">Magic literal</th>
<th class="tableblock halign-left valign-top">Math equivalent</th>
<th class="tableblock halign-left valign-top">Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\$A\$..\$B\$</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>%r[\$A\$ \$B\$]</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">\$[A, B]\$</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Range&lt;\$"T"\$, true, true&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\$A\$...\$B\$</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>%r[\$A\$ \$B\$)</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">\$[A, B)\$</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Range&lt;\$"T"\$, true, false&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">N/A</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>%r(\$A\$ \$B\$]</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">\$(A, B]\$</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Range&lt;\$"T"\$, false, true&gt;</code></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>\$A\$....\$B\$</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>%r(\$A\$ \$B\$)</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">\$(A, B)\$</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>Range&lt;\$"T"\$, false, false&gt;</code></p>
</td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If omitted, <code>\$A\$</code> defaults to <code>:min</code>, and <code>\$B\$</code> defaults to <code>:max</code>.
For example, <code>0.. == 0..:max</code>, <code>.. == :min..:max</code>.
A magic literal requires both ends to be set explicitly (still allowing symbols, e.g. <code>%ri[min \$B\$)</code>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_values"><a class="link" href="#_values">11. Values</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>value</em> is an instance of a <em>data type</em>.
For example, <code>42</code> may be a value of data type <code>SBin32</code>.</p>
</div>
<div class="paragraph">
<p>A runtime entity is either a value (<code>val : \$T\$</code>), a <em>reference</em> to a value (<code>ref : Reference&lt;\$T\$&gt; : \$T\$&amp;</code>), or a <em>pointer</em> to a value (<code>ptr : Pointer&lt;\$T\$&gt; : \$T\$*</code>).
The latter two are known as <a href="#_indirect_values">Section 12, &#8220;Indirect values&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>A reference has the same internal representation as a pointer, but the referenced value access semantic is different.</p>
</div>
<div class="paragraph">
<p>A reference is an <em>lvalue</em>, these terms are interchangeable.
A value or a pointer to a value is an <em>rvalue</em>.</p>
</div>
<div class="sect2">
<h3 id="_assigning_values"><a class="link" href="#_assigning_values">11.1. Assigning values</a></h3>
<div class="paragraph">
<p>Assigning an rvalue to an lvalue simply <em>moves</em> the value into the lvalue, making the lvalue a sole owner of the value.</p>
</div>
<div class="paragraph">
<p>Assigning an lvalue to another lvalue of the same type calls a copy initializer on the right operand, and moves the rvalue result to the left operand.
In <span class="line-through">other words</span> symbols, <code>\$l\$<sub>0</sub> : \$T\$&amp; = \$l\$<sub>1</sub> : \$T\$&amp;</code> \$=&gt;\$ <code>\$l\$<sub>0</sub> = \$T\$(&amp;\$l\$<sub>1</sub>) : \$T\$</code>.</p>
</div>
<div class="paragraph">
<p>TODO: Assigning to a variant.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x ~ SBin32&amp; = 42
let y ~ SBin32&amp; = x # Calls a copy initializer: `SBin32(&amp;x)`
y = 43
@assert(x == 42) # Did not change `x`</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When passing an argument to a function <code>decl foo(arg : T&amp;)</code>, the <code>foo(arg: x)</code> call syntax (or simply <code>foo(x)</code>) is a syntactic sugar for <code>foo(arg: = x)</code>, where <code>arg:</code> references the callee&#8217;s argument lvalue.
Similar is applicable to the aforementioned <a href="#_moving_values">moving</a> semantics, i.e. <code>foo(arg: &lt;-x)</code>.
However, a function argument does not have a value yet (even default), thus this is applicable neither to pushing nor to swapping.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is not applicable to pushing (e.g. <code>foo(arg: &lt;&lt;= x)</code>), because the argument default value is set if the argument is empty <strong>after</strong> the pass, and there is no syntax defined to receive the pushed value.</p>
</div>
<div class="paragraph">
<p>Should think about default value semantics: may be the default value is set prior to passing?
If so, both pushing and swapping may be possible.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_moving_values"><a class="link" href="#_moving_values">11.2. Moving values</a></h3>
<div class="paragraph">
<p>A reference may be turned into an rvalue using the <code>&lt;-</code> unary operator.
After that, the reference is considered <em>moved</em>.
Effectively, moving imples direct copying of the value data, skipping a copy initializer call.</p>
</div>
<div class="paragraph">
<p>A moved lvalue itself shall not be used anymore, unless set again.
Therefore, <span class="underline">only an explicitly declared</span> (e.g. with <code>\$"let"\$</code>) <span class="underline">local-scoped reference may be safely moved</span>.
Otherwise, moving is unsafe, but possible.
When moving safely, a compiler would panic if there is at least a possibility of using a moved lvalue, for example, when moving depends on runtime.</p>
</div>
<div class="paragraph">
<p>A <code>\$l\$<sub>0</sub> &lt;- \$l\$<sub>1</sub></code> expression is a syntactic sugar for <code>\$l\$<sub>0</sub> = &lt;- \$l\$<sub>1</sub></code>.
Without any receiver, a <code>&lt;-\$l\$</code> expression effectively finalizes the referenced value.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Moving an lvalue</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = 42
let y &lt;- x # Moves `x` into `y`
# x # Panic! Use after move (UAM)
y = 43 # Changes `y`
unsafe! x = 44 # Undefined behaviour, but does not affect `y`
x = 45 # Set `x` again

@assert(x == 45)
@assert(y == 43)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo(list : Std::List&amp;);
let list = Std::List()

foo(list) # Copy the list
# foo(list: list) # Ditto

foo(&lt;-list) # Move the list instead of copying it
# foo(list: &lt;-list) # Ditto
# list # Panic! UAM</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Returning an lvalue implicitly moves it, i.e. <code>return \$l\$</code> is equal to <code>return &lt;-\$l\$</code>.
Therefore, it is not possible to return an lvalue, hence reference.</p>
</div>
<div class="paragraph">
<p>An rvalue may also be moved, i.e. <code>&lt;-\$r\$</code> is not a error.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pushing_values"><a class="link" href="#_pushing_values">11.3. Pushing values</a></h3>
<div class="paragraph">
<p>Assigning or moving into an lvalue returns the left operand, i.e. the affected reference, finalizing the old value.
It is possible to do a <em>push-assign</em> (<code>&lt;&lt;=</code>) or <em>push-move</em> (<code>&lt;&lt;-</code>) instead, which return the old value as an rvalue.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Pushing into lvalues</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = 42
@assert((x = 43) == 43)   # Replaces the old value
@assert((x &lt;&lt;= 44) == 43) # Pushes the old value

let y = 17
@assert((y &lt;&lt;- x) == 17)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_swapping_values"><a class="link" href="#_swapping_values">11.4. Swapping values</a></h3>
<div class="paragraph">
<p>Two indirect values referencing values of the same type may swap their values using the <em>swap operator</em> <code>&lt;-&gt;</code>.
The operation shall be allowed by the scope constraints (for example, it is not possible to swap indirect values with undefined scopes), and is fragile.
The left operand is then returned.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Swapping lvalues</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = 42
let y = 43
@assert((x &lt;-&gt; y) ~ SBin32&amp; == 43) # New `x` value is 43</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_indirect_values"><a class="link" href="#_indirect_values">12. Indirect values</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>An indirect value is either a <a href="#_references">reference</a> or <a href="#_pointers">pointer</a> to a <a href="#_values">value</a>.
Indirect values share common semantics, such as <a href="#_scopes">scope</a>, <a href="#_spaces">space</a>, readability and writeability (commonly known as <a href="#_accessibility">Section 12.3, &#8220;Accessibility&#8221;</a>).</p>
</div>
<div class="sect2">
<h3 id="_references"><a class="link" href="#_references">12.1. References</a></h3>
<div class="paragraph">
<p>TODO: A reference may be restricted to an rvalue; this would copy it, returning an rvalue.
Thus, <code>let x : Std::List; x : Std::List</code> is OK, but copies.</p>
</div>
<div class="paragraph">
<p>TODO: An rvalue is really a temporal reference, but for some reason it&#8217;s moved instead of copying upon assignment, e.g. <code>let list = Std::List() |.shuffle()</code>.
Assigning a temporal reference moves it?</p>
</div>
<div class="paragraph">
<p>A reference type <code>Reference&lt;Type: \$T\$, Scope: \$S\$, Space: \$P\$, Readable: \$R\$, Writeable: \$W\$&gt;</code> can be shorcut as <code>\$T\$&amp;\$SPRW\$</code>, e.g. <code>SBin32&amp;lrw0 == Reference&lt;SBin32, :local, 0, true, true&gt;</code>.
For scope one-letter shortcuts, see <a href="#_scopes">Section 13, &#8220;Scopes&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>A <em>variable</em> reference is declared using the <code>\$bb "let"\$ \$"var"\$</code> syntax.
A variable reference is always both writeable and readable, i.e. <code>let var : \$T\$&amp;rw</code>.
A variable may be also declared write-only, e.g. <code>let buff : SBin32&amp;sw</code>.
Within a class declaration, special <code>\$bb "get"\$</code> and <code>\$bb "set"\$</code> declarations may be used, which does not affect the "real" reference accessibility.</p>
</div>
<div class="paragraph">
<p>A <em>constant</em> reference is declared using the <code>\$bb "final"\$ \$"const"\$</code> syntax.
A constant reference is read-only by default, i.e. <code>final const : \$"T"\$&amp;r</code>.
However, a constant reference may be declared <a href="#inaccessible">inaccessible</a> by restricting it to a <code>\$"T"\$&amp; : \$"T"\$&amp;\$"RW"\$</code> type, e.g. <code>final dead : SBin32&amp;s</code>.</p>
</div>
<div class="paragraph">
<p>A reference declaration type annotation is optional and (usually) may be inferred.</p>
</div>
<div class="paragraph">
<p>A reference declaration may have one of <code>\$"local"\$</code>, <code>\$"instance"\$</code> or <code>\$"static"\$</code> scope modifiers, e.g. <code>let local var</code>.
Implicit default scope modifiers are defined for certain scopes, read more in <a href="#_scopes">Section 13, &#8220;Scopes&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>Accessing a reference transparently accesses the referenced value.
For example, <code>(\$l\$ : \$T\$&amp;).\$m\$</code> accesses <code>\$m\$</code> member of the value referenced by <code>\$l\$</code>.
The same applies to lookup, i.e. <code>\$T\$&amp;::\$m\$</code> transparently lookups <code>\$T\$::\$m\$</code>.
This paragraph is important, because it means that a reference itself can not be accessed, but only the value it references.</p>
</div>
<div class="paragraph">
<p>A value type itself shall not be a reference, i.e. <code>\$r\$ : \$T\$&amp;</code> is illegal, which also makes references to references and pointers to references illegal.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This behaviour is different from C++, where references are first-class types and may be (almost) freely passed around.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_pointers"><a class="link" href="#_pointers">12.2. Pointers</a></h3>
<div class="paragraph">
<p>Similar to references, the shorcut semantic is applicable to a <code>Pointer</code> type, but with the <code>*</code> symbol, e.g. <code>SBin32*lrw0 == Pointer&lt;SBin32, :local, 0, true, true&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Akin to C, pointer to pointer, i.e. <code>\$"T"\$**</code>, is legal, with arbitrary depth.</p>
</div>
<div class="paragraph">
<p>Akin to C, a reference may be safely cast to a pointer using the <code>&amp;(\$"l"\$ : \$"T"\$&amp;) : \$"T"\$*</code> semantic, and vice versa.
For example, <code>let x : SBin32&amp;lrw = 42</code> and then <code>&amp;x : SBin32*lrw</code>, and then <code>*&amp;x : SBin32*lrw</code> again.</p>
</div>
<div class="paragraph">
<p>In fact, a reference is similar to pointer, but implies different underlying value access semantics, and can not be referenced to.</p>
</div>
<div class="paragraph">
<p>As in C, a pointee is accessed using the <code>-&gt;</code> operator, e.g. <code>ptr-&gt;foo</code>.
However, in Onyx, the <code>-&gt;</code> operator by itself turns a pointer into reference, i.e. <code>((\$"ptr"\$ : \$"T"\$*)-&gt;) : \$"T"\$&amp;</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessibility"><a class="link" href="#_accessibility">12.3. Accessibility</a></h3>
<div class="paragraph">
<p>An object is <em>accessed</em> in runtime using the <code>.</code> notation, which transparantly passes the callee&#8217;s pointer as the first argument to the caller in accordance to the <a href="https://en.wikipedia.org/wiki/Uniform_Function_Call_Syntax">UFCS</a>, e.g. <code>obj.foo()</code> equals to <code>obj::foo(&amp;obj)</code>.</p>
</div>
<div id="inaccessible" class="paragraph">
<p>Indirect value readability and writeability are commonly referenced as <em>accessibility</em>.
Thus, a neither readable nor writeable indirect value is <em>inaccessible</em>.</p>
</div>
<div class="paragraph">
<p>Reading means either moving an lvalue or assigning it, i.e. read the underlying value.
Note that passing an indirect value around is not considered reading.</p>
</div>
<div class="paragraph">
<p>Writing means writing directly into the underlying value space, e.g. assigning to an indirect value.
Note that mutating an underlying value of a class type is not considered writing, i.e. <code>final list : mut Std::List&lt;SBin32&gt;()</code>, and then <code>list &lt;&lt; 42</code> is legit; but "mutating" any other type is considered writing.
That&#8217;s one of the outstanding features of a class type.</p>
</div>
<div class="paragraph">
<p>Positive readability is designated with lowercase <code>r</code> symbol in the indirect value shortcut semantic; for example, <code>\$T\$&amp;r</code> is a readable reference.
Writeability uses the letter <code>w</code>.
Negative \$x\$-ability is designated with an uppercase letter, e.g. <code>\$T\$&amp;RW</code> is inaccessible.</p>
</div>
<div class="paragraph">
<p>A \$x\$ indirect value may be safely conveyed into an outer scope as a non-\$x\$ indirect value.
For example, a <code>\$T\$*rw</code> may be safely auto-cast to a <code>\$T\$*Rw</code> argument, but vice versa would be unsafe.</p>
</div>
</div>
<div class="sect2">
<h3 id="_spaces"><a class="link" href="#_spaces">12.4. Spaces</a></h3>
<div class="paragraph">
<p>An indirect value space is a platform-defined natural value, declared as a <code>Space : ~\%nat = 0</code> argument.
Note that omitting the <code>Space</code> argument implies the default zero space.</p>
</div>
<div class="paragraph">
<p>An indirect value with undefined space is incomplete.
Indirect values with different spaces are incompatible.</p>
</div>
<div class="paragraph">
<p>In an indirect value shortcut notation, space is a natural number, usually put in the very end, e.g. <code>T&amp;lrw0</code>.</p>
</div>
<div class="paragraph">
<p>The Standard defines space mappings for common platforms.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scopes"><a class="link" href="#_scopes">13. Scopes</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Defined scopes are <span class="underline">t</span><em>emporal</em>, <span class="underline">l</span><em>ocal</em>, <span class="underline">c</span><em>aller</em>, <span class="underline">i</span><em>nstance</em> and <span class="underline">s</span><em>tatic</em>.
An indirect value may also have an <span class="underline">u</span><em>ndefined</em> scope.
An underlined symbol defines the scope shortcut used in indirect value shortcuts, e.g. <code>\$"T"\$*l</code> has <span class="underline">l</span>ocal scope.</p>
</div>
<div class="paragraph">
<p>When passing an aggregate (i.e. non-scalar) value to an outer scope (e.g. returning from a function or passing as an argument), each of its fields' scopes is checked and auto-cast (if applicable) separately.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In Onyx, arrays, tuples and structs are very similar.
It&#8217;s their access semantic what&#8217;s different.
It can be said that an array elements accessed with <code>[]</code> are "fields" of the array with <code>[0]</code>, <code>[1]</code> etc. names.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>In this example, an array of local pointers can be passed as an array of caller pointers.
However, it shall not be returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo(ary : SBin32*cw[1])
  ary[0]-&gt; = 43
end

def main
  let x = 42
  let ary = [&amp;x] : SBin32&amp;lrw[1]

  foo(ary) # OK, auto-casts the element's scope
  @assert(x == 43)

  # return ary # Panic! Can not return a local-scoped pointer
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example is similar, but a custom struct is used instead of an array.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Wrapper
  # Note how it points to an instance scope,
  # i.e. to the one the object is in.
  let wrapped : SBin32*irw
end

def foo
  final x = 42

  final wrapper = Wrapper(&amp;x)
  @assert(wrapper :? Wrapper&amp;lrw)

  *(wrapper.wrapped) = 43
  @assert(x == 43)

  # # Panics because `wrapped`
  # # has instance, hence local, scope.
  # return wrapped # Panic!
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Similar rules are applied to a value existence.
<code>\$T\$*l&amp;s</code> does not make sense, as there is no local scope in the static scope.
That said, <code>Array&lt;\$T\$*l&gt;&amp;l</code> and <code>Array&lt;\$T\$*s&gt;&amp;l</code> are valid, but <code>Array&lt;\$T\$*l&gt;&amp;s</code> is not.</p>
</div>
<div class="paragraph">
<p>Note that a non-indirect value does not have scope, it is pure data, which can be passed at any direction.</p>
</div>
<div class="paragraph">
<p>A field of a pointer type with scope other than instance, static or undefined shall not be declared.
However, a generic-typed field may be specialized with another scope.
For example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo
  # # Does not make sense to
  # # have local pointer here.
  # let ptr : SBin32*l # Panic!

  let ptr : T

  # # Could've used instance
  # # pointer as an alternative.
  # # See the `Wrapper` example above.
  # let ptr : SBin32*i
end

final global_x = 42
# TODO: Address space inference here?
# Would likely put into `.global` on PTX.
final global_foo = Foo&lt;SBin32*sr&gt;(&amp;x) # OK

def bar
  final x = 42
  final foo = Foo&lt;SBin32*lr&gt;(&amp;x) # OK

  # # As mentioned above, each field is checked independently;
  # # it is not possible to pass a local pointer outside, thus panicking.
  # return foo # Panic!
end</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scope_casting"><a class="link" href="#_scope_casting">13.1. Scope casting</a></h3>
<div class="paragraph">
<p>An indirect value of one scope may be cast to another scope using the <code>as</code> operator in accordance to <a href="#table-scope-casting">Table 6, &#8220;Scope casting&#8221;</a>.
For example, <code>(ptr : T*c) as T*l</code> is <span class="green">threadsafe</span>, but <code>(ptr : T*l) as T*c</code> is <span class="red">unsafe</span>.</p>
</div>
<div id="accessibility-casting-constraints" class="paragraph">
<p>Disabling or preserving an accessibility option is <span class="green">threadsafe</span> (e.g. making an <code>*rw</code> pointer <code>*r</code>-only), but enabling it back is <span class="red">unsafe</span> (e.g. casting a <code>&amp;W</code> reference to <code>&amp;rw</code>).</p>
</div>
<div class="paragraph">
<p>Casting to undefined scope is <span class="green">threadsafe</span> with respect to the beforementioned accessibility casting (e.g. <code>(ptr : T*r) as T*rw</code> becomes <span class="red">unsafe</span>).
Casting from undefined scope is always <span class="red">unsafe</span>.</p>
</div>
<table id="table-scope-casting" class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-6" id="_table-6" class="table-caption-link">Table 6. Scope casting</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2">                  <p class="tableblock"><strong>Source</strong></p>
</td>
<td class="tableblock halign-center valign-top" colspan="5">                  <p class="tableblock"><strong>Safety of casting to target scope</strong></p>
</td>
</tr>
<tr>
<td class="tableblock halign-center valign-top">                  <p class="tableblock"><strong>Scope</strong></p>
</td>
<td class="tableblock halign-center valign-top">                  <p class="tableblock"><strong>Accessibility</strong></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Temporal</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Local</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Caller</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Static</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Undefined</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2">                  <p class="tableblock">Temporal</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2">                  <p class="tableblock">Local</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2">                  <p class="tableblock">Caller</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2">                  <p class="tableblock">Static</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Read-only and constant</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Writeable or mutable</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="yellow">Fragile</span> <i class="conum" data-value="1"></i><b>(1)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="yellow">Fragile</span> <i class="conum" data-value="1"></i><b>(1)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2">                  <p class="tableblock">Undefined</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
</tbody>
</table>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Because other threads may simultaneously write or mutate the value.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_indirect_value_argument_autocasting"><a class="link" href="#_indirect_value_argument_autocasting">13.2. Indirect value argument autocasting</a></h3>
<div class="paragraph">
<p>Only a pointer with caller, static or undefined scope may be declared as a function argument type.
A reference shall not be declared a function argument type, because a reference to a reference is impossible.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>Scope</code> argument is a <a href="#_todo">ghost generic</a> argument.
<code>Pointer&lt;Scope: Undef&gt;</code> would therefore trigger a separate specialization.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a pointer is passed to a function, it may be automatically cast to the target argument scope with safety defined in <a href="#pointer-argument-autocasting">Table 7, &#8220;Pointer argument autocasting&#8221;</a>.
Otherwise, manual <a href="#_scope_casting">scope casting</a> is required.
The resulting safety of a call is the lowest safety from the callee safety modifier and the autocasting safety of its arguments from the table, plus the <a href="#accessibility-casting-constraints">accessibility casting constraints</a>.</p>
</div>
<table id="pointer-argument-autocasting" class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-7" id="_table-7" class="table-caption-link">Table 7. Pointer argument autocasting</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle" colspan="2">                  <p class="tableblock"><strong>Caller-side pointer</strong></p>
</td>
<td class="tableblock halign-center valign-middle" colspan="3">                  <p class="tableblock"><strong>Autocasting safety by a declared argument&#8217;s scope</strong></p>
</td>
</tr>
<tr>
<td class="tableblock halign-center valign-top">                  <p class="tableblock"><strong>Scope</strong></p>
</td>
<td class="tableblock halign-center valign-top">                  <p class="tableblock"><strong>Accessibility</strong></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Caller</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Static <i class="conum" data-value="1"></i><b>(1)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Undefined</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2">                  <p class="tableblock">Temporal</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="gray">N/A</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="gray">N/A</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2">                  <p class="tableblock">Local</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="gray">N/A</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2">                  <p class="tableblock">Caller</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="gray">N/A</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-middle" rowspan="2">                  <p class="tableblock">Static</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Read-only and constant</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Writeable or mutable</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="yellow">Fragile</span> <i class="conum" data-value="2"></i><b>(2)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2">                  <p class="tableblock">Undefined</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="red">Unsafe</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="gray">N/A</span></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="green">Threadsafe</span></p>
</td>
</tr>
</tbody>
</table>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Manual cast to static scope is required prior to passing, see <a href="#table-scope-casting">Table 6, &#8220;Scope casting&#8221;</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Because other threads may simultaneously write or mutate the value.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_returned_indirect_value_scope_autocasting"><a class="link" href="#_returned_indirect_value_scope_autocasting">13.3. Returned indirect value scope autocasting</a></h3>
<div class="paragraph">
<p>Returning a reference implicitly moves it, thus making returning a reference impossible.</p>
</div>
<div class="paragraph">
<p>Otherwise, a pointer with scope other than local may be returned from a function.
Its scope is automatically cast at the caller side in accordance to <a href="#returned-pointer-scope-autocasting">Table 8, &#8220;Returned pointer scope autocasting&#8221;</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An observer never sees raw instance scope.
It always turns into the containing object&#8217;s.
</td>
</tr>
</table>
</div>
<table id="returned-pointer-scope-autocasting" class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-8" id="_table-8" class="table-caption-link">Table 8. Returned pointer scope autocasting</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle">                  <p class="tableblock"><strong>Returned pointer scope</strong></p>
</td>
<td class="tableblock halign-center valign-middle">                  <p class="tableblock"><strong>Caller-side resulting pointer scope</strong></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Temporal</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Temporal</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Local</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><span class="gray">N/A</span></p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Caller</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Local (see <a href="#_caller_scope">Section 13.6, &#8220;Caller scope&#8221;</a>)</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Static</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Static</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Undefined</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Undefined</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_temporal_scope"><a class="link" href="#_temporal_scope">13.4. Temporal scope</a></h3>
<div class="paragraph">
<p>A temporal-scoped indirect value shall not be preserved for future use.
Therefore, a reference to a temporal-scoped pointer (e.g. <code>let x : T*t&amp;</code>) is illegal, which makes it impossible to pass a temporal-scoped indirect value anywhere, but access it immediately or return only.</p>
</div>
<div class="paragraph">
<p>Any-scoped indirect value other than undefined may be thread-safely cast to a temporal-scoped indirect value, but not vice versa.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Counter-example for passing a temporal-scoped pointer as an argument: <code>def foo(list : List&lt;T&gt;*c, element : T*c)</code>: after resizing of the <code>list</code> inside the body, <code>element</code> may become invalid.
Also returning the <code>element</code> from the function would cast it to local scope on the caller site, which is inappropriate.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class Std::List&lt;T&gt;
  let pointer : Void*

  mut def [](index : Size) : T*trw
    # Returning a reference would not make sense here,
    # because returning implies moving, and moving
    # turns the reference into an rvalue.
    #
    # Thus, return a temporal pointer to an element.
    # Temporal it is because the list may be resized at any
    # moment, and the element pointer would become invalid.
    return unsafe! pointer[index] as T*trw
  end
end

final list = mut Std::List(1, 2, 3)
let x = 42

# final e : SBin32*trw&amp;lr = list[1] # Panic! Can not have a reference
                                    # to a temporal pointer

final e : SBin32&amp;lr = *list[1] # OK, copies `2` into `e`

*list[1] = x # OK, copies value from `x` into the element</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_local_scope"><a class="link" href="#_local_scope">13.5. Local scope</a></h3>
<div class="paragraph">
<p>References declared within a function body or arguments list with <code>\$"local"\$</code> modifier (which is the default one) always have <em>local scope</em>.
Only references with <code>\$"local"\$</code> scope modifier may be local-scoped.
That means that neither <code>let \$x\$ : \$T\$&amp;s</code> nor <code>static let \$x\$ : \$T\$&amp;l</code> are legal.</p>
</div>
<div class="paragraph">
<p>Once the scope containing an explicitly declared local-scoped reference terminates, the referenced value is finalized, but only once.</p>
</div>
<div class="paragraph">
<p>It is not possible to safely pass a local-scoped pointer to an outer scope.
But, a local-scoped pointer may be safely passed as a caller-scoped pointer argument.
Note that it does not make sense do declare a local-scoped pointer argument, i.e. <code>\$a\$ : \$T\$*lr&amp;</code>, because where would it point to?</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># def foo(final local arg : SBin32&amp;lrW0) # Ditto
def foo(arg : SBin32&amp;)
  arg : SBin32&amp;lr0  # Inferred to be local

  # final x : SBin32&amp;s # Panic! A reference declared with `local` scope
                       # modifier may only have local `Scope` argument

  final x = 42
  x : SBin32&amp;lr0 # Inferred to be local

  bar(&amp;x : SBin32*lr) # Can pass local-scoped ind-val as caller-scoped
  @assert(x == 43)
end

# Note the `&amp;ref` syntactic sugar,
# which turns a pointer into reference.
def bar(&amp;ref : SBin32*cw&amp;lr)
  ref = 43 # Change caller-scoped reference
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_caller_scope"><a class="link" href="#_caller_scope">13.6. Caller scope</a></h3>
<div class="paragraph">
<p>A caller-scoped pointer is known to point at a value existing somewhere in the call stack, and therefore shall not be passed outside of it (the call stack), but can be safely returned.</p>
</div>
<div class="paragraph">
<p>Returning a caller-scoped pointer always casts it to a local-scoped pointer on the caller side, because there is no way to preserve whether does the pointer point to a value existing in the caller scope or somewhere upper in the call stack.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def tap(arg : SBin32*c&amp;) : SBin32*c
  return arg
end

def foo(a : SBin32*c&amp;)
  let b = 42

  let x = tap(a) : SBin32*l # Here, `a` really points to the caller
                            # scope, but we can't know that

  let y = tap(&amp;b) : SBin32*l
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>There is no way to declare a caller-scoped reference other than dereference a caller-scoped pointer, which is ephemeral by nature.</p>
</div>
</div>
<div class="sect2">
<h3 id="_instance_scope"><a class="link" href="#_instance_scope">13.7. Instance scope</a></h3>
<div class="paragraph">
<p>Instance scope is guaranteed to span at least to the containing object&#8217;s lifetime.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">field</dt>
<dd>
<div class="paragraph">
<p>A <em>field</em> is a reference declared with an <code>\$bb"instance"\$</code> scope modifier, which is the default and only applicable for a reference declaration within a data type definition.
A reference declaration within a data type definition may also be declared with a <a href="#_static_scope"><code>\$bb"static"\$</code> scope</a> modifier.
In that case, it would not be a field anymore, but simply a static reference.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>An instance-scoped indirect value type is only used either within a field declaration, e.g. <code>instance let ptr : T*i</code>.
For an observer, an instance scope translates to the containing object&#8217;s scope.
Therefore, accessing an object&#8217;s field returns a reference with the same scope as the object&#8217;s.
Consequently, casting to and from instance scope is absent from <a href="#table-scope-casting">Table 6, &#8220;Scope casting&#8221;</a>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Point
  # `instance val` is implied.
  val x : FBin64

  # Return a pointer to `x`.
  #
  # The declaration has return type inferred;
  # the returned scope would equal to `this`'.
  #
  # NOTE: `&amp;this*` is a syntactic
  # sugar for `&amp;this : self*`.
  #
  # NOTE:The function is always threadsafe,
  # because there is no actual reference access.
  def get_x_ptr(&amp;this*)
    return &amp;(this.x)
  end

  # # NOTE: A more wordy, but similar implementation.
  # # NOTE: Could've used `S, R, W, P` instead of `T`.
  # def get_x_ptr(
  #   &amp;this : Pointer&lt;self, *T&gt;
  # ) : Pointer&lt;FBin64, *T&gt; forall T
  #   return &amp;(this.x)
  # end
end

# A static point.
final sp = Point(42)

@[Std::Entry]
export void main() {
  # Note the static scope
  sp.x : FBin64&amp;sr
  sp:get_x_ptr() : FBin64*sr

  # A local point
  final lp = Point(43)

  # Note the local scope
  lp.x : FBin64&amp;lr
  lp:get_x_ptr() : FBin64*lr
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Wrapper
  # Using an instance-scoped indirect
  # value as a field type restriction.
  val ptr : FBin64*irw

  # # This is implied.
  # impl initialize(&amp;this*crw, ptr : FBin64*crw)
  #   this.ptr = ptr
  # end
end

@[Std::Entry]
export void main() {
  static final x = 0f64

  # Onyx does not support non-trivial
  # initializers within static context
  static final w = unsafe! uninitialized Wrapper

  # `initialize` is special in terms that it safely
  # casts `this : self&amp;r` to `this : self&amp;rw`.
  # But static to caller casting is still fragile.
  fragile! w:initialize(&amp;x)

  w.ptr : FBin64*srw&amp;sr # `ptr`'s scope becomes static
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When returned from a method, an instance-scoped pointer scope is cast to the object&#8217;s scope, from the perspective of the caller.
An instance-scoped pointer shall not be safely cast to any other scope other than undefined, because it would eliminate the "cast to object&#8217;s scope" feature.</p>
</div>
<div class="paragraph">
<p>It is possible to safely pass an instance-scoped pointer as a caller-scoped pointer argument.</p>
</div>
<div class="paragraph">
<p>A field&#8217;s type may be declared an instance-scoped pointer.
The pointer shall then have the same scope as the containing object.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Wrapper
  let a : FBin64

  def get_a() : FBin64*irw
    a : FBin64&amp;irw # This is an instance-scoped reference

    # Again, returning a reference would turn it
    # into an rvalue, which is not what we want.
    return &amp;a : FBin64*irw
  end

  # An instance-scoped pointer expands
  # to the containing object's scope.
  let b : SBin32*irw

  def double_b()
    # It is still instance-scoped here.
    *(b : SBin32*irw) *= 2
  end
end

let b = 42

# `w` has local scope, thus its `b`
# becomes `SBin32*lrw` for the observer.
final w = Wrapper(a: 17, b: &amp;b)

# An instance pointer becomes a local
# pointer, inherited from `p`'s scope
final a : FBin64*lrw = w.get_a() : FBin64*lrw

w.double_b()
@assert(b == 84)</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
TIP: Only local-scoped <strong>references</strong> are finalized, and <code>x</code> is a local-scoped <strong>pointer</strong>.
Therefore, no double-finalization would happen.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_static_scope"><a class="link" href="#_static_scope">13.8. Static scope</a></h3>
<div class="paragraph">
<p>Statically-scoped indirect values reference values existing in the static scope, i.e. outside of the call stack, and guaranteed to be available at any moment of program execution.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
TODO: The definition of "static" is tricky for GPU kernels.
Should put better thought at it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A reference declared in a namespace, trait or unit type declaration has implicit <code>\$"static"\$</code> scope modifier.
A reference declared in a struct, class or enum type declaration may be declared statically-scoped with explicit <code>\$"static"\$</code> scope modifier.</p>
</div>
<div class="paragraph">
<p>A statically-scoped indirect value may be safely cast to a local-, caller-, instance- or undefined-scoped indirect value, but not vice versa.</p>
</div>
</div>
<div class="sect2">
<h3 id="_undefined_scope"><a class="link" href="#_undefined_scope">13.9. Undefined scope</a></h3>
<div class="paragraph">
<p>Indirect values with undefined scope are safe to pass around, but the values they&#8217;re referencing can not be safely accessed.
For example, with <code>\$x\$ : \$T\$* : \$T\$*uRW</code>, it is unsafe to either call a method on <code>\$x\$</code> or dereference it, reading its value.</p>
</div>
<div class="paragraph">
<p>A C pointer has undefined scope by default (it is also neither readable nor writeable), and therefore should be unsafely cast to a desired pointer type prior to using, for example:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">extern int* get_some_int_ptr(void);

def main
  final ptr = unsafe! $get_some_int_ptr() : $int*
  final result = *(unsafe! ptr as SBin32*sr) # Now we can read from it
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Any-scoped indirect value may be safely cast to an undefined-scope indirect value, but not vice versa.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functions"><a class="link" href="#_functions">14. Functions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A function may declare generic arguments.
For that, a type identifier unavailable in the current scope shall be listed in a <code>forall</code> clause.
A function generic argument is available within the function prototype and body.
An unrestricted argument</p>
</div>
<div class="paragraph">
<p>If a function body contains delayed macros, then it is guaranteed to specialize per matching type of a fuzzy restriction?</p>
</div>
<div class="paragraph">
<p>Built-in methods are <code>is? == :?</code>, <code>of? == ~?</code> and <code>as!</code>.
They can not be overloaded, but can be used as binary operators, e.g. <code>(x is? T) == (x :? T) == (x.is?(T))</code>.
<code>as!</code> means unconditional coercion and unsafe unless the argument is <code>self</code> or a compiler can prove safety of the coercion (e.g. for a local-scoped variant instance within a branch).</p>
</div>
<div class="paragraph">
<p><code>x.is?(Undef~U) == x.of?(U)</code>.</p>
</div>
<div class="paragraph">
<p><code>to(type)</code> and <code>to_</code> methods family may also be overloaded.
<code>x to SInt32 == x.to(SInt32) == x.to_i32</code>, also <code>x.to_$i</code>.</p>
</div>
<div class="paragraph">
<p>TODO: <code>{% if nx.ctx.impl.recv then %}</code>.</p>
</div>
<div id="trivial-function" class="paragraph">
<div class="title">Trivial functions</div>
<p>A trivial function is one not calling any runtime code when inlined, but may only be doing some reference assignments.
An example of a trivial function is the default initializer for structs, or primitive initializers such as numbers.</p>
</div>
<div class="sect2">
<h3 id="_function_declarations"><a class="link" href="#_function_declarations">14.1. Function declarations</a></h3>
<div class="paragraph">
<p>Function declarations are threadsafe by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="_methods_new"><a class="link" href="#_methods_new">14.2. Methods new</a></h3>
<div class="paragraph">
<p>A function member declared within a data type with <code>instance</code> scope (which is the implicit default one) is called a <em>method</em>.</p>
</div>
<div class="paragraph">
<p>A method may be called on an object using the <code>obj.method(args)</code> syntax.
Note that as any other function call, a method call requires parentheses even with zero arity.</p>
</div>
<div class="paragraph">
<p>Within a method, a special <code>this</code> reference is available.</p>
</div>
<div class="paragraph">
<p>If the containing type is a value type, then <code>this</code> is a read-only copy of the caller, i.e. <code>this : self&amp;lr</code>.</p>
</div>
<div class="paragraph">
<p>Otherwise, if the containing type is a reference type, then <code>this</code> is a read-only reference to the caller, i.e. <code>this : mut&lt;self&gt;&amp;cr</code> or <code>this : const&lt;self&gt;&amp;cr</code>.
The mutability of <code>this</code> in a reference type method is controlled with a method mutability modifier, e.g. <code>mut decl foo()</code>.
Read more about mutability in <a href="#_classes">Section 18.2, &#8220;Classes&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>A static function may also be called on a type using the same methods-call syntax, e.g. <code>(obj : T)::func()</code> \$-=\$ <code>T::func()</code> \$-=\$ <code>T.func()</code>.
Nothing is implicitly passed to such a call.
This behaviour is also applicable to the static field access syntax, e.g. <code>obj::ref</code> \$-=\$ <code>T::ref</code> \$-=\$ <code>T.ref</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_methods"><a class="link" href="#_methods">14.3. Methods</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">method</dt>
<dd>
<p>A function member declared in a data type accepting an instance of the type (or a pointer to an instance of the type if the type is a by-ref type) as the first anonymous argument. Also see <a href="https://en.wikipedia.org/wiki/Uniform_Function_Call_Syntax">UFCS</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A function declared with an <code>instance</code> scope modifier, which is the implicit default for a function declaration within a data type declaration, is similar to a function declared with a <code>static</code> scope modifier with the very first argument declared as <code>this : self</code> or <code>&amp;this : self*cr</code>, based on the type kind.</p>
</div>
<div class="paragraph">
<p>For example, <code>decl foo()</code> in a struct declaration would be similar to <code>static decl foo(this : self)</code>.</p>
</div>
<div class="paragraph">
<p>Consequently, <code>this : self&amp;lr</code> or <code>this : self&amp;cr</code> is implicitly defined within a function declared with an <code>instance</code> scope modifier, referring to the implicit argument declaration.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to have a custom-scoped or custom-acessible <code>this</code>, consider declaring a statically-scoped function with the argument restriction you need.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An identifier lookup within such a function adds <code>this.</code> after the local scope lookup.
For example, if <code>x</code> is not found in the local scope, it is then attempted to be qualified as <code>this.x</code>.
Note that a local identifier can shadow an instance reference.</p>
</div>
<div class="paragraph">
<p>A method is declared using one of the following semantics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct T <span class="silver"># Or `class T`</span>
  decl method(args) <span class="silver"># `instance decl` is implied</span>
  static decl method(this : self, args) <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
end

decl T:method(args)
decl T::method(this : T, args) <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To qualify as a method, only the type of the first argument matters.
Therefore, it may be named other than <code>this</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>this : T</code> shall be changed to <code>this : T*cr</code> for a by-ref type to qualify as a method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A method may be called on an object using one of the following semantics:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">obj.method(args)
obj::method(obj, args) <span class="silver"># Or `(&amp;obj, args)` if called on a by-ref type</span>
T::method(obj, args)   <span class="silver"># Ditto</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As any other function call, a method call requires parentheses even with zero arity.</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. By-val type methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Point
  val x, y : FBin64

  def append(another : self)
    return self(
      # `this` is implicitly declared in a method,
      # referring to the instance copy.
      x: ((this : self&amp;lr).x : FBin64&amp;lr) + another.x,

      # An identifier lookup starts from `this.`.
      y: y + another.y)
  end

  # # Could've been declared as a static function instead.
  # static threadsafe def append(that : self, another : self) : self
  #   return self(that.x + another.x, that.y + another.y)
  # end
end

def main
  final p = Point(1, 2)
  @assert(p.length() ~= 2.24)
  # @assert(p::length(p) ~= 2.24)     # Ditto
  # @assert(Point::length(p) ~= 2.24) # Ditto
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Class methods have <code>this.field</code> syntactic sugar for an argument declaration, which expands to the field assignment.
For example, <code>impl Foo::initialize(this.x);</code> sets <code>x</code> to <code>42</code> upon calling <code>Foo(42)</code> before executing the function body.</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. By-ref type methods</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class Foo
  let x : SBin32

  # An initializer implementation
  # is required for a class.
  impl initialize(this.x);

  # `mut` defines mutability of `this`.
  mut def double_x()
    # Ditto for lookup.
    #
    # Note how `.x` it returns a writeable
    # reference even if `this` is read-only.
    # This behaviour is related to mutability.
    (x : SBin32&amp;crw) += (this : self&amp;cr).x
  end

  # # Could've been implemented as a static function instead.
  # static threadsafe def double_x(&amp;this : mut&lt;self&gt;*cr) : SBin32
  #   return this.x *= 2
  # end
end

def main
  final f = mut Foo(42)

  f.double_x()
  # f::double_x(&amp;f)   # Ditto
  # Foo::double_x(&amp;f) # Ditto

  @assert(f.x == 84)
end</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arguments"><a class="link" href="#_arguments">15. Arguments</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Function and generic arguments share the same syntax.
An argument requires an explicit name or index.
An argument may have an alias, a type restriction and a default value.</p>
</div>
<div class="paragraph">
<p>A function argument declaration has the same semantics as a value declaration.
By default, a function argument is implicitly constant, i.e. <code>def foo(x)</code> is equivalent to <code>def foo(final x)</code>.
Alternatively, an argument value may be declared variable: <code>def foo(let x)</code>.
It is not possible to pass a constant as a variable argument.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A constant value may be unsafely cast to a variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo(let arg);
final x = 42
foo(unsafe! x.as(SInt32&amp;w))</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_types"><a class="link" href="#_types">16. Types</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Types are namespaces, traits, units, structs, classes, enums and annotations.
The classification is known as a <em>type kind</em>.
Structs, classes and enums are known as <em>data types</em>; their instances, called <em>objects</em>, may exist in runtime.</p>
</div>
<div class="sect2">
<h3 id="_type_instances"><a class="link" href="#_type_instances">16.1. Type instances</a></h3>
<div class="paragraph">
<p>A <em>type instance</em> is an instance of a type itself, e.g. <code>let x : \SInt32 : Type&lt;SInt32&gt; = SInt32</code>.</p>
</div>
<div class="paragraph">
<p>A type instance may be used in runtime, have its static members accessed (including initialization and comparison to other types), and even used as a generic argument.</p>
</div>
<div class="paragraph">
<p>A type instance by itself does not carry any type information in runtime.</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Type instances</div>
<div class="content">
<div class="listingblock">
<div class="title">A freestanding type instance</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = SBin32

@assert(@typeof(x) == \SBin32)
@assert(@sizeof(x) == 0)

@assert(x == SBin32)      # Calling a static function `::==(another_type)`
@assert(x&lt;Bitsize&gt; == 32) # Accessing a generic argument
@assert(x(42) == 42i32)   # Calling a static function `::()`
@assert(x::Max == 2147483647i32) # Accessing a static reference

# def foo(x : \T) forall T ~ SInt;
def foo(x ~ \SInt);

foo(x) # OK, equivalent to `foo(SBin32)`</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">A variant of type instances</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = Std@rand(SBin32, FBin64)
x : &lt;\SBin32, \FBin64&gt;?&amp;lrw

if x is? \SBin32
  @assert((x as SBin32)(42) == 42i32)
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_literal_instances"><a class="link" href="#_literal_instances">16.2. Literal instances</a></h3>
<div class="paragraph">
<p>A type instance may be a literal instance.
A literal instance has basic arithmetic functions and can be used both as a generic and runtime argument.</p>
</div>
<div class="paragraph">
<p>A literal instance has type <code>Literal&lt;\$L\$&gt;</code>, where <code>\$L\$</code> is a literal constrainment from <a href="#table-literal-constrainments">Table 1, &#8220;Basic literal constrainments&#8221;</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generic_types"><a class="link" href="#_generic_types">16.3. Generic types</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Data type</dt>
<dd>
<p>A struct, class or a enum type.</p>
</dd>
<dt class="hdlist1">Object</dt>
<dd>
<p>An instance of a data type, existing in runtime.</p>
</dd>
<dt class="hdlist1">By-val type</dt>
<dd>
<p>A struct or a enum type.</p>
</dd>
<dt class="hdlist1">By-ref type</dt>
<dd>
<p>A class or <code>Lambda</code> type.</p>
</dd>
<dt class="hdlist1">Generic type</dt>
<dd>
<p>A type containing at least one generic argument.</p>
</dd>
<dt class="hdlist1">Type reference</dt>
<dd>
<p>A reference to a type with or without generic arguments from the source or macro code, e.g. <code>SBin&lt;32&gt;</code> or <code>Std</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A generic type is a type containing at least one generic argument.
A generic argument may be used within the type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_specialization"><a class="link" href="#_type_specialization">16.4. Type specialization</a></h3>
<div class="paragraph">
<p>Qualification of an identifier (i.e. a lookup) under a type reference triggers the reference <em>specialization</em>.
A specialization occurs once per unique generic arguments combination.
An omitted generic argument is valid, has <code>nil</code> value in macros, and contributes into the uniqueness.
A non-generic type may have at most one specialization.</p>
</div>
<div class="paragraph">
<p>A specialization triggers evaluation of delayed macros contained directly within the type declaration.</p>
</div>
<div class="paragraph">
<p>A delayed macro contained directly within a struct or class type declaration may evaluate to an instance field implementation.</p>
</div>
<div class="paragraph">
<p>A specialization of a struct or class child type triggers specialization of its parent.</p>
</div>
<div class="paragraph">
<p>A specialization of a deriving type triggers specialization of all the traits it derives from, in the order of derivation.</p>
</div>
<div class="paragraph">
<p>A <em>complete type</em> is a data type reference specialized with defined occupied size, or a unit type reference (which always has zero size).
Any other type is <em>incomplete type</em>.</p>
</div>
<div class="paragraph">
<p>Only a complete type shall be used as a runtime value type.
However, an incomplete type instance is allowed, e.g. <code>let x : \SInt = SInt</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_members"><a class="link" href="#_members">16.5. Members</a></h3>
<div class="paragraph">
<p>A type reference may contain <em>member</em> entities: functions, macros, values and types.
This classification is known as <em>member kind</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In that sense, every type is a name-space.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Function and value members have <em>storage</em>, which is either <em>instance</em> or <em>static</em>.
In a trait, struct, class or enum type declaration, a function or value member declaration has implicitly instance storage, which may be changed to static.
However, a enum type declaration disallows instance value member declarations, therefore it shall be explicitly set to static.
In a namespace, unit or annotation type declaration, a function or value member declaration always has static storage, and it shall not be changed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_behavioural_erasure"><a class="link" href="#_behavioural_erasure">16.6. Behavioural erasure</a></h3>
<div class="paragraph">
<p>With constraints applied to a value a compiler may or may not be able to interact with it in certain ways, e.g. call a specific method.
This is known as a <em>behavioural erasure</em>.</p>
</div>
<div class="paragraph">
<p>Both real and erasured types of a value are always known.</p>
</div>
<div class="paragraph">
<p>Any type (including special types like <code>Type</code>, <code>Void</code> etc.) has built-in <code>is?</code>, <code>of?</code> and <code>as</code> methods defined, collectively known as <em>reflection methods</em>.
Reflection methods are well-known and may be used as binary operators, e.g. <code>x is? T</code>.
<code>is?</code> and <code>of?</code> shall not be used as function names, i.e. overloaded.
<code>as</code> may be overloaded, e.g. for <code>0.5.as($float)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># Determine if the instance
# is of exactly type `T`.
#
# ```
# x = 42
# @assert(x is? SInt32)
# ```
decl is?(\T) : Bool forall T
alias :? = is? # E.g. `x :? T`

# Determine if the instance is of
# a type less than or equal to `T`.
#
# ```
# x = 42
# @assert(x of? Int)
# ```
decl of?(\T) : Bool forall T
alias ~? = of? # E.g. `x ~? T`

# Return the instance itself.
decl as(\self) : self

# Unsafely coerce the instance as
# an instance of another type.
unsafe decl as(\T) : T forall T</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reflection methods affect behavioural erasure of a entity.
<code>as</code> becomes a fragile method when a compiler can prove it is not unsafe.</p>
</div>
<div class="paragraph">
<p>A value may be constrained using <code>:</code> and <code>~</code> binary operators, whereas <code>:</code> requires right operand to be a complete type.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>In this example, a well-known type <code>SInt32</code> is behaviour-erasured, so we can&#8217;t access the constant <code>Max</code>, which is only defined for sized `SInt`s.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x : SInt32 = 42 # `x` is constrained to `SInt32`
@assert(x::Max == 4_294_967_295) # OK

# # We're constraining `x` to `SInt`, and then
# # try to access its `::Max` constant
# x~SInt::Max # Panic! `Max` is not defined for `SInt`

# Constraining to `SInt` in the current scope.
# Now the compiler treats `x` as `SInt`,
# but its true type is still preserved.
x = x ~ SInt
@typeof(x) # =&gt; SInt (SInt32) # Compiler still knows the real type

@assert(x ~ SInt)
# x::Max # Panic! Ditto

# `~SInt` could theoretically be `SInt32`,
# and we can check it in runtime.
# A compiler may elide the actual comparison.
if x :? SInt32
  @assert(x::Max == 4_294_967_295)
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An unconstrained generic argument has implicit type <code>Any</code>.
An <code>Any</code> type instance does not allow any access other than reflection method calls.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo(x : T) forall T # eq. to `forall T ~ Any`
  # During the initial parsing,
  # no real type is present
  @typeof(x)  # =&gt; Any

  # Actual type is revealed during a
  # specialization, but it's still erasured
  \@typeof(x) # =&gt; Any (SInt32)

  # x += 1 # Panic! `Any` does not have method `+`

  if x :? SInt32
    \@typeof(x) # =&gt; SInt32 # No erasure is applied anymore
    x += 1 # OK
  end
end

foo(42i32)</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Behavioural erasure ignores any definitions from other than the constrained scope.
The code in the example below would continue working even if added the <code>Drawable3D</code> trait to <code>Line</code>, or introduced an entirely new <code>Drawable4D</code> trait and derived it from both of the structs.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">trait Drawable2D
  decl draw()
end

trait Drawable3D
  decl draw()
end

# Point has the following methods:
#
# ```
# final p = Point()
# p.draw2d()
# p.draw3d()
# p~Drawable2D.draw()
# p~Drawable3D.draw()
# p.draw() # Panic! `Point:draw` is ambuguous between
#          # `Point~Drawable2D:draw` and `Point~Drawable3D:draw`
# ```
struct Point
  derive Drawable2D
    # Callable as `Point~Drawable2D:draw`
    # and `Point:draw2d`
    impl draw() as self.draw2d;
  end

  derive Drawable3D
    # Callable as `Point~Drawable3D:draw`
    # and `Point:draw3d`
    impl draw() as self.draw3d;
  end
end

# Line has the following methods:
#
# ```
# final l = Line()
# l.draw()
# l~Drawable2D.draw()
# ```
struct Line
  derive Drawable2D
    impl draw()
  end
end

def draw2d(x : T) forall T ~ Drawable2D
  @typeof(x) # =&gt; Drawable2D
  \@typeof(x) # =&gt; Drawable2D (Point) # Or `Line`

  x.draw() # OK, `:draw` is defined for any `Drawable2D`
  # x.draw2d() # Panic! `:draw2d` is not defined for `Drawable2D`

  if x is? Point
    \@typeof(x) # =&gt; Point (Point)
    x.draw2d() # OK, can call `Point`-specific method
  end
end

draw2d(Point())
draw2d(Line())</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Either in the form of a type annotation, or as a binary operator, a restriction operator contributes into the return-type overloading.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def read() : String*
def read() : Std::Twine

# let x = read() # Panic! Can not infer type of `x`

let x : String* = read() # OK
let x = read() : Std::Twine # OK

# Still enough information to
# unambiguously choose an overload.
let x : Pointer = read()
@typeof(x) # =&gt; Pointer (String*) # The value is erasured, however
x as String* # The coercion is safe here</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_expressions"><a class="link" href="#_type_expressions">16.7. Type expressions</a></h3>
<div class="paragraph">
<p>A <em>type expression</em> consists of multiple type references joined with logical operators <code>&amp;&amp;</code>, <code>||</code>, <code>^</code>, <code>!</code> and grouped with parentheses.
A freestanding type reference is a degenerate case of a type expression.
A type expression containing at least one logical operator is a <em>complex type expression</em>.</p>
</div>
<div class="paragraph">
<p>A type expression may be <em>flattened</em> to a comma-separated list of currently specialized complete types matching the expression using the <code>*</code> unary operator.
For example, <code>*(SInt &amp;&amp; !SInt32)</code> would likely evaluate to <code>SInt8, SInt16, SInt64, SInt128</code> (note the missing <code>SInt32</code>).
A flattened list of types may be used as a list of generic arguments, for example, <code>Union&lt;*(SInt32 || FBin64)&gt;</code> would evaluate to <code>Union&lt;SInt32, FBin64&gt;</code>.
As a syntactic sugar, a freestanding complex type expression or a freestanding flattened list turns into a <code>Variant</code> of types contained in the flattened expression, e.g. <code> ||  : *( || ) : Variant&lt;*( || )&gt;</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A type expression may be flattened to a list of complete types already specialized at the moment; it does not include unspecialized yet type references.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Flattening a type expression is aligned with flattening a tuple type, e.g. <code>Union&lt;*(A, B)&gt; : Union&lt;A, B&gt;</code>.</p>
</div>
<div class="paragraph">
<p>A wildcard type may be used within a type expression, for example <code>* &lt; </code> means "all types satisfying the <code>&lt; </code> condition".
A <code>T::*</code> expression would match all types directly under the <code>T</code> namespace, for example <code>T::A</code>, but not <code>T::B::C</code> or <code>T</code>.
A <code>T::**</code> expression would match all types under the <code>T</code> namespace, for example <code>T::A</code> and <code>T::B::C</code>, but not <code>T</code>.
These may be combined, e.g. <code>T::** &lt; (U &amp;&amp; V)</code>.
A result of an expression containing a wildcard is a flattened list of matching types.
Hence, <code>*(A &amp;&amp; B)</code> is equivalent to <code>* &lt; (A &amp;&amp; B)</code>.</p>
</div>
<div class="paragraph">
<p>A type expression may be enumerated upon using mapping (<code>&#8594;</code>), filtering (<code>-?&gt;</code>) and negative filtering (<code>-!&gt;</code>) operators.</p>
</div>
<div class="paragraph">
<p>A mapping block is not a "logic" complex type expression, but rather an <em>algebraic type expression</em>, where types are operated upon using <code>&lt;</code>, <code>&lt;~</code>, <code>&#8656;</code>, <code>==</code> etc. built-in operators, and the mapped type is referenced with <code>$</code> or <code>$0</code> (which is aligned with anonymous block arguments syntax).</p>
</div>
<div class="paragraph">
<p>Filtering and negative filtering blocks are complex type expressions, where the filtered type is matched.</p>
</div>
<div class="paragraph">
<p>An example of an enumeration would be <code>: *(AbstractLogger)-!&gt;(UnwantedLogger)&#8594;$&amp;</code>, which evaluates to a variant of pointers to all  <code>AbstractLogger</code> specializations known at the moment of specialization, excluding the <code>UnwantedLogger</code> type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_restriction"><a class="link" href="#_type_restriction">16.8. Type restriction</a></h3>
<div class="paragraph">
<p>Runtime values (which includes function return values) can be restricted to a concrete type using the <code>: T</code> notation, where <code>T</code> is a type expression.
Such a restriction is a <em>concrete type restriction</em>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The notation is similar to the one used in the Type Theory, e.g. \$2 : nat\$.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a restriction type expression contains generic arguments, they are checked against sequentially and recirsively in the order of declaration in the restriction.
For example, in <code>x : Array&lt;Size: 3, Element: Foo&lt;Bar&gt;&gt;</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that <code>x</code> is <code>Array</code></p>
</li>
<li>
<p>Ensure that <code>x::&lt;Size&gt;</code> is <code>3</code></p>
</li>
<li>
<p>Ensure that <code>x::&lt;Element&gt;</code> is <code>Foo</code></p>
</li>
<li>
<p>Ensure that <code>x::&lt;Element&gt;::&lt;[0]&gt;</code> is <code>Bar</code></p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A tuple is simply a generic type with its types listed as generic arguments.
If a restriction is a tuple, its elements are checked sequentially, e.g. in <code>x : (A, B)</code>, <code>x</code> must be a tuple of two types <code>A</code> and <code>B</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A generic argument may be restricted to a type instance or a literal.
For example, <code>Foo&lt;T : \U || 42 || \%s&gt;</code> would only allow <code>Foo&lt;U&gt;</code>, <code>Foo&lt;42&gt;</code> or <code>Foo&lt;"bar"&gt;</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>Foo&lt;T : U&gt;</code> would be invalid.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a type restriction is applied to a argument declaration, it is said that the declaration is <em>type-annotated</em>; the restriction <em>defines</em> the type of the argument.</p>
</div>
<div class="paragraph">
<p>When a type restriction is applied to runtime expression, it is used as a binary operator; the restriction is used to <em>ensure</em> the type of the expression.
A restriction binary operator returns the left operand on success, panicking otherwise.</p>
</div>
<div class="paragraph">
<p>There are also soft-check versions of restriction binary operators: <code>:?</code> / <code>is?</code> and <code>~?</code> / <code>of?</code>, which evaluate to a boolean value.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x : SInt32 = 42 # A type-annotated variable definition
Std.print(x : SInt32) # Ensure that `x` is `SInt32`

# Soft-check if `x` is `SInt32`.
# Would possibly evaluate to the `true` literal
if x :? SInt32
  Std.print("`x` is always `SInt32`")
else
  Std.print("`x` is always not `SInt32`")
end

# An algebraic expression
# is applicable here.
if @typeof(x) == SInt32
  Std.print("`x` is always `SInt32`")
else
  Std.print("`x` is always not `SInt32`")
end

let y = Std@rand(42, 0.5) : Variant&lt;SInt32, FBin64&gt;

# Soft-check if `y` is currenty `SInt32`.
# Would perform a runtime check.
#
# NOTE: It calls `.is?(SInt32)` on
# the actual option of the variant.
if y is? SInt32
  Std.print("`y` is currently `SInt32`")
else
  Std.print("`y` is currently `FBin64`")
end

# An algebraic expression is not applicable here,
# because `@typeof` evaluates in compile-time, so
# `@typeof(x)` would always be `Variant&lt;SInt32, FBin64&gt;`.
if @typeof(x) == SInt32 # Would always evaluate to `false`
  @unreacheable
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_fuzzy_type_restriction"><a class="link" href="#_fuzzy_type_restriction">16.9. Fuzzy type restriction</a></h3>
<div class="paragraph">
<p><code>: T</code> is a concrete type restriction, whereas <code>~ T</code> is a <em>fuzzy type restriction</em>.</p>
</div>
<div class="paragraph">
<p>A concrete restriction requires the expression to evaluate to a concrete type, whereas a fuzzy restriction does not.
Instead, a fuzzy restriction requires the restricted value type to be <em>either</em> of concrete types matching the type expression.
For example, <code>~ SInt</code> matches any <code>SIntN</code>, where <code>N</code> is bitsize.</p>
</div>
<div class="paragraph">
<p>Therefore, a fuzzy restriction shall not be used as a field or local value type annotation.
But if it is used as an argument declaration type annotation, (a) it leads to specialization for every matching type, (b) it may use polymorphism.</p>
</div>
<div class="paragraph">
<p>DRAFT: When a type is fuzzy-restricted, you can not query its real type?
So this is orthogonal to a concrete type restriction.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_namespaces"><a class="link" href="#_namespaces">17. Namespaces</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A namespace type may only contain static functions and values.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_types"><a class="link" href="#_data_types">18. Data types</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A data type defines meaning of a runtime value.
It may be a user-defined or anonymous struct, class or enum, or a primitive such as an array, tuple, vector, scalar number etc.
Namespace and trait types are not data types.</p>
</div>
<div class="sect2">
<h3 id="_structs"><a class="link" href="#_structs">18.1. Structs</a></h3>
<div class="paragraph">
<p>A struct is a user-defined named container of named <a href="#_references">references</a>.</p>
</div>
<div class="paragraph">
<p>A struct is defined using the <code>struct</code> keyword, e.g. <code>struct Foo</code>.
See <a href="#_entities">Section 7, &#8220;Entities&#8221;</a> for more info about defining entities.</p>
</div>
<div class="paragraph">
<p>As any other type declaration, a struct allows static member declarations.
Static reference and function member declarations within a struct require an explicit <code>static</code> scope modifier.</p>
</div>
<div class="paragraph">
<p>Instance-scoped references, i.e. fields, in a struct are defined using the <code>val</code> statement, e.g. <code>val x : FBin64</code>.
A <code>val</code> statement does not have a scope.
<a href="#_accessibility">Accessibility</a> of a field depends on the containing struct&#8217;s.
For example, if <code>strukt</code> is read-only, then <code>strukt.x</code> would also be read-only.
A <code>val</code> statement is not allowed to have a default value clause.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>val</code> keyword is chosen over <code>let</code> to reflect the dependant accessibility nature, whereas <code>let</code> implies always being both readable and writeable.
Otherwise, <code>val</code> has semantics similar to <code>let</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A function declared within a struct with the implicit default <code>instance</code> scope modifier becomes a method with a <code>this : self&amp;lr</code> local constant available within the body representing a copy of the caller.
Consequently, qualification of identifiers within a method&#8217;s body implies the <code>this.*</code> lookup.
Read more in <a href="#_methods">Section 14.3, &#8220;Methods&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>A struct type implements a default trivial initializer accepting field values in the order of declaration.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># `complete public def struct Point` is implied.
struct Point
  val x, y : FBin64

  # `instance public def length()` is implied.
  def length
    (x ** 2 + this.y ** 2).sqrt()
  end

  # Use a static function to implement
  # a custom initialization logic.
  static def zero
    self(0, 0)
  end
end

def main
  # A basic literal initialization
  final p1 = Point{ 1, 2 }
  @assert(p1.length() ~= 2.23)

  # A static function call
  final p2 = Point::zero()
  @assert(p2.length() == 0)

  # Using of an uninitialized instance
  final p3 = unsafe! uninitialized Point
  p3.x = 1
  # p3.length() # UB
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A struct type does not declare a <code>finalize</code> method.
But it still has lifetime and finalizes its fields in the order of declaration once it dies.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Even if a <code>finalize</code> method is declared in a struct, it won&#8217;t be called automatically.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once a struct is implemented with a <code>complete</code> completeness modifier (which is the default implicit one), it can not have new fields declaration.
But it may be further <a href="#_reopening">reopened</a> to have new methods declared.
A struct implemented with an explicit <code>incomplete</code> completeness modifier can not be initialized, but allows further reopenings to declare new fields.</p>
</div>
<div class="paragraph">
<p>A struct declared with an <code>abstract</code> modifier shall never be directly initialized.
Further reopenings of the struct shall also include the <code>abstract</code> modifier.</p>
</div>
<div class="paragraph">
<p>A struct has undefined ordering of elements in memory unless annotated with <code>@[Ordered]</code>.
It also has undefined alignment unless annotated with <code>@[Aligned]</code>.
A struct may be packed by applying the <code>@[Packed]</code> annotation.</p>
</div>
<div class="paragraph">
<p>A struct may extend another struct at most once.
Only a (currently) complete struct may be extended.
An extending struct default initializer contains all the fields in the order of declaration.
Memory boundaries of an extended struct are guaranteed to precede the extending&#8217;s.
Therefore, an extending struct may be thread-safely coerced into the extended one.
Extending a struct does not inherit its static members.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">abstract struct Parent
  # The ordering of `a` and `b` is undefined.
  # For example, `b` may actually precede `a`.
  val a : SBin32
  val b : FBin64

  def sum
    a.to_f64() + b
  end

  static def noop;
end

# `&lt;` is a shortcut for `extend Parent;`
struct Child &lt; Parent
  # The ordering of `c` and `d` is also undefined.
  # However, `a` and `b` are guaranteed to precede `c` and `d`.
  val c, d : UBin16

  reimpl sum
    Parent::noop() # Static members are not inherited
    super() + c.to_f64() + d.to_f64()
  end

  # # Would not trigger name collision.
  # static def noop;
end

def main
  # Child::noop() # Panic! `Child::noop()` is not declared

  # Note the augmented default initializer
  final c = Child(1i32, 2f64, 3u16, 4u16)
  @assert(c.sum() == 10)
  @assert(c~Parent.sum() == 3)

  # This is a threadsafe operation
  final p = c as Parent

  # Note that `Parent` is `abstract`, but it
  # still can be "initialized" indirectly
  @assert(p.sum() == 3)
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_classes"><a class="link" href="#_classes">18.2. Classes</a></h3>
<div class="paragraph">
<p>Class semantics is the way to do object-oriented programming in Onyx.
A class implies incapsulation and resource control.</p>
</div>
<div class="paragraph">
<p>A class type does not have a literal initializer defined.
Instead, it may have multiple <code>initialize</code> method declarations which are delegated to upon a <code>Klass()</code> call.
All fields without default values shall be initialized in every <code>initialize</code> method implementation.
Despite of a defined <code>initialize</code> method safety, a <code>Klass()</code> call is always threadsafe.</p>
</div>
<div class="paragraph">
<p>A class type may have its fields declared using the familiar <code>let</code> and <code>final</code> statements, as well as class-specific <code>get</code> and <code>set</code> statements.
The latter two only allow certain accessibility from the observer&#8217;s point of view, but the field is fully accessible from the class itself.
Class field declarations allow default values and visibility modifiers.
A <code>final</code> field declaration shall not be changed after set in an <code>initialize</code> method, or to its default value.</p>
</div>
<div class="paragraph">
<p>Class method declarations allow special <code>this.field</code> argument declaration syntax, which is a syntactic sugar for accepting and rewriting a field value in the very beginning of the method&#8217;s body.</p>
</div>
<div class="paragraph">
<p>By default, class field and method declarations have an implicit <code>private</code> visibility modifier.</p>
</div>
<div class="paragraph">
<p>A class instance has lifetime and it finalizes all its fields upon death, in the order of declaration.
An explicit <code>finalize()</code> method may be defined, which would be called prior to finalizing them fields.
Despite of the defined <code>finalize()</code> method safety, an implicit finalization of a class instance is always threadsafe.</p>
</div>
<div class="paragraph">
<p>TODO: Mutability.
TODO: Traits.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">mut class Car
  # A publicly-visible variable field.
  public let acceleration : FBin64

  # A publicly-visible field which shall not
  # be changed after set in an `initialize` method.
  # Note that it does not have a default value,
  # thus shall be set in every `initialize` method.
  public final max_speed : FBin64

  # This field may only be read from the
  # outside, i.e. `car.velocity : FBin64&amp;r`,
  # but it's fully accessible from the
  # inside, i.e. `this.velocity : FBin64&amp;crw`.
  #
  # TODO: The declaration type restriction is implicitly
  # `: Infer`, which immediately expands to `: FBin64`.
  public get velocity = 0f64

  # This variable is only visible within the class itself.
  let resources : $void*

  # This is marked unsafe to avoid duplicate resource acquisition.
  public unsafe def initialize(this.max_speed, acceleration = 0)
    threadsafe!
      this.acceleration = acceleration
      resources = unsafe! $malloc(100)
    end
  end

  # A public function to update the car's
  # velocity based on its acceleration.
  public def update(time_passed: `)
    velocity = (velocity + acceleration * `).max(max_speed)
  end

  # Ditto for duplicate resource deallocation.
  # Note that this definiton is private so we
  # don't accidentaly manually call it.
  unsafe def finalize
    $free(resources)
  end
end

def main
  final car = Car(100)
  car.acceleration = 10
  car.update(time_passed: 3)
  @assert(car.velocity == 30)
end</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enums"><a class="link" href="#_enums">18.3. Enums</a></h3>
<div class="paragraph">
<p>A enum type is a collection of named integer values.</p>
</div>
<div class="paragraph">
<p>By default, an underlying type of a enum is <code>SInt32</code>, but it can be changed explicitly, e.g. <code>enum Foo : UInt16</code>.
Only a <code>Int</code> type may be a enum underlying type.</p>
</div>
<div class="paragraph">
<p>The very first defined enum value has an implicit underlying value of zero.
Each enum value defined is implicitly incremented by one from the previous defined value.
A enum value definition may have an explicit underlying value assigned, e.g. <code>val Foo = 3</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For Rust-like enums, create a distinct alias for a Variant.</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Rust-like enums</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">distinct alias MyRustEnum = Variant&lt;SInt32, Vector&lt;FBin64, 2&gt;&gt;
  def product : SInt32 || FBin64
    if this.is?(SInt32)
      return this.as!(SInt32)
    else
      return this.as!((FBin64)x2).product()
    end
  end
end</code></pre>
</div>
</div>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_built_in_types"><a class="link" href="#_built_in_types">19. Built-in types</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_variants"><a class="link" href="#_variants">19.1. Variants</a></h3>
<div class="paragraph">
<p>A variant is a <a href="#_unions">union</a> of values (called <em>options</em>) with an unsigned integer switch determining its actual option.</p>
</div>
<div class="paragraph">
<p>Akin to a union, the order of options in a variant is irrelevant, i.e. <code>Variant&lt;\$"A"\$, \$"B"\$&gt; == Variant&lt;\$"B"\$, \$"A"\$&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Internal layout of a variant is undefined.</p>
</div>
<div class="paragraph">
<p>An access to a variant in runtime is first attempted on the variant instance itself, and then transparently delegated to its actual option.
Therefore, an accessed member shall be implemented for every option of the variant.</p>
</div>
<div class="paragraph">
<p>The rule also applies to built-in methods <code>is?</code>, <code>of?</code> and <code>as!</code>.</p>
</div>
<div class="paragraph">
<p>An <code>as!</code> call is threadsafe on a local-scoped reference, or fragile on a statically-scoped reference, to a variant which is proved to have a concrete option.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>A simple example demonstrating access to a variant&#8217;s options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo { decl x() }
struct Bar { decl x(); decl y() }

final var = Std@rand(Foo(), Bar()) : Variant&lt;Foo, Bar&gt;
var.x() # OK, declared for both options
# var.y() # Panic! `y` is not declared for `Foo`

# A `.switch()` call returns an unsigned integer with
# minimum required bitsize to store the variant switch.
@assert(var.switch() :? UBin1)

# Calling `.as!()` is unsafe here,
# because there is no compile-time
# information to guarantee that
# `var` is actually `Bar`.
unsafe! var.as!(Bar).y()

if var.is?(Bar)
  # Here, a compiler is able to proof
  # that `var` is currently `Bar`, thus
  # the `.as!(Bar)` call is threadsafe.
  var.as!(Bar).y()

  # Note that `var` itself is still a variant.
  var = Foo()

  # # A compiler knows that the variant
  # # can not currently be `Bar`.
  # var.y() # Panic!
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Passing a variant outside of Onyx context has no defined semantics, but totally feasible.
The example may be further improved using macros.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">export union val_t {
  int int_v;
  double double_v;
};

export struct var_t {
  int sw;
  union val_t un;
};

export enum SWITCH {
  INT,
  DOUBLE
};

export struct var_t get_variant() {
  final var = Std@rand($int(42), $double(42)) : Variant&lt;$int, $double&gt;

  return case var
    when $int
      $var_t(
        sw: $SWITCH::INT,
        un: $val_t(int_v: var.as($int)))
    when $double
      $var_t(
        sw: $SWITCH::DOUBLE,
        un: $val_t(double_v: var.as($double)))
  end
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lifetime"><a class="link" href="#_lifetime">20. Lifetime</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>TODO: A structure is finalized on the containing scope side.
If a class has a <code>finalize()</code> method definition, it is called prior to finalizing its fields.
The <code>NoFinalize</code> annotation may be unafely applied to a reference to skip finalization at the end of the reference&#8217;s lifetime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># If want to move just an
# element of a structure
#

@[unsafe! NoFinalize]
final ary = [1, 2, 3]

final x = @rand(2)
final moved &lt;- ary[x]

ary.each -&gt; |e, i|
  if i != x
    @finalize(e)
  end
end

return moved</code></pre>
</div>
</div>
<div class="paragraph">
<p>TODO: Only identified references with local scope are finalized.
For example, in <code>let e = &amp;ary[0]</code>, <code>*e : T&amp;lrw</code> is not an identified reference.
Should think better on the naming: <code>let x = 42</code>, <code>x</code> is an identified reference, i.e. has memory in the current scope.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_piping"><a class="link" href="#_piping">21. Piping</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A entity may be piped to reduce code duplication.</p>
</div>
<div class="paragraph">
<div class="title">A "self-pipe"</div>
<p>An <code>x |</code> expression expands to <code>(x; x)</code>.
For example, <code>x |.y = 42</code> &#8594; <code>(x.y = 42; x)</code>.
\$E\$ must be either a lookup (<code>|:</code>, <code>|::</code>) or a method call (<code>|.</code>).
No whitespace is allowed after <code>|</code> to avoid confusion with a binary operator <code>|</code>.
To control precedence, use parentheses.
For example, <code>x |.a = b |.foo</code> &#8594; <code>(x.a = (b.foo; b); x)</code>, but <code>x |.a=(b) |.foo</code> &#8594; <code>((x.a = b; x).foo; x)</code>.</p>
</div>
<div class="paragraph">
<div class="title">A "block pipe"</div>
<p>An <code>x |&gt; </code> expression expands to <code>()</code>, where \$E\$ is a block of code with a single anonymous block argument <code>x</code>.
For example, <code>x |&gt; foo($)</code> &#8594; <code>(foo(x))</code>.
Unlike self-pipes, block pipes are always "flat", e.g. <code>x |&gt; $.foo |&gt; $.bar</code> expands to <code>((x.foo).bar)</code>.
Therefore, the block pipes concept is similar to POSIX pipes.</p>
</div>
<div class="paragraph">
<div class="title">A "tapping pipe" or "self-returning block pipe"</div>
<p>An <code>x &lt;|&gt; </code> expression is similar to block pipe, but it expands to <code>(; x)</code>, returning the argument.
For example, <code>x &lt;|&gt; foo($)</code> &#8594; <code>(foo(x); x)</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The name is after Ruby&#8217;s <code>#tap</code> method.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 10. Piping</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">x
  |.foo     # Simple pipe, returns `x`
  |&gt; $.bar  # Block pipe, returns the evaluation result
  &lt;|&gt; $.baz # Tapping pipe, returns the argument (`x.bar`)

  # A multi-line block pipe version
  # with block boundaries and prologue
  |&gt; |(arg)| do
    qux(arg)
  end

# Is equivalent to:
#

final %%0 = ((x.foo; x).bar)
qux((%%0.baz; %%0))</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-08-23 16:24:39 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    skipTags: ["script", "noscript", "style", "textarea"],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>