<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Onyx Programming Language Reference</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Onyx Programming Language Reference</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_foreword">Foreword</a>
<ul class="sectlevel2">
<li><a href="#_the_onyx_programming_language">The Onyx programming language</a></li>
<li><a href="#_reference_conventions">Reference conventions</a></li>
<li><a href="#_current_state">Current state</a></li>
</ul>
</li>
<li><a href="#_compilation">1. Compilation</a>
<ul class="sectlevel2">
<li><a href="#_onyx_source_files">1.1. Onyx source files</a></li>
<li><a href="#_c_source_files">1.2. C source files</a></li>
</ul>
</li>
<li><a href="#_comments">2. Comments</a>
<ul class="sectlevel2">
<li><a href="#_documentation">2.1. Documentation</a></li>
<li><a href="#_comment_intrinsics">2.2. Comment intrinsics</a></li>
<li><a href="#_comment_styling">2.3. Comment styling</a></li>
</ul>
</li>
<li><a href="#_scope">3. Scope</a>
<ul class="sectlevel2">
<li><a href="#_safety">3.1. Safety</a></li>
<li><a href="#_visibility">3.2. Visibility</a></li>
<li><a href="#_c_scope">3.3. C scope</a></li>
</ul>
</li>
<li><a href="#_type_system">4. Type system</a>
<ul class="sectlevel2">
<li><a href="#_type_virtualization">4.1. Type virtualization</a></li>
<li><a href="#_type_declaration">4.2. Type declaration</a></li>
<li><a href="#_template_types">4.3. Template types</a></li>
<li><a href="#_type_expressions">4.4. Type expressions</a></li>
<li><a href="#_type_inheritance">4.5. Type inheritance</a></li>
<li><a href="#_record">4.6. Record</a></li>
</ul>
</li>
<li><a href="#_type_category">5. Type category</a>
<ul class="sectlevel2">
<li><a href="#_trait">5.1. Trait</a></li>
<li><a href="#_struct">5.2. Struct</a></li>
<li><a href="#_class">5.3. Class</a></li>
<li><a href="#_enum">5.4. Enum</a></li>
<li><a href="#_unit">5.5. Unit</a></li>
<li><a href="#_annotation">5.6. Annotation</a></li>
</ul>
</li>
<li><a href="#_builtin_type">6. Builtin type</a>
<ul class="sectlevel2">
<li><a href="#_utility_types">6.1. Utility types</a></li>
<li><a href="#_pointer">6.2. Pointer</a></li>
<li><a href="#_string">6.3. String</a></li>
<li><a href="#_builtin_containers">6.4. Builtin containers</a></li>
<li><a href="#_variant">6.5. Variant</a></li>
<li><a href="#_atomic">6.6. Atomic</a></li>
<li><a href="#_lambda">6.7. Lambda</a></li>
</ul>
</li>
<li><a href="#_literal">7. Literal</a>
<ul class="sectlevel2">
<li><a href="#_literal_suffix">7.1. Literal suffix</a></li>
<li><a href="#_magic_literal">7.2. Magic literal</a></li>
</ul>
</li>
<li><a href="#_variable">8. Variable</a>
<ul class="sectlevel2">
<li><a href="#_variable_storage">8.1. Variable storage</a></li>
<li><a href="#_assignment">8.2. Assignment</a></li>
<li><a href="#_field">8.3. Field</a></li>
</ul>
</li>
<li><a href="#_jump">9. Jump</a>
<ul class="sectlevel2">
<li><a href="#_if">9.1. <code>if</code></a></li>
<li><a href="#_while">9.2. <code>while</code></a></li>
<li><a href="#_switch">9.3. <code>switch</code></a></li>
</ul>
</li>
<li><a href="#_function">10. Function</a>
<ul class="sectlevel2">
<li><a href="#_function_prototype">10.1. Function prototype</a></li>
<li><a href="#_function_modifier">10.2. Function modifier</a></li>
<li><a href="#_method">10.3. Method</a></li>
<li><a href="#_operator">10.4. Operator</a></li>
<li><a href="#_function_tagging">10.5. Function tagging</a></li>
<li><a href="#_generator">10.6. Generator</a></li>
<li><a href="#_function_object">10.7. Function object</a></li>
<li><a href="#_out_of_scope_declaration">10.8. Out-of-scope declaration</a></li>
</ul>
</li>
<li><a href="#_exception_handling">11. Exception handling</a></li>
<li><a href="#_macros">12. Macros</a></li>
<li><a href="#_interoperability">13. Interoperability</a>
<ul class="sectlevel2">
<li><a href="#_calling_c_code_from_onyx">13.1. Calling C code from Onyx</a></li>
<li><a href="#_calling_onyx_code_from_c">13.2. Calling Onyx code from C</a></li>
<li><a href="#_exporting_a_c_library">13.3. Exporting a C library</a></li>
</ul>
</li>
<li><a href="#_intrinsics">Appendix A: Intrinsics</a></li>
<li><a href="#_macros_api">Appendix B: Macros API</a></li>
<li><a href="#_standard_library">Appendix C: Standard library</a>
<ul class="sectlevel2">
<li><a href="#_containers">C.1. Containers</a></li>
<li><a href="#_hashing">C.2. Hashing</a></li>
<li><a href="#_regex">C.3. Regex</a></li>
<li><a href="#_streams">C.4. Streams</a></li>
<li><a href="#_serialization">C.5. Serialization</a></li>
<li><a href="#_target_specific_libraries">C.6. Target-specific libraries</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_foreword"><a class="link" href="#_foreword">Foreword</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following document is a non-official (i.e. not governed by the Onyx Software Foundation) Onyx programming language reference (the <em>Reference</em>).</p>
</div>
<div class="paragraph">
<p>The Reference is maintained by Fancy Software, the company behind the Fancy Onyx compiler.
See the source code at <a href="https://github.com/fancysofthq/onyx-ref" class="bare">https://github.com/fancysofthq/onyx-ref</a>.</p>
</div>
<div class="paragraph">
<p>The Reference is meant for the Onyx programming language end-users, i.e. those willing to commit themselves into development of programms written in Onyx.
The Reference is technical, but it may use informal language and also contain explainations, rationale and repetitions where needed.</p>
</div>
<div class="sect2">
<h3 id="_the_onyx_programming_language"><a class="link" href="#_the_onyx_programming_language">The Onyx programming language</a></h3>
<div class="paragraph">
<p><em>Onyx</em> is a general purpose computer programming language inspired by C++ and Ruby.</p>
</div>
<div class="paragraph">
<p>Programs written in Onyx are designed to be executed on modern hardware.
At the moment of writing, these are classic-processor computers running mainstream operating systems, such as Windows, OSX, Linux, iOS and Android.</p>
</div>
<div class="paragraph">
<p>Onyx assumes presence of vital modern components such as MCU and FPU on a target machine.
Once the technology evolves in order so that another component is considered vital (e.g. NPU or QPU), the language shall be updated to reflect the evolution.</p>
</div>
<div class="paragraph">
<p>Still, Onyx is fit in most exotic environments, such as bare metal.
The language features low-level functionality such as pointer arithmetic and easy C ABI interaction; these are often marked unsafe and require explicit transferring of responsibility from a compiler to the programmer themselves.
Wrapping the low-level code into safer APIs allows to perform efficiently while staying on the higher level.</p>
</div>
<div class="sect3">
<h4 id="_design_principles"><a class="link" href="#_design_principles">Design principles</a></h4>
<div class="paragraph">
<p>Onyx defines (but not enforces) the following design priniciples.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Inferring as much as possible</dt>
<dd>
<p>The language is tolerant to omitted modifiers, type restrictions and repretetions; these are often inferred unless ambigous or unclear from the context.</p>
</dd>
<dt class="hdlist1">Reusing concepts</dt>
<dd>
<p>Reusing concepts to be aware of dramatically flattens the learning curve.
The principle is applicable to each aspect of the language.</p>
</dd>
<dt class="hdlist1">Lesser implicitness</dt>
<dd>
<p>Fewer implicit conversions; fewer defaults.
An entity should convey its intentions in its fullness, i.e. clear naming is preferable over short naming.</p>
</dd>
<dt class="hdlist1">Greater maintainability</dt>
<dd>
<p>TODO: <code>Int256</code> vs. <code>superlong</code>, virtual types etc.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reference_conventions"><a class="link" href="#_reference_conventions">Reference conventions</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Compiler</dt>
<dd>
<p>The Standard doesn&#8217;t mandate whether Onyx is a statically- or dynamically-compiled language.
It is designed to fit both scenarios.
A binary application able to run programs written in Onyx is referenced to as a <em>compiler</em> for brewity.
In shell code examples, <code>fnx</code> implies the Fancy Onyx compiler.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A compile-time output (e.g. panics or macros) is denoted with <code>=&gt;</code>, e.g. <code># =&gt; Panic! Undeclared variable</code>.
Runtime output is denoted with <code>-&gt;</code>, e.g. <code># -&gt; Hello, world!</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_current_state"><a class="link" href="#_current_state">Current state</a></h3>
<div class="paragraph">
<p>The Reference is WIP, its development is aligned to the Fancy Onyx compiler development (see <a href="https://github.com/fancysofthq/fnx" class="bare">https://github.com/fancysofthq/fnx</a>).
Most concepts are stabilized.
Builtin and standard libraries aren&#8217;t complete yet, though, their usage in examples is mostly for demonstration purposes.</p>
</div>
<div class="paragraph">
<p>Currently, the Reference may be <em>too</em> dry and technical, i.e. more of a specification rather than a user-friendly reference.
This will change over time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compilation"><a class="link" href="#_compilation">1. Compilation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The whole Onyx program is compiled at once without separating header and source files.
Source files are cross-referenced by the rules defined in <a href="#_onyx_source_files">Section 1.1, &#8220;Onyx source files&#8221;</a> and <a href="#_c_source_files">Section 1.2, &#8220;C source files&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>A compiler <em>panics</em>, i.e. halts compilation, if the program is ill-formed.
The Standard defines panic unique identifiers to aid debugging, e.g. <code>P001: Undeclared function reference</code>.</p>
</div>
<div id="meta_path" class="dlist">
<dl>
<dt class="hdlist1">Meta path</dt>
<dd>
<div class="paragraph">
<p>A <em>meta path</em> is a file path beginning with a seemingly-relative file or directory name, e.g. <code>"foo.nx"</code> or <code>"foo/bar.nx"</code>, but neither <code>"./foo.nx"</code> nor <code>"/foo/bar.nx"</code> nor <code>"C://baz.nx"</code>.</p>
</div>
<div class="paragraph">
<p>The way a meta path is resolved is implementation-defined.
Usually it is resolved by looking up in locations defined by some flags passed to the compiler binary.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If Onyx packages are stored in some <code>./onyx_modules</code> directory, and there is a source file at <code>./onyx_modules/my_module/main.nx</code>, the Fancy Onyx compiler would expect an <code>-i./onyx_modules</code> flag to make an <code>import "my_module/main.nx"</code> directive work.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_onyx_source_files"><a class="link" href="#_onyx_source_files">1.1. Onyx source files</a></h3>
<div class="paragraph">
<p>Onyx uses modules mechanism similar to ES6 modules.
Program entities may be exported using an \$tt "export"\$ directive, and imported using an \$tt "import"\$ directive.</p>
</div>
<div class="paragraph">
<p>By convention, an Onyx source file has <code>.nx</code> extension.
No extension is suffixed implicitly upon file lookup.</p>
</div>
<div class="paragraph">
<p>The Standard defines <code>"std"</code> and <code>"std/*"</code> extension-less meta path family, which are reserved for cross-platform and OS-specific API standard entity implementations, accordingly.
See <a href="#_std_api">[_std_api]</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Modules</div>
<div class="content">
<div class="listingblock">
<div class="title">sum.nx</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">export default def sum(a, b : Int32) {
  return a + b
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">main.nx</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">import { out } from "std/term"
import sum from "./sum.nx"
out &lt;&lt; sum(1, 2)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ fnx ./main.nx
3</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_circular_imports"><a class="link" href="#_circular_imports">1.1.1. Circular imports</a></h4>
<div class="paragraph">
<p>Circular imports are allowed in Onyx.
A compiler jumps back to the file upon detecting an undeclared-yet entity unless dead-loop is detected.</p>
</div>
<div class="exampleblock">
<div class="title">Example 2. Circular imports</div>
<div class="content">
<div class="listingblock">
<div class="title">user.nx</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">import Post from "./post.nx"

export default class User {
  final posts = List&lt;Post&gt;.new()
  #                  ^ Jump point

  let name : String

  def top_rated_post() -&gt; Post {
    #                     ^ Jump point

    let top_rating = 0u
    let top_index = 0z

    this.posts.each#indexed((p, i) =&gt; {
      if (p.rating &gt; top_rating) {
        #   ^ Jump point

        top_rating = p.rating
        top_index = i
      }
    })

    return this.posts[top_index]
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">post.nx</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">import User from "./user.nx"

export default class Post {
  final author : User
  #              ^ Jump point

  let rating : UInt32

  def author_name() -&gt; {
    author.name
    # ^ Jump point
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_source_files"><a class="link" href="#_c_source_files">1.2. C source files</a></h3>
<div class="paragraph">
<p>A file referenced by a C <code>include</code> directive within an Onyx \$tt "extern"\$ directive, as well as a file included by a C file, is looked up in a similar fashion as it would be if compiled by a C compiler.
That said, <a href="#meta_path">meta paths</a> are applicable to C files lookup as well.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Fancy Onyx compiler makes use of the conventional <code>-I</code> flag, e.g. <code>-I/usr/include</code> to resolve C paths.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Standard states that using an Onyx compiler binary would neither require to link standard C libraries explicitly nor to provide the system-dependent standard C include paths, unless cross-compiled.
Therefore, the <code>-I/usr/include</code> flag would be implied on a Linux host when using the Fancy Onyx compiler.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_comments"><a class="link" href="#_comments">2. Comments</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A comment begins with <code>#</code> and spans until the end of the line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># This is a comment.
some_call() # This is also a comment</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>#</code> immediately following an identifier is considered a <a href="#_function_tagging">function tag</a>; an explicit spacing would be required.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">list.each#indexed() # A tagged function call, `#` denotes a function tag
list.each #indexed() `#` begins the comment</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_documentation"><a class="link" href="#_documentation">2.1. Documentation</a></h3>
<div class="paragraph">
<p>Multiple comments without empty lines adjacent to a statement are called <em>documentation</em>.
An annotation application between documentation and statement doesn&#8217;t break the documentation.</p>
</div>
<div class="paragraph">
<p>Documentation blocks may be parsed by a documentation generator to generate a user-friendly API documentation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># This is a freestanding comment.
# It wouldn't be seen in the API docs.
#

some_call() # This is also a comment which wouldn't be present in the API docs

# This is a documentation block.
# It would be reflected in API docs.
@[SomeAnnotation]
class MyClass {
  # This is a documentation for the variable,
  # also seen in the API docs.
  let foo : String
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_comment_intrinsics"><a class="link" href="#_comment_intrinsics">2.2. Comment intrinsics</a></h3>
<div class="paragraph">
<p>TODO: <code>:ditto:</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_comment_styling"><a class="link" href="#_comment_styling">2.3. Comment styling</a></h3>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Enforcing comment styling increases the quality of Onyx libraries.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>A comment should be written in British (<code>en_gb</code>) language, but may contain any other Unicode chars for emojis, names, charts etc.</p>
</div>
<div class="paragraph">
<p>A freestanding comment should always have one empty comment line appended.
A documentation may or may not have a empty comment line appended.</p>
</div>
<div class="paragraph">
<p>A non-inline comment should be hard-terminated with an optional sequence of emojis following the terminator.
An inline comment should not be hard-terminated.</p>
</div>
<div class="paragraph">
<p>Inline comments in adjacent lines should be aligned to the fartest one.
If an inline comment hits some pre-defined length limit, it disables the alignment for the whole block of adjacent lines.</p>
</div>
<div class="paragraph">
<p>Comments support vanilla Markdown styling.
By default, a code fence block language is Onyx.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Comment styling</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">threadsafe! {
  # This context is threadsafe.
  #

  x.value += 1          # Implicitly wrapped in class mutex thus slow
  fragile! x.value += 1 # Fast but not threadsafe

  Atomic.incr(&amp;x) # Increment atomically with sequentially consistent ordering
  fragile! Atomic.incr&lt;:release&gt;(&amp;x) # Increase atomically with "release" ordering
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>But this is also valid styling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">threadsafe! {
  # This context is threadsafe. 🤗
  x.value += 1 # Implicitly wrapped in class mutex thus slow
  fragile! x.value += 1 # Fast but not threadsafe
  Atomic.incr(&amp;x) # Increment atomically with sequentially consistent ordering
  fragile! Atomic.incr&lt;:release&gt;(&amp;x) # Increase atomically with "release" ordering
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scope"><a class="link" href="#_scope">3. Scope</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>scope</em> is comprised of <em>scope members</em>.</p>
</div>
<div class="paragraph">
<p>Only an imported or declared in the same file, or a builtin entity identifier may be looked up from within a scope.
If an identifier is failed to be located in current scope, then the parent scope may be looked up recursively in accordance with rules specific for the scope; for example, an object method can not lookup the object&#8217;s fields directly.
Variable shadowing is always prohibited.
Closures are explicit in Onyx, see <a href="#_lambda">Section 6.7, &#8220;Lambda&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>Static scope of a type specialization is queried via the <em>static lookup</em> operator <code>x::y</code>.
An type specialization instance (i.e. an <em>object</em>) can be queried for a method via the <em>prototype lookup</em> operator <code>x:y</code>; it would require \$tt "this"\$ to be explicitly passed upon a call (see <a href="https://en.wikipedia.org/wiki/Uniform_Function_Call_Syntax">UFCS</a>).
Alternatively, an object may be queried for its members via the <em>object lookup</em> operator <code>x.y</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">struct Foo {
  static def bar() -&gt; 42 # Explicitly static scope of this specialization
  def baz() -&gt; self::bar # Implicitly instance scope of this specialization
}

let foo = Foo()

assert(
  Foo::bar() ==    # Static lookup
  Foo:baz(foo) |== # Prototype lookup
  foo.baz()        # Object lookup
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>An static type specialization member declaration should be accessed using the \$tt "self"\$ keyword, which evaluates to the containing type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let x = "hello"

struct Foo {
  static let bar = 42

  def baz() {
    x               # OK, declared in the file
    # let x = "bye" # =&gt; Panic! Would shadow `x`

    # bar        # =&gt; Panic! Undeclared `bar`. Did you mean `self::bar`?
    let bar = 69 # OK, a function-local variable doesn't shadow

    return self::bar |== Foo::bar # OK, return the static variable
  }
}

extend Foo {
  # static let qux = bar # Panic! Undeclared variable `bar`. Did you mean `self::bar`?
  static let qux = (Foo::bar |== self::bar) # OK

  static def quux() {
    # baz() # Panic! Undeclared function `baz`. Did you mean `self::baz`?
    return Foo::baz() |== self::baz() # OK
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>\$tt "this"\$ keyword is used within a type method, which evaluates to the caller instance (or an immutable copy of the caller if it is a struct).
An instance field can never be directly accessed from a method, only via querying the instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">struct Foo {
  let bar = 42
  let baz = bar + 27      # OK, because in the same scope
  let baz = this.bar + 27 # Also OK

  def qux() {
    # bar          # =&gt; Panic! Undeclared variable `bar`, did you mean `this.bar`?
    this.bar       # OK
    qux()          # OK, defined in this scope
    this.qux()     # Also OK
    Foo:qux(this)  # OK (UFCS)
    self:qux(this) # Ditto
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a struct function callable on a struct pointer, you should explicitly define a static function accepting a pointer argument.
Thanks to <a href="https://en.wikipedia.org/wiki/Uniform_Function_Call_Syntax">UFCS</a>, when called on a pointer, the caller would be passed implicitly.
A getter and setter accepting a struct pointer are implicitly defined for a struct field.
See <a href="#_field">Section 8.3, &#8220;Field&#8221;</a> and <a href="#_pointer">Section 6.2, &#8220;Pointer&#8221;</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">struct Point {
  let x = 1f

  static double(ptr : Point*lw) -&gt; {
    *ptr.x *= 2 # I.e. `Point::x*=(ptr, 2)`, which is implicitly defined
  }
}

let point = Point()
let pointer = &amp;point : Point*lw

pointer-&gt;double() # `Point::double(pointer)`
assert(point.x == 2)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_safety"><a class="link" href="#_safety">3.1. Safety</a></h3>
<div class="paragraph">
<p>It is illegal to call a lower-<em>safety</em> code from within a higher-<em>safety</em> context, unless wrapped in an <em>explicit safety statement</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># An explicitly fragile block to emphasize (top level is fragile by default).
fragile! {
  # $call() # =&gt; Panic! Calling C function is unsafe

  unsafe! $call()     # OK, a single C call is explicitly unsafe
  unsafe! { $call() } # OK, the whole block is explicitly unsafe
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_unsafe"><a class="link" href="#_unsafe">3.1.1. Unsafe</a></h4>
<div class="paragraph">
<p><em>Unsafe</em> is the lowest possible safety level.
An unsafe scope is similar to a <a href="#_fragile">fragile</a> scope in regards to multi-threading, i.e. there are no any ordering guarantees.
The list of unsafe operations follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Calling C functions (see <a href="#_interoperability">Section 13, &#8220;Interoperability&#8221;</a>);</p>
</li>
<li>
<p>Unsafe casting with \$tt "as"\$, e.g. <code>unsafe! 42i as Float64</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_fragile"><a class="link" href="#_fragile">3.1.2. Fragile</a></h4>
<div class="paragraph">
<p>A <em>fragile</em> scope has <a href="https://mathworld.wolfram.com/CausalInvariance.html"><em>causal invariance</em></a>, thus undefined memory access ordering.
Therefore, a fragile code is safe to execute in a single thread, but multi-threaded execution may lead to race condition.
See <a href="#_atomic"><code>Atomic</code></a> for explicit ordering control instruments.</p>
</div>
<div class="paragraph">
<p>The top level scope is guaranteed to run sequentially thus fragile.
<em>Any</em> Onyx function definition has fragile safety by default.
It is legal to <a href="#_function_safety">overload</a> a function by its safety; many builtin types have multiple safety overloads.</p>
</div>
<div class="paragraph">
<p>List of fragile operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accessing a non-final static variable or struct field;</p>
</li>
<li>
<p>Dereferencing a static writeable pointer;</p>
</li>
<li>
<p>Accessing a class field.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_threadsafe"><a class="link" href="#_threadsafe">3.1.3. Threadsafe</a></h4>
<div class="paragraph">
<p>A <em>threadsafe</em> context implies that the code may be simultaneously executed from multiple threads.
Consequentially, in a threadsafe context code implicitly has the strongest ordering guarantees.</p>
</div>
<div class="paragraph">
<p>List of threadsafe operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Accessing a local variable or local struct field;</p>
</li>
<li>
<p>Dereferencing a static readonly pointer;</p>
</li>
<li>
<p>Dereferencing a pointer with local storage.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_visibility"><a class="link" href="#_visibility">3.2. Visibility</a></h3>
<div class="paragraph">
<p><em>Visibility</em> may be either <em>public</em> or <em>private</em>.</p>
</div>
<div class="paragraph">
<p>By default a variable or function is public.
It may be defined explicitly private using the \$tt "private"\$ modifier.
It is not possible to access a private member of a scope other than by wrapping the access in some getter.
A visibility modifier can not be overloaded, only overriden; with an exception for a <a href="#_class">class</a> constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo {
  def bar();            # Implicitly public by default
  private reimpl bar(); # Now it's private
}

# Foo().bar() # =&gt; Panic! Can not access private field `Foo.bar`</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_c_scope"><a class="link" href="#_c_scope">3.3. C scope</a></h3>
<div class="paragraph">
<p>C entities (functions, types and even literals) are referenced from Onyx code by prepending <code>$</code>.
Multi-word entities are wrapped in backticks, e.g. <code>$`unsigned int **`</code>.</p>
</div>
<div class="paragraph">
<p>Builtin C declarations (i.e. those not requiring any <code>include</code>s) are accessible anywhere.
For example, <code>$int</code>, <code>$char*</code> etc.</p>
</div>
<div class="paragraph">
<p>A non-builtin C declaration requires current Onyx source file to either include the header, or to declare the entity explicitly.
That means, for example, that you have to <code>extern #include "stdio.h"</code> or <code>extern void puts(char*);</code> in <strong>each</strong> Onyx source file which calls <code>$puts</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="#_example_calling_c_code_from_onyx">Example 22, &#8220;Calling C code from Onyx&#8221;</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_type_system"><a class="link" href="#_type_system">4. Type system</a></h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In computer science and computer programming, a data type or simply type is an attribute of data which tells the compiler or interpreter how the programmer intends to use the data. […]
A data type constrains the values that an expression, such as a variable or a function, might take. This data type defines the operations that can be done on the data, the meaning of the data, and the way values of that type can be stored.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia conributors<br>
<cite><a href="https://en.wikipedia.org/wiki/Data_type" class="bare">https://en.wikipedia.org/wiki/Data_type</a></cite>
</div>
</div>
<div class="paragraph">
<p>A data type in Onyx is <em>complex</em>: it is comprised of <em>real</em> and <em>imaginary</em> parts.
The real part defines memory layout of the data, while imaginary part defines the way the data <em>behaves</em>.
The imaginary part is always the same or narrower-than the real part.</p>
</div>
<div class="paragraph">
<p>Given that there is a variable <code>x</code> of complex type <code>Float64~Real</code>, the memory layout of <code>x</code> would be defined by the built-in <code>Float64</code> type, that is, 64 bits.
But it would <em>behave</em> in accordance to the imaginary <code>Real</code> trait restriction, which is the common trait of all real numbers (\$RR\$).
Effectively, this would, for example, disallow calling the floating-point-specific <code>.round()</code> method on <code>x</code>.</p>
</div>
<div class="paragraph">
<p>In contrary, if <code>y</code> was simply of type <code>Float64</code> or <code>Float64~Float</code> or even <code>Float64~Float64</code>, the <code>.round()</code> method would remain accessible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x : Float64~Real = 42.0
# x.round() # Panic! Undeclared method `Float64~Real.round()`

let y : Float64 = 42.0
y.round() # OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>It would be a panic to have incompatible real and imaginary part restrictions, e.g. <code>Float64~String</code>.</p>
</div>
<div class="paragraph">
<p>The <code>\$tau\$ : \$upsilon\$</code> notation is taken directly from <a href="https://en.wikipedia.org/wiki/Type_theory">type theory</a>.
The spacing is required because the notation also acts as an actionable restriction operator.
A colon adjacent to an identifier is a distinct entity called <em>label</em>, which is used for argument aliasing.</p>
</div>
<div class="sect2">
<h3 id="_type_virtualization"><a class="link" href="#_type_virtualization">4.1. Type virtualization</a></h3>
<div class="paragraph">
<p>An application of an imaginary type restriction for the purpose of narrowing down a runtime data type or declaration is called <em>virtualization</em>.
Virtualization reduces ambiguity, improves code readability and ensures long-term project maintainability.</p>
</div>
<div class="paragraph">
<p><a href="#_example_simple_type_virtualization">[_example_simple_type_virtualization]</a> introduces the reader to the concept of virtualization.</p>
</div>
<div class="paragraph">
<p>[[<a href="#_example_simple_type_virtualization">[_example_simple_type_virtualization]</a>]]
.Simple type virtualization</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x : Float64 = 42.0
x.round() # OK

# Temporarily virtualizing `x` to `~Real` removes
# the ability to call `Float64`'s methods.
# TODO: Variant~Variant = option?
# x~Real.round() # Panic! Undeclared method `Float64~Real.round()`

# Storing a virtualized type permanently.
# `y` type is inferred to be `Float64~Real`.
let y = x~Real
# y.round() # Panic! Undeclared method `Float64~Real.round()`</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><a href="#_example_complex_type_virtualization">Example 4, &#8220;Complex type virtualization&#8221;</a> is more complicated, but it demonstrates how virtualization ensures long-term maintainability of programs written in Onyx.
The code below would continue working even if added another <code>Drawable4D</code> trait with the same <code>draw()</code> method.</p>
</div>
<div id="_example_complex_type_virtualization" class="exampleblock">
<div class="title">Example 4. Complex type virtualization</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># Both traits have the same-named method declaration.
trait Drawable2D { decl draw(); }
trait Drawable3D { decl draw(); }

struct Figure
  def some_figure_method();
end

struct Square : Figure, Drawable2D
  impl draw(); # Implement the `Drawable2D`'s method
end

struct Cube : Figure, Drawable2D
  impl draw(); # Implement the `Drawable2D`'s method
end

# Later on we decide to also make a cube drawable in 3D...
# It would break existing `cube.draw()` calls.
impl Cube : Drawable3D
  # impl draw();                   # Panic! Ambiguous method
  impl (self ~ Drawable3D).draw(); # OK, narrowed the declaration to select the one we need
  # impl self~Drawable3D.draw()    # A possible shortcut
  # impl ~Drawable3D.draw()        # Ditto
end

# Now, let's run some code.
#

let square = Square{}
square.draw()            # OK, call the 2D implementation
square~Drawable2D.draw() # OK, ditto

let cube = Cube{}
# cube.draw()          # Panic! Ambigous method call
cube~Drawable2D.draw() # Call the 2D implementation
cube~Drawable3D.draw() # Call the 3D implementation

# def draw&lt;T ~ Figure&gt;(figure : T) # Can be shortcut
def draw(figure ~ Figure)
  if (figure ~? Drawable2D)
    inspect&lt;@typeof(figure)&gt; # =&gt; T~(Figure &amp;&amp; Drawable2D)
    figure.draw()            # Always call the 2D implementation
    figure~Drawable2D.draw() # Ditto
    figure~Drawable3D.draw() # ? May compile

    if (figure ~? Drawble3D)
      inspect&lt;@typeof(figure)&gt; # =&gt; T~(Figure &amp;&amp; Drawable2D &amp;&amp; Drawable3D)
      # figure.draw()          # Panic! Ambigous call
      figure~Drawable2D.draw() # Have to choose now
      figure~Drawable3D.draw() # Ditto
    else
      inspect&lt;@typeof(figure)&gt;   # =&gt; T~(Figure &amp;&amp; Drawable2D)
      figure.draw()              # Always call the 2D implementation
      figure~Drawable2D.draw()   # Ditto
      # figure~Drawable3D.draw() # Panic! Can not restrict to `Drawable3D`
    end
  else
    inspect&lt;@typeof(figure)&gt;   # =&gt; T~Figure
    # figure.draw()            # Panic! `T~Figure.draw()` is undefined
    # figure~Drawable2D.draw() # Panic! Can not restrict to `Drawable2D`
    figure~Drawable3D.draw()   # ? May compile
  end

  inspect&lt;@typeof(figure)&gt; # =&gt; T~Figure
  # figure.draw()          # Panic! `T~Figure.draw()` is undefined
  figure~Drawable2D.draw() # ? May compile
  figure~Drawable3D.draw() # ? May compile
end</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>It may be seen that it&#8217;s up to a programmer to decide on the virtualization level in their projects based on to what extent the program is expected to grow in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="_type_declaration"><a class="link" href="#_type_declaration">4.2. Type declaration</a></h3>
<div class="paragraph">
<p>A type can be declared using a \$tt "decl"\$ statement.
A type declaration requires its <em>category</em> to be declared, one of \$tt "struct"\$, \$tt "class"\$, \$tt "enum"\$, \$tt "trait"\$, \$tt "unit"\$ or \$tt "annotation"\$.</p>
</div>
<div class="paragraph">
<p>A type naming rules are the same as with <a href="#_variables">variables</a>, i.e. <code>/[a-zA-Z_](a-zA-Z0-9_)*/</code>.
A type name also may be wrapped in backticks to allow Unicode characters in it.
By convention, though, a type name begins with an uppercase letter.
The only exceptions are keywords \$tt "nil"\$, \$tt "void"\$ and \$tt "discard"\$.</p>
</div>
<div class="paragraph">
<p>A type declaration does not contain body.</p>
</div>
<div class="paragraph">
<p>A declared type doesn&#8217;t have size and thus can not be used as a runtime data type.
Still, it may act as a virtual restriction, or a non-data-mapped template argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl struct Point
let ptr = Point*.null() # OK, a pointer to incomplete type is legal
# Point{}               # Panic! Can not initialize an incomplete type</code></pre>
</div>
</div>
<div class="paragraph">
<p>To be able to make use of a declared type, it shall be implemented.
An attempt to implement an undeclared yet type panics.
An implemented type becomes complete and therefore can be used in runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">impl Point {
  let x, y : Float64
  def length() -&gt; (this.x ** 2 + this.y ** 2).sqrt()
}

let point = Point{1, 2} # OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once a concrete type specialization is implemented, it may not be implemented again.
Multiple non-clashing partial implementations of the same type are allowed.</p>
</div>
<div class="paragraph">
<p>To extend an existing implementation, an \$tt "extend"\$ statement shall be used.
Attempt to extend an unimplemented-yet type panics.</p>
</div>
<div class="paragraph">
<p>An annotation type can be neither implemented nor extended.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl struct Foo&lt;T&gt;

forall [T ~ Real] impl Foo&lt;T&gt; {
  let real : T
}

# impl Foo&lt;Int32&gt;; # Panic! Already implemented

extend Foo&lt;Int32&gt; {
  let int_specific : Int32 = 0 # OK
}

# Foo&lt;Float64&gt;{0}.int_specific # Panic! Undefined field `Foo&lt;Float64&gt;:int_specific`
Foo&lt;Int32&gt;{0}.int_specific     # OK</code></pre>
</div>
</div>
<div id="DESIGN" class="exampleblock">
<div class="content">
<div class="paragraph">
<p>It is tempting to allow an explicit \$tt "reimpl"\$ statement for an already implemented type, which would obliterate all previous member definitions.
However, this would reduce the program maintainability in a longer run.
Therefore, reimplementing a type in Onyx is illegal.
It is still legal to reimplement a function, though.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_template_types"><a class="link" href="#_template_types">4.3. Template types</a></h3>
<div class="paragraph">
<p>A type may be declared with <em>template arguments</em>, which makes it a <em>template type</em>.</p>
</div>
<div class="paragraph">
<p>A template argument declaration is accessible within any type member, and also directly under the type itself.
A template argument may have an alias, which is used for access from outside.</p>
</div>
<div class="paragraph">
<p>Once declared, a template type should be implemented for all or a subset of template argument combinations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl Foo&lt;Type: T&gt;

# Implement for `Int32`.
impl Foo&lt;Int32&gt; {
  let x : Int32
}

assert(Foo&lt;Int32&gt;::Type :? Int32)

# Implement for `String`.
impl Foo&lt;String&gt; {
  let x : String
}

assert(Foo&lt;String&gt;::Type :? String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A subset of template argument combinations may be implemented using a <code>forall</code> modifier.
The modifier declares a new list of template arguments which are passed to the template type, optionally wrapped in square brackets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl Foo&lt;T&gt;

forall T impl Foo&lt;T&gt; {
  let x :  T
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Declaration and definition may be done simultaneously using a \$tt "def"\$ statement, which is often omitted if type category is present.
When defining a type, the implementation is implicitly <em>for all</em> possible template arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo&lt;T&gt; {
  let x : T
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A template argument may have a virtual type restriction.
A template type with virtually-restricted template arguments is said to be <em>partial template type</em>.
An argument&#8217;s complex type would have the according virtual part within a partial type.
If a template argument restriction doesn&#8217;t match during implementation, a compiler panics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl struct Foo&lt;T ~ Real&gt;
# impl Foo&lt;String&gt;; # =&gt; Panic! `String` doesn't match `Real`
impl Foo&lt;Int32&gt;;    # OK

# Implicitly for all types matching `~ Real`.
def struct Bar&lt;T ~ Real&gt;;
Bar&lt;Int32&gt;(42) # OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>forall</code> modifier may also be used in a type declaration or definition statement.
A template argument declared within a <code>forall</code> modifier in a declaration wouldn&#8217;t be implicitly accessible outside, e.g. from within an implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">forall T decl Foo&lt;Type ~ List&lt;T&gt;&gt;

impl Foo&lt;List&lt;Int32&gt;&gt; {
  # T                       # =&gt; Panic!
  self::Type :: List&lt;Int32&gt; # OK
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">forall T struct Foo&lt;Type ~ List&lt;T&gt;&gt; {
  T :: self::Type :: Type :~ List&lt;T&gt; # OK
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A type is <em>specialized</em> once it&#8217;s referenced.
Each unique combination of template arguments leads to a distinct type specialization.
During specialization, delayed macros are evaluated within the matching type implementation and its extensions, in order of appearance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo&lt;T&gt; {
  \{% puts "Specialized!" %}
}

Foo&lt;Int32&gt;()  # =&gt; Specialized!
Foo&lt;Int32&gt;()  #
Foo&lt;String&gt;() # =&gt; Specialized!</code></pre>
</div>
</div>
<div class="paragraph">
<p>Clashing implementations are illegal.
Clashing extensions are legal, though, and would layer up.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl Foo&lt;T&gt;
forall [T ~ Real] impl Foo&lt;T&gt;;
# forall [T ~ Int] impl Foo&lt;T&gt;; # Panic! Already implemented for `T ~ Real`
forall [T ~ Int] extend Foo&lt;T&gt;; # OK</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_expressions"><a class="link" href="#_type_expressions">4.4. Type expressions</a></h3>
<div class="paragraph">
<p>A freestanding type is a degratory case of a <em>type expression</em> following the boolean logic rules.
\$and\$ (<code>&amp;&amp;</code>), \$or\$ (<code>||</code>) and \$neg\$ (<code>!</code>) operations are implemented, which may be grouped in parentheses.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># Implement the function for all `Int`s but `Int32` and `Int16`.
forall [T ~ Int &amp;&amp; !(Int32 || Int16)] impl foo&lt;T&gt;(arg : T);</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Parentheses in Onyx represent tuples.
A single-element tuple&#8201;&#8212;&#8201;a <em>monuple</em>&#8201;&#8212;&#8201;is treated as if there were no any parens at all, i.e. <code>(\$tau\$)</code> \$-=\$ <code>\$tau\$</code> \$-=\$ <code>Tuple&lt;\$tau\$&gt;</code> \$-=\$ <code>Tuple&lt;(\$tau\$)&gt;</code> etc.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases, using an expression is illegal.
For example, a runtime data may not be restricted to an expression of real types, as it doesn&#8217;t make sense.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Real type expressions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># let x : Float64 || Float32 = 42         # Panic!
let x : Float64~(Float64 || Float32) = 42 # OK</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_inheritance"><a class="link" href="#_type_inheritance">4.5. Type inheritance</a></h3>
<div class="paragraph">
<p>A type \$tau\$ may inherit another type \$alpha\$ upon declaration, implementation or extension using the <code>\$tau\$ : \$alpha\$</code> notation.</p>
</div>
<div class="paragraph">
<p>Inherited types are comma-separated and may <em>optionally</em> wrapped in square brackets.
Referencing an inherited type allows to pass template arguments to it.</p>
</div>
<div class="paragraph">
<p>Static members are not inherited (unless it is a <a href="#_unit">unit</a> type).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">trait Enumerable&lt;T&gt; {
  decl each(block : T =&gt; discard) : void
}

class List&lt;T&gt; : Enumerable&lt;T&gt; {
  impl each(block) {
    let i = 0z
    while (i &lt; this.size)
      block(this[i++])
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If an inherited type contains a field, the field then can be defined again with exactly the same type in the inheriting type.
A field default value may be overriden or even removed in an inheriting type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo {
  let foo : Int32 = 0
}

struct Bar : Foo {
  let foo : Int32 = 1 # Override the default value
}

struct Baz : Foo {
  let foo : Int32 # Undefine the default value completely
}

assert(Foo{}.foo == 0)
assert(Bar{}.foo == 1)

# Baz{}                 # Panic!
assert(Baz{0}.foo == 0) # OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>Referencing an ambigous method declared in an inherited type would require virtualization.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">trait Foo {
  decl foo()
}

trait NotFoo {
  decl foo() # Note the same name
  decl bar()
}

struct Bar : Foo, NotFoo {
  # impl foo();    # Panic! Ambigous
  impl ~Foo:foo(); # OK, being specific
  impl bar();      # OK, no ambiguity
}

# Bar{}.foo()   # Panic! Ambigous
Bar{}~Foo.foo() # OK
Bar{}.bar()     # OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>A trait type may inherit another trait.
A struct type may inherit another struct or trait.
A class type may inherit another class, struct or trait.</p>
</div>
<div class="paragraph">
<p>Application of an annotation type which inherits another annotation applies the inherited annotation to the entity the original annotation is being applied to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">annotation Foo&lt;T ~ \string&gt;
annotation Bar&lt;T ~ \string, U ~ \uint&gt; : Foo&lt;T&gt;

@[Bar&lt;"baz", 42&gt;] # Also applies `Foo&lt;"baz"&gt;`
class User;

{% print nx["User"].annotations.map(&amp;.type.name).includes?("Foo") %} # =&gt; true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_record"><a class="link" href="#_record">4.6. Record</a></h3>
<div class="paragraph">
<p>A <em>record</em> is a non-empty stack-allocated collection of named heterogeneous elements.
A record type \$R\$ defines a public constructor which accepts an \$R\$ instance with fields passed by their names.
Also, <code>Record&lt;\$R\$&gt; : \$R\$</code>.</p>
</div>
<div class="paragraph">
<p>A record field definition is implicitly \$tt "let"\$ by default.
A \$tt "final"\$ field can not be modified after record instantiation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let rekord = { x: 1, final y: 2 } :
  Record&lt;{ let x : Int32, final y : Int32 }&gt; :
  { x, final y : Int32 }

assert(rekord.x == 1)
rekord.x = 3
assert(rekord.x == 3)

assert(rekord.y == 2)
# rekord.y = 4 # =&gt; Panic! Can not modify final field `rekord.y`</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a record field \$x\$ has a default value, then it may be omitted in the constructor record.
A record type which has default values set for all of its fields also defines a zero arity constructor.
A default value is not a part of the record prototype, i.e. <code>{ \$x\$ : \$tau\$ = \$a\$ }</code> \$-=\$ <code>{ \$x\$ : \$tau\$ = \$b\$ }</code> \$-=\$ <code>{ \$x\$ : \$tau\$ }</code>.
The <em>nearest</em> default value is applied upon construction.</p>
</div>
<div class="paragraph">
<p>A record type may be <a href="#_alias">aliased</a>.
Recursive aliasing is not allowed unless it&#8217;s a recursive pointer, e.g. <code>alias Node =&gt; { parent : Node* }</code>.</p>
</div>
<div class="paragraph">
<p>A record defines the <em>equality operator</em> <code>===</code> which returns <code>true</code> if all of its fields are equal to the operand&#8217;s.
<code>!==</code> returns <code>true</code> if any of the fields aren&#8217;t equal.
<code>===&lt;</code> is similar to <code>===</code>, but returns a copy of self if equal (useful in long assertions).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">alias Point =&gt; { x, y : Int32 = 0 }

assert(
  Point({ x: 0, y: 0}) ===
  Point({ x: 0 }) ===&lt;
  Point({ }) ===&lt;
  Point())

assert(Point() !== Point({ x: 1 })) # `x` aren't equal</code></pre>
</div>
</div>
<div class="paragraph">
<p>To avoid repetition, a freestanding identifier <code>\$i\$</code> expands to <code>\$i\$: \$i\$</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let x = 17
final point = Point({ x }) # Shortcut to `Point({ x: x })`
assert(point.x == 17)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A record type can also be <a href="#_distinct_alias">aliased disinctively</a>, which allows its extension and thus inheritance.
A record fields have undefined order, but an ancestor&#8217;s field are guaranteed to come earlier.
This effectively allows to safely upcast a record instance.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To ensure memory ordering for interoperability, use C structs instead.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For a record type \$R\$ a static function <code>\$R\$::\$R\$</code> may be oveloaded to implement a custom constructor.
Inherited fields are available in a constructor record.
A non-identifier (e.g. a call) \$x\$ of type \$tau\$ may be passed to a record constructor unnamed iff the record has \$tau\$ in the list of its ancestors; the ancestor would be initialized with \$x\$ then and merged with other fields in order of appearance in the constructor record (former values are overwritten).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">enum Color {
  Red,
  Green,
  Blue
}

struct Drawable {
  let color : Color
}

distinct alias Point =&gt; { x, y = 0f } : Drawable {
  # A custom constructor.
  static self(x, y, color) -&gt; self({ Drawable({ color }), x, y })

  # A custom method available exclusively for a `Point` instance.
  def length() -&gt; (this.x ** 2 + this.y ** 2).sqrt()
}

# let point = Point({ Drawable({ color: :red }), x: 3, y: 4}) # Too long 👎
let point = Point(3, 4, :red) # Calling the custom constructor 👍

assert(point.color == :red)
assert(point.length() == 5)

final drawable = point as Drawable # OK, safe
# point = drawable as Point        # =&gt; Panic! Can not safely downcast</code></pre>
</div>
</div>
<div class="paragraph">
<p>A more ergonomic alternative to distinctly aliasing a record type would be defining a freestanding <a href="#_struct">struct</a> instead.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also declare method on a simply-<a href="#_type_aliasing">aliased</a> record type using an <a href="#_out_of_scope_declaration">out-of-scope declaration</a>.
However, it would declare the method for <strong>all</strong> instances of the record, which is rarely desirable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">alias Point =&gt; { x, y : Float64 }
def Point.length() -&gt; (this.x ** 2 + this.y ** 2).sqrt()

# Do you really want this method for all of the similar records?
assert({ x: 3 : Float64, y: 4 : Float64 }.length() == 5)</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_type_category"><a class="link" href="#_type_category">5. Type category</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_trait"><a class="link" href="#_trait">5.1. Trait</a></h3>
<div class="paragraph">
<p>A trait type defines <em>behaviour</em> of a deriving type, i.e. its methods; it doesn&#8217;t define fields.</p>
</div>
<div class="paragraph">
<p>A trait function has storage defined by a deriving type.
However, it can be declared with an explicit \$tt "static"\$ modifier, which would make the function un-deriveable.</p>
</div>
<div class="paragraph">
<p>A struct, class, unit or trait type can derive a trait.
<code>this</code> within a trait&#8217;s method evaluates in the context of the deriving type.
A trait type by itself can not exist in runtime.
A trait variable must be defined with an explicit has \$tt "static"\$ storage modifier, and is thus never derived.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">trait Foo {
  decl foo()

  def get_foo() -&gt; {
    return this.foo()
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A unit type may inherit a trait.
The trait&#8217;s methods become "instance" methods of the unit type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">trait Foo {
  decl foo()
  def bar() -&gt; this.foo()
  static def baz() -&gt; "qux"
}

unit Unit : Foo {
  impl foo() -&gt; 42
}

assert(Unit.bar() == 42) # OK
# Unit::baz()            # Panic! Undeclared `Unit::baz()` (static members aren't derived)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_struct"><a class="link" href="#_struct">5.2. Struct</a></h3>
<div class="paragraph">
<p>A struct is an ergonomic alternative to a to distinct <a href="#_record">record</a> alias.
Akin to record, a struct is passed by value.</p>
</div>
<div class="paragraph">
<p>A struct type may inherit another struct or trait.</p>
</div>
<div class="paragraph">
<p>A default public struct constructor accepts a <a href="#_record">record</a> containing the struct&#8217;s fields, or zero args if the record is empty.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Point {
  let x, y = 0f
  static zero() -&gt; self()
}

assert(
  Point({ x: 0, y: 0 }) ===
  Point({ }) |==
  Point() |==
  Point::zero())</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make a struct function callable on a struct pointer, you should explicitly define a static function accepting a pointer argument.
Thanks to <a href="https://en.wikipedia.org/wiki/Uniform_Function_Call_Syntax">UFCS</a>, when called on a pointer, the caller would be passed implicitly.
A getter and setter accepting a struct pointer are implicitly defined for a struct field.
See <a href="#_field">Section 8.3, &#8220;Field&#8221;</a> and <a href="#_pointer">Section 6.2, &#8220;Pointer&#8221;</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">struct Point {
  let x = 1f

  static double(ptr : Point*lw) -&gt; {
    *ptr.x *= 2 # I.e. `Point::x*=(ptr, 2)`, which is implicitly defined
  }
}

let point = Point()
let pointer = &amp;point : Point*lw

pointer-&gt;double() # `Point::double(pointer)`
assert(point.x == 2)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_class"><a class="link" href="#_class">5.3. Class</a></h3>
<div class="paragraph">
<p>A <em>class</em> instance is a <a href="#_record">record</a> residing in a non-stack memory with automatic <a href="#_gc">garbage collection</a>.</p>
</div>
<div class="paragraph">
<p>Unlike struct or record, a \$tt "final"\$ class instance still allows its fields to be modified.</p>
</div>
<div class="paragraph">
<p>A class doesn&#8217;t have a public constructor implicitly defined, only a private one.
A class constructor is the only case when <a href="#_function_visibility">visibility overloading</a> is legal.
However, if a class doesn&#8217;t contain any fields, a zero-arity public constructor is defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">class Dog {
  let name : String
  static self(name) -&gt; self({ name }) # Shall define a public constructor explicitly
}

final spot = Dog("Spott") # Oops
spot.name = "Spot"        # OK. Note that `spot` is a `final` variable,
                          # but the non-final field can still be written</code></pre>
</div>
</div>
<div class="paragraph">
<p>A class field may be of the same type as the class, i.e. a recursive class field is legal.
Access to a class field or method is threadsafe unless the instance is passed outside of the stack.</p>
</div>
<div class="paragraph">
<p>Assigning a class instance is threadsafe and copies it by reference.
An implicitly defined class <em>equality</em> operator <code>===</code> would return <code>true</code> if both operands point to the same memory region.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">extend Dog {
  # Define a custom equavalence operator.
  def ==(another : Dog) -&gt; this.name == another.name
}

final spot_copy = spot
assert(spot === spot_copy) # Both equivalent...
assert(spot == spot_copy)  # and equal

final another_spot = Dog("Spot")
assert(spot !== another_spot) # Not equivalent, ...
assert(spot == another_spot)  # but equal

final mike = Dog("Mike")
assert(spot !== mike) # Neither equivalent...
assert(spot != mike)  # nor equal</code></pre>
</div>
</div>
<div class="paragraph">
<p>A class instance is implicitly prefixed with an implementation-defined <em>class header</em>.
Header size and layout are undefined, but shall remain the same for any class instance.
Commonly a header contains <a href="#_class_hierarchy">RTTI</a> and <a href="#_gc">GC</a> metadata.</p>
</div>
<div class="paragraph">
<p>A static class instance may be safely cast to a <code>void</code> pointer with static storage.
A non-static instance pointer would have undefined storage instead.
The pointer would point at the instance header followed by the record.
The header offset value may be acquired via macro or \$tt "@classoffset"\$ intrinsic.</p>
</div>
<div class="sect3">
<h4 id="_class_hierarchy"><a class="link" href="#_class_hierarchy">5.3.1. Class hierarchy</a></h4>
<div class="paragraph">
<p>A class header contains <em>runtime type information</em>, (<em>RTTI</em>) which allows to have, for example, an array of class descendants without type erasure.</p>
</div>
<div class="paragraph">
<p>A class type declared with an \$tt "abstract"\$ modifier is incomplete, i.e. it can not be a variable real type (see <a href="#_type_complexity">[_type_complexity]</a>).
However, it still defines a private constructor to be used in a descendant.</p>
</div>
<div class="paragraph">
<p>A class instance may be threadsafely upcast to an ancestor class type using the \$tt "as"\$ operator.
For runtime casting use the \$tt "@cast"\$ intrinsic and its nilable counterpart \$tt "@cast?"\$.
Based on the class storage, an intrinsic invocation may be threadsafe (for an in-scope class instance) or fragile (all other cases).</p>
</div>
<div class="paragraph">
<p>Determining a local-only class instance actual type virtualizes it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">abstract class Animal {
  final intelligence : Float64
  decl sound() -&gt; String
}

class Dog : Animal {
  static self() -&gt; self({ intelligence: 0.3 })
  def bark() -&gt; "Woof!"
  impl sound() -&gt; this.bark()
}

class Cat : Animal {
  static self() -&gt; self({ intelligence: 0.25 })
  def meow() -&gt; "Meow!"
  impl sound() -&gt; this.meow()
}

let animal : Animal = Dog()       # OK, can autocast
let animal = Dog() as Animal      # OK, static upcasting is always threadsafe
let animal = @cast&lt;Animal&gt;(Dog()) # OK, dynamic upcasting as an alternative

let dog = @cast&lt;Dog&gt;(animal)               # May throw if it's not a `Dog` instance, fragile
let maybe_dog = @cast?&lt;Dog&gt;(animal) : Dog? # Would return `nil` if failed to cast

final animals = List&lt;Animal&gt;()
animals.push(dog) # OK, can autocast

animals.each(a =&gt; {
  switch (a) {
    case Dog then a.bark() # Virtualized to `Animal~Dog`
    case Cat then a.meow() # Virtualized to `Animal~Cat`
  }

  a.sound()             # OK, can call a declaration on an abstract ancestor type
  print(a.intelligence) # Also OK
})</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gc"><a class="link" href="#_gc">5.3.2. GC</a></h4>
<div class="paragraph">
<p>The Standard states that a class instance shall be <em>garbage collected</em> (GC), but it doesn&#8217;t define the precise mechanism.
To aid the development of a GC implementation, Onyx defines private \$tt "finalize"\$ method and public \$tt "eachfield"\$ <a href="#_generator">generator</a> for a record, struct or a class type.</p>
</div>
<div class="paragraph">
<p>A private \$tt "finalize"\$ method (also known as <em>destructor</em>) is called implicitly once a class instance is deemed to be ready for garbage collection, i.e. finalized.
A class type has \$tt "finalize"\$ method implemented by default; it invokes \$tt "finalize"\$ on <em>each field</em> yielded by an \$tt "eachfield"\$ generator call.</p>
</div>
<div class="paragraph">
<p>An \$tt "eachfield"\$ generator is implemented implicitly for most of the types.
By default, it yields each field of the containing type.
An \$tt "eachfield"\$ call is threadsafe on a local object, otherwise fragile.</p>
</div>
<div class="paragraph">
<p>An explicit \$tt "eachfield"\$ reimplementation may be required.
For example, a dynamic array implementation would yield its pointee elements instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># A dynamic array.
class List&lt;T&gt; : Enumerable&lt;T&gt; {
  private pointer : T*
  getter capacity, size = 0u

  # Yield each element of the list.
  reimpl eachfield(e) =&gt; this.each(=&gt; yield @)

  # Destroy the list, decreasing RC of its elements
  # (see ARC) and then freeing the pointer.
  reimpl unsafe finalize() -&gt; {
    this.eachfield(e =&gt; @decrc(e))
    unsafe! $free(this.pointer as void*)
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_arc"><a class="link" href="#_arc">5.3.3. ARC</a></h4>
<div class="paragraph">
<p>An Onyx compiler may rely on <em>automated reference counting</em> (ARC) to implement garbage collection.</p>
</div>
<div class="paragraph">
<p>In consideration to this, \$tt "@incrc"\$ and \$tt "@decrc"\$ intrinsics are defined in Onyx to increase or decrease strong reference counter explicitly and recursively, which is useful during <a href="#_interoperation">interoperation</a>.</p>
</div>
<div class="paragraph">
<p>A struct is allowed to have a class field, which implies the need to update the field&#8217;s reference counter; an intrinsic invocation on a struct would proxy the update to all its class fields, even nested.
An intrinsic invocation on a struct without any class fields would therefore be noop.</p>
</div>
<div class="paragraph">
<p>An Onyx library author shall treat <strong>any</strong> compiler as implementing ARC.
The RC intrinsics are always legal.</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. ARC</div>
<div class="content">
<div class="paragraph">
<p>In this example, we are passing some Onyx <code>Database</code> instance outside, to the C world.
To keep the instance alive, we&#8217;re incrementing the RC upon passing it; and decrementing it when the C environment doesn&#8217;t need the instance anymore.
See <a href="#_interoperation">[_interoperation]</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">extern {
  // Initialize a *db* instance.
  void db_init(void* db);

  // Calling this function would destroy the *db* instance.
  void db_destroy(void* db) {
    # The Onyx context is implicitly unsafe here.
    $destroy_db(db); # This is an Onyx call
  }
}

def init_db() {
  let db = Database()

  # NOTE: Taking pointer is safe, it's the C call which is not.
  unsafe! $db_init(db as void*)

  @incrc(db)
  return db
}

unsafe destroy_db(ptr : void*) {
  @decrc(ptr as Database)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enum"><a class="link" href="#_enum">5.4. Enum</a></h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In computer programming, an enumerated type […] is a data type consisting of a set of […] enumerators of the type. The enumerator names are usually identifiers that behave as constants in the language.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia contributors<br>
<cite><a href="https://en.wikipedia.org/wiki/Enumerated_type" class="bare">https://en.wikipedia.org/wiki/Enumerated_type</a></cite>
</div>
</div>
<div class="paragraph">
<p>In Onyx, a \$tt "enum"\$ type is <code>~ Int</code>, <code>: SSize</code> by default.
Enumerator values begin with <code>0</code> and increment by <code>1</code> unless explicitly set.
A enumerator constant can be safely interpreted as the underlying type, but not vice versa.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">enum Foo {
  Bar,     # Implicitly `Bar = 0,`
  Baz = 2, # Set the value explicitly
  Qux      # Implicitly `3`
}

let foo : Foo = Foo::Bar # OK, can assign a enumerator directly
foo = Foo(Foo::Bar)      # OK, can construct with a enumerator (won't throw)
foo = Foo(0)             # OK, but may throw `EnumError`

assert(foo as SSize == 0) # Can safely upcast

# 0z as Foo       # =&gt; Panic! Can not safely cast `SSize` to `Foo`
unsafe! 0z as Foo # OK, but unsafe</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <em>symbol</em> expands to a enumerator constant unless ambigous.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">enum Foo {
  Bar,
  Baz
}

enum NotFoo {
  Bar,
  Qux
}

def foo(arg : Foo) { }
foo(:bar) # OK, expands to `Foo::Bar` without ambiguity

def any(arg ~ Foo || NotFoo) { }
# any(:bar)   # =&gt; Panic! Would ambigously expand to either `Foo::Bar` or `NotFoo::Bar`
any(Foo::Bar) # OK
any(:qux)     # OK (`NotFoo::Qux`)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A enum may inherit another enum or a type matching <code>~ Int</code>, but it doesn&#8217;t inherit any <code>Int</code> members, though.</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Enum inheritance</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">enum Foo : UInt8 {
  Bar, # `= 0`
  Baz  # `= 1`
}

# Foo::Bar + 1         # Panic! Undeclared method `Foo:+()`

enum FooPlus : Foo {
  Qux # ` = 2`
}

FooPlus::Baz # OK, inherited
FooPlus::Qux # OK, the new enumerator value</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Rust-like enums can be achieved using the <a href="#_distinct_alias">distinct alias</a> feature.
Also see <a href="#_variant">Section 6.5, &#8220;Variant&#8221;</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 8. Rust-like enum</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">distinct alias RustEnum =&gt; Variant&lt;String, Int32&gt; {
  def foo() {
    switch (this) {
      case String then this~String
      case Int32  then this~Int32
    }
  }
}

let rust_enum = RustEnum("foo") # Is really `Variant&lt;String, Int32&gt;("foo")`</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_flag"><a class="link" href="#_flag">5.4.1. Flag</a></h4>
<div class="paragraph">
<p>A enum doesn&#8217;t support bitwise operations by itself.
However, a \$tt "flag"\$ may be declared instead, which would define bitwise methods and operators accepting another flag value.
All flag enumerator values shall be a power of two; it may only inherit an <code>~ UInt</code> type, <code>USize</code> by default.</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Flag</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">enum Enum {
  Foo, # `= 0`
  Bar, # `= 1`
  Baz  # `= 2`
}

# Enum::Foo | Enum::Bar # =&gt; Panic! Undeclared `Enum.|()`

flag Flag {
  Foo, # `= 1` (`2 ** 0`)
  Bar, # `= 2` (`2 ** 1`)
  Baz  # `= 4` (`2 ** 2`)
}

(Flag::Foo | Flag::Bar) as USize == 3 # OK
(Flag::Foo.and(:baz)) as USize == 5   # OK</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enum_template_argument"><a class="link" href="#_enum_template_argument">5.4.2. Enum template argument</a></h4>
<div class="paragraph">
<p>A enum or flag (with adjacency supported) literal may be used as a template argument.
Note that a template argument must not have the same name as the already declared enum.</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Enum template argument</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">enum Color {
  Red,
  Green,
  Blue
}

struct Foo&lt;Color: C ~ \Color&gt; {
  def foo() -&gt; C
}

assert(Foo&lt;Color: :red&gt;.foo() == Color::Red)
assert(Foo&lt;Color: Color::Blue&gt;.foo() == :blue)</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 11. Flag template argument</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">flag Mode {
  Read,
  Write
}

struct IO&lt;Mode: M ~ \Mode&gt; { }

# Implement for readable.
impl IO&lt;:read&gt; {
  decl read()
}

# Implement for writeable.
impl IO&lt;:write&gt; {
  decl write()
}

# Implement for both readable and writeable.
impl IO&lt;:read | :write&gt; {
  decl common()
}

IO&lt;:read&gt;().read()            # OK
# IO&lt;:read&gt;().write()         # =&gt; Panic! Undeclared `IO&lt;Mode::Read&gt;.write`
IO&lt;:read | :write&gt;().read()   # OK
IO&lt;:read | :write&gt;().common() # OK</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_unit"><a class="link" href="#_unit">5.5. Unit</a></h3>
<div class="paragraph">
<p>A \$tt "unit"\$ type is a singleton object type.
It always has zero size, and its identifier is its only instance.</p>
</div>
<div class="paragraph">
<p>A unit member practically has static storage, but it shall be accessed as if it was an "instance" member, i.e. via <code>.</code>.
A unit field shall always have its default value set, as it&#8217;s practically a static variable
An "instance" unit member access is fragile..</p>
</div>
<div class="paragraph">
<p>A unit member declared with an explicit \$tt "static"\$ modifier may only be statically-accessed, i.e. via <code>::</code>.</p>
</div>
<div class="paragraph">
<p>A unit type defines equivalence operator <code>===</code>, which returns \$tt "true"\$ iff the operand is the same unit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">unit Unit {
  let var : Int32 = 0

  def get_var() {
    return this.var
  }
}

threadsafe! {
  let u = Unit
  assert(u === Unit)

  fragile! u.var += 1
  assert(fragile! u.get_var() == 1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A unit type may inherit a trait.
The trait&#8217;s methods become "instance" methods of the unit type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">trait Foo {
  decl foo()
  def bar() -&gt; this.foo()
  static def baz() -&gt; "qux"
}

unit Unit : Foo {
  impl foo() -&gt; 42
}

assert(Unit.bar() == 42) # OK
# Unit::baz()            # Panic! Undeclared `Unit::baz()` (static members aren't derived)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_nil"><a class="link" href="#_nil">5.5.1. <code>nil</code></a></h4>
<div class="paragraph">
<p>\$tt "nil"\$ is the only builtin unit type.</p>
</div>
<div class="paragraph">
<p>It is one of the three falsey values in Onyx, along with <a href="#_bool">\$tt "false"\$</a> and <a href="#_void">\$tt "void"\$</a>.
However, unlike \$tt "void"\$, \$tt "nil"\$ is a unit type, therefore it can be used in runtime.</p>
</div>
<div class="paragraph">
<p>A type may be suffixed with <code>?</code>, which turns it into a nilable <a href="#_variant">variant</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">@assert(User? :? Variant&lt;User, nil&gt;)
@assert(@same?&lt;User?, Variant&lt;User, nil&gt;&gt;()) # TODO:</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_annotation"><a class="link" href="#_annotation">5.6. Annotation</a></h3>
<div class="paragraph">
<p>An annotation type may only be declared, but not implemented.
Annotations are used in <a href="#_macros">macros</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">annotation MyAnnotation&lt;T ~ \string&gt; # `decl` is implied

@[MyAnnotation&lt;"foo"&gt;]
class User;

\{% nx["User"].annotations[0].type["T"].value == "foo" %}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Application of an annotation type which inherits another annotation applies the inherited annotation to the entity the original annotation is being applied to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">annotation Foo&lt;T ~ \string&gt;
annotation Bar&lt;T ~ \string, U ~ \uint&gt; : Foo&lt;T&gt;

@[Bar&lt;"baz", 42&gt;] # Also applies `Foo&lt;"baz"&gt;`
class User;

{% print nx["User"].annotations.map(&amp;.type.name).includes?("Foo") %} # =&gt; true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_builtin_type"><a class="link" href="#_builtin_type">6. Builtin type</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>builtin type</em> doesn&#8217;t require explicit <a href="#_onyx_source_files">importing</a>, i.e. is always globally accessible; it is also likely to have a literal.</p>
</div>
<div class="paragraph">
<p>Following the general design principles of Onyx, FPU and MCU presence is assumed for a target machine.
Therefore, builtin types include those relying on floating point, vector and dynamic memory access operations.</p>
</div>
<div class="paragraph">
<p>This section gives an overview of the builtin types.</p>
</div>
<div class="sect2">
<h3 id="_utility_types"><a class="link" href="#_utility_types">6.1. Utility types</a></h3>
<div class="sect3">
<h4 id="_bool"><a class="link" href="#_bool">6.1.1. <code>Bool</code></a></h4>
<div class="paragraph">
<p>The boolean type with two values: <code>true</code> and <code>false</code>; these are also literals.
<code>false</code> is one of the three falsey values in Onyx, along with <a href="#_nil">Section 5.5.1, &#8220;<code>nil</code>&#8221;</a> and <a href="#_void">Section 6.1.2, &#8220;<code>void</code>&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>The memory layout of <code>Bool</code> is undefined.
There are built-in method to convert to integers, including to a single <code>Bit</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_void"><a class="link" href="#_void">6.1.2. <code>void</code></a></h4>
<div class="paragraph">
<p><code>void</code> is a special type implying absense of value.
Instead of having a zero size, <code>void</code> doesn&#8217;t have size at all.</p>
</div>
<div class="paragraph">
<p>The semantics is equivalent to such in C.
In fact, <code>void</code> is interchangeable with <code>$void</code>.</p>
</div>
<div class="paragraph">
<p>It is not possible to assign a <code>void</code> value.
The only exception is assigning to a void-able variant; in such cases <code>void</code> acts as a unit type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">var : Variant&lt;User?, void&gt; = void # OK, it's now neither `nil` nor a `User` instance</code></pre>
</div>
</div>
<div class="paragraph">
<p>Along with <a href="#_bool"><code>false</code></a> and <a href="#_nil">Section 5.5.1, &#8220;<code>nil</code>&#8221;</a>, <code>void</code> is a falsey <sub>value</sub> entity.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discard"><a class="link" href="#_discard">6.1.3. <code>discard</code></a></h4>
<div class="paragraph">
<p>When used as a return type restriction, <code>discard</code> utility type allows the callee to return literally anything, but caller would always treat it as <code>void</code>.
In practice, this means <em>"return anything, it&#8217;d be discarded anyway"</em> without enforcing the <code>void</code> return type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl foo(block : T =&gt; void) : void
decl bar(block : T =&gt; discard) : void

[1, 2].foo(e =&gt; e * 2) # Panic! Must return `void`, returns `Int32`

# The returned value of the block is still `Int32`,
# but it's discarded and thus legal.
[1, 2].bar(e =&gt; e * 2) # OK</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def sum(a, b) : discard
  return a + b
end

# let result = sum(1, 2) # Panic! Can not assign `void`</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_numbers"><a class="link" href="#_numbers">6.1.4. Numbers</a></h4>
<div class="paragraph">
<p>Onyx follows <a href="https://en.wikipedia.org/wiki/Number">Wikipedia</a> in terms of numeric types hierarchy.</p>
</div>
<div class="sect4">
<h5 id="_real_numbers"><a class="link" href="#_real_numbers">Real numbers</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In mathematics, a real number is a value of a continuous quantity that can represent a distance along a line (or alternatively, a quantity that can be represented as an infinite decimal expansion).</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia contributors<br>
<cite><a href="https://en.wikipedia.org/wiki/Real_number" class="bare">https://en.wikipedia.org/wiki/Real_number</a></cite>
</div>
</div>
<div class="paragraph">
<p>In Onyx, a <em>real number</em> type \$RR\$ simply derives the <code>Real</code> trait which in turn is a distinct alias to the zero-dimension <code>Hypercomplex&lt;0&gt;</code> specialization.</p>
</div>
<div class="paragraph">
<p>Bultin real number types are are <code>Int</code>, <code>Float</code> and <code>Fixed</code>.</p>
</div>
<div class="sect5">
<h6 id="_int"><a class="link" href="#_int"><code>Int</code></a></h6>
<div class="ulist">
<ul>
<li>
<p><code>Int*</code>&#8201;&#8212;&#8201;a signed binary integer with variable bitsize;</p>
</li>
<li>
<p><code>UInt*</code>&#8201;&#8212;&#8201;an unsigned binary integer with variable bitsize;</p>
</li>
<li>
<p><code>Bit</code></p>
</li>
<li>
<p><code>Byte</code>&#8201;&#8212;&#8201;alias to <code>UInt8</code>;</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_float"><a class="link" href="#_float"><code>Float</code></a></h6>
<div class="ulist">
<ul>
<li>
<p><code>Float*</code>&#8201;&#8212;&#8201;an IEEE 754 binary floating point number with variable bitsize;</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_fixed"><a class="link" href="#_fixed"><code>Fixed</code></a></h6>
<div class="paragraph">
<p><code>1q8.2 : Fixed8&lt;2&gt;</code>, <code>1uq8.2 : UFixed8&lt;2&gt;</code>, <code>0xabq8.2</code></p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_hyper_complex_numbers"><a class="link" href="#_hyper_complex_numbers">Hyper complex numbers</a></h5>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In mathematics, hypercomplex number is a traditional term for an element of a finite-dimensional unital algebra over the field of real numbers.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia contributors<br>
<cite><a href="https://en.wikipedia.org/wiki/Hypercomplex_number" class="bare">https://en.wikipedia.org/wiki/Hypercomplex_number</a></cite>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Hypercomplex&lt;T, D&gt;</code>&#8201;&#8212;&#8201;a hypercomplex number;</p>
</li>
<li>
<p><code>Complex&lt;T&gt; : Hypercomplex&lt;T, 1&gt;</code>&#8201;&#8212;&#8201;a complex number, e.g. <code>2 + 1j</code>;</p>
</li>
<li>
<p><code>Quaternion&lt;T&gt; : Hypercomplex&lt;T, 4&gt;</code>&#8201;&#8212;&#8201;a quaternion;</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ratio"><a class="link" href="#_ratio">6.1.5. <code>Ratio</code></a></h4>
<div class="paragraph">
<p><code>Ratio&lt;T&gt;</code>&#8201;&#8212;&#8201;a number ratio, e.g. <code>1 / 2 : Ratio&lt;Int32&gt;</code>;</p>
</div>
</div>
<div class="sect3">
<h4 id="_range"><a class="link" href="#_range">6.1.6. <code>Range</code></a></h4>
<div class="paragraph">
<p><code>Range&lt;T&gt;</code>&#8201;&#8212;&#8201;a range, e.g. <code>1..10 : Range&lt;Int32&gt;</code>;</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pointer"><a class="link" href="#_pointer">6.2. Pointer</a></h3>
<div class="paragraph">
<p>In Onyx, a <code>Pointer</code> type declares template arguments defining the pointee type, the pointer storage and its writeability.
Safe operations are available for a subset of the pointer type specializations based on latter two.</p>
</div>
<div class="paragraph">
<p>A <code>Pointer&lt;Type, Storage, Writeable&gt;</code> type may shortcut as <code>Type*\$sw\$</code>; where \$s\$ is one of <code>l</code> for <strong>l</strong>ocal storage, <code>s</code> for <strong>s</strong>tatic storage, or <code>u</code> or empty for <strong>u</strong>ndefined (default) storage; and \$w\$ is either <code>w</code> for <strong>w</strong>riteable, or <code>W</code> or empty for non-writeable (default).
For example, <code>Int32*uW : Int32*</code>, a non-writeable undefined-storage pointer to <code>Int32</code>.</p>
</div>
<div class="paragraph">
<p>Syntax of taking a pointer at a variable in Onyx is similar to such in C, the <code>&amp;var</code> operator is used.
Taking a pointer at a local or static variable, or a local or static record or struct variable field, returns a pointer with same storage and writeability as the variable.
A class field pointer has undefined storage, because the class instance may die.</p>
</div>
<div class="paragraph">
<p>A pointer may be dereferenced using the <code>*ptr</code> operator, also similar to C.
Assigning a dereferenced pointer copies the pointee value.
Assigning to a dereferenced writeable pointer rewrites the pointee.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = 42
final ptr = &amp;x : Pointer&lt;Int32, "local", true&gt; : Int32*lw

*ptr = 43      # Rewrite the pointee data, threadsafe
final y = *ptr # Copy the pointee data, also threadsafe

assert(y == 43)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_pointer_storage"><a class="link" href="#_pointer_storage">6.2.1. Pointer storage</a></h4>
<div class="paragraph">
<p>A pointer storage may be one of <code>"local"</code>, <code>"static"</code> or <code>"undefined"</code>.</p>
</div>
<div class="paragraph">
<p>A <em>local pointer</em> points at the program stack.
Dereferencing a local pointer is threadsafe, but you can not pass it outside of the stack, i.e. assign it to a class field or to a static variable.</p>
</div>
<div class="paragraph">
<p>A <em>static pointer</em> is located elsewhere, but is guaranteed to be accessible with at least fragile-level safety for the whole lifespan of the program.
Dereferencing a static pointer is fragile, but it can be passed around safely.</p>
</div>
<div class="paragraph">
<p>Dereferencing a pointer with undefined storage is unsafe, because it gives zero guarantees about memory placement and availability.
An <em>undefined pointer</em> can be passed around safely; all other storages can be safely cast to an undefined.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pointer_autocasting"><a class="link" href="#_pointer_autocasting">6.2.2. Pointer autocasting</a></h4>
<div class="paragraph">
<p>When assigned, a pointer may be safely autocast in accordance with <a href="#_table_pointer_storage_autocasting">Table 1, &#8220;Pointer storage autocasting&#8221;</a>.
The writeability modifer can also be autocast to false.
For example, a read-only static pointer can not be safely cast to a writeable local pointer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The "instance" storage is yet to be documented.
</td>
</tr>
</table>
</div>
<table id="_table_pointer_storage_autocasting" class="tableblock frame-all grid-all stretch">
      <caption class="title"><a href="#_table-1" id="_table-1" class="table-caption-link">Table 1. Pointer storage autocasting</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Storage</th>
<th class="tableblock halign-left valign-top">To <code>"local"</code></th>
<th class="tableblock halign-left valign-top">To <code>"instance"</code></th>
<th class="tableblock halign-left valign-top">To <code>"static"</code></th>
<th class="tableblock halign-left valign-top">To <code>"undefined"</code></th>
<th class="tableblock halign-left valign-top">Outer scope?</th>
<th class="tableblock halign-left valign-top">Dereferencing</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>"local"</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">N/A</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Threadsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">No</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Threadsafe</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>"instance"</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">N/A</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Threadsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">No</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Fragile</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>"static"</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Threadsafe <i class="conum" data-value="1"></i><b>(1)</b></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">N/A</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Threadsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Yes</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Fragile</p>
</td>
</tr>
<tr>
<td class="tableblock halign-left valign-top">                  <p class="tableblock"><code>"undefined"</code></p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">N/A</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Yes</p>
</td>
<td class="tableblock halign-left valign-top">                  <p class="tableblock">Unsafe</p>
</td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><i class="conum" data-value="1"></i><b>(1)</b> Static storage contains instance storage.</p>
</div>
<div class="paragraph">
<p>A class instance can be safely cast to a read-only \$tt"void"\$ pointer with <code>"undefined"</code> storage, suitable for <a href="#_interop">interoperability</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_string"><a class="link" href="#_string">6.3. String</a></h3>
<div class="paragraph">
<p><code>"Invalid index #{ index }"</code> calls <code>.to&lt;String&gt;()</code> on interpolations.</p>
</div>
<div class="sect3">
<h4 id="_char"><a class="link" href="#_char">6.3.1. Char</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="_builtin_containers"><a class="link" href="#_builtin_containers">6.4. Builtin containers</a></h3>
<div class="paragraph">
<p>A builtin container has its size known in advance and is thus allocated on stack.
A container literal commonly allows trailing commas.</p>
</div>
<div class="sect3">
<h4 id="_tuple"><a class="link" href="#_tuple">6.4.1. Tuple</a></h4>
<div class="paragraph">
<p>A <em>tuple</em> is a non-empty stack-allocated ordered sequence of heterogeneous elements.
A tuple literal is a sequence of comma-separated elements wrapped in parentheses with trailing comma allowed, e.g. <code>(a, b)</code>.</p>
</div>
<div class="paragraph">
<p>A single-element tuple is called a <em>monuple</em>.
A monuple can have its parentheses omitted.
Therefore, <code>Tuple&lt;T&gt;</code> \$-=\$ <code>(\$tau\$)</code> \$-=\$ <code>(\$tau\$,)</code> \$-=\$ <code>\$tau\$</code> \$-=\$ <code>Tuple&lt;(\$tau\$)&gt;</code> \$-=\$ <code>Tuple&lt;Tuple&lt;\$tau\$&gt;&gt;</code> etc.</p>
</div>
<div class="paragraph">
<p>A tuple may be safely interpreted as an <a href="#_array">array</a> or <a href="#_tensor">tensor</a> if its elements are actually homogeneous.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">(1, 2) : Tuple&lt;Int32, Int32&gt; as Int32[2] as 2xInt32 # Safe</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_array"><a class="link" href="#_array">6.4.2. Array</a></h4>
<div class="paragraph">
<p>An <em>array</em> is a non-empty statically-sized stack-allocated ordered sequence of homogeneous elements.</p>
</div>
<div class="paragraph">
<p>As a syntactic sugar, <code>Array&lt;\$tau\$, \$NN\$&gt;</code> \$-=\$ <code>\$tau\$[\$NN\$]</code>, e.g. <code>Array&lt;Int32, 2&gt;</code> \$-=\$ <code>Int32[2]</code>.
Absense of size (e.g. <code>Int32[]</code>) implies <a href="#_slice"><code>Slice</code></a>, not array.</p>
</div>
<div class="paragraph">
<p>An array literal is wrapped in square brackets with traling comma allowed, e.g. <code>[1, 2]</code>.
A magic array literal removes the need for commas and allows the underlying-type defining suffix.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">[1f, 2f] == %[1 2]f : Float64[2]</code></pre>
</div>
</div>
<div class="paragraph">
<p>An array instance may be safely interpreted as a <a href="#_tensor">tensor</a> or a <a href="#_tuple">tuple</a> instance, and vice versa if the elements are actually homogeneous.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">[1, 2] : Int32[2] as (Int32, Int32) as 2xInt32 # Safe</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tensor"><a class="link" href="#_tensor">6.4.3. Tensor</a></h4>
<div class="paragraph">
<p>A tensor is a non-empty multi-dimensional <a href="#_array">array</a> with tensor-specific functionality.
A compiler is expected to optimize tensor operations; it also moves number-array-specific features (e.g. \$o.\$) into a separate entity.</p>
</div>
<div class="paragraph">
<p>A tensor type <code>Tensor&lt;\$tau\$, *\$NN\$&gt;</code> can be shortcut as <code>\$NN\$x\$tau\$</code>, e.g. <code>Tensor&lt;Int32, 2, 3&gt;</code> \$-=\$ <code>2x3xInt32</code>.
There are distinct aliases for vectors (<code>Vector&lt;\$tau\$, size&gt;</code>) and matrices (<code>Matrix&lt;\$tau\$, Rows, Columns&gt;</code>).</p>
</div>
<div class="paragraph">
<p>Comma-separated tensor literal elements are wrapped in pipes, with each comma-separated row wrapped in square brackets, e.g. <code>|1, 2, 3, 4|</code> \$-=\$ <code>|[1, 2, 3, 4]|</code>.
A tensor literal may have an underlying-type-defining suffix.
A magic tensor literal removes the need for commas and allows the underlying-type defining suffix.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">|1, 2, 3, 4| : Vector&lt;Int32, 4&gt; : 4xInt32

%|[1 2]
  [3 4]|f : Matrix&lt;Float64, 2, 2&gt; : 2x2xFloat64

%|[[1 2][3  4]]
  [[5 6][7 20]]| : Tensor&lt;Int32, 2, 2, 2&gt; : 2x2x2xFloat32</code></pre>
</div>
</div>
<div class="paragraph">
<p>A tensor instance may be safely interpreted as an <a href="#_array">array</a> or <a href="#_tuple">tuple</a> instance and vice versa if the elements are actually homogeneous.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">|1, 2, 3, 4| : 4xInt32 as
  Int32[4] as
  (Int32, Int32, Int32, Int32) # Safe</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_variant"><a class="link" href="#_variant">6.5. Variant</a></h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In computer science, a tagged union, also called a variant […], is a data structure used to hold a value that could take on several different, but fixed, types.
Only one of the types can be in use at any one time, and a tag field explicitly indicates which one is in use.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia contributors<br>
<cite><a href="https://en.wikipedia.org/wiki/Tagged_union" class="bare">https://en.wikipedia.org/wiki/Tagged_union</a></cite>
</div>
</div>
<div class="paragraph">
<p>A possible variant value is called an <em>option</em> in Onyx.
Option type ordering in a variant type is irrelevant, i.e. <code>Variant&lt;\$tau\$, \$upsilon\$&gt;</code> \$-=\$ <code>Variant&lt;\$upsilon\$, \$tau\$&gt;</code>.</p>
</div>
<div class="paragraph">
<p>A variant constructor accepts either a narrower variant instance or an instance of one of its options type (i.e. may be autocast).</p>
</div>
<div class="exampleblock">
<div class="title">Example 12. Variant construction</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">final x : Variant&lt;Int32, String&gt; = 42         # OK, accepts an option instance
final y : Variant&lt;Int32, Float64, String&gt; = x # OK, accepts a narrower variant</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An actual variant instance option value may be extracted with either \$tt "@get"\$ or \$tt "@get?"\$ instrinsic invocation.
The <a href="#_safety">safety</a> of invoking an intrinsic depends on the instance <a href="#_storage">storage</a>: a local variant instance has threadsafe access, otherwise it&#8217;s fragile.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
You can explicitly obtain a variant tag offset in bytes using the \$tt "@offsetof"\$ intrinsic.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 13. Variant intrinsics</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">import rand from "std/rand"
import { out } from "std/term"

# TIP: The top-level scope is fragile.
#

final var = rand(42, "foo") : Variant&lt;Int32, String&gt;

final a = @get&lt;Int32&gt;(var) : Int32     # May throw `VariantError` if it's not `Int32`
final b = @get?&lt;String&gt;(var) : String? # May return `nil` if it's not `String`

# Unsafely get a `String` option.
final c = unsafe! *((&amp;var as void*)[@offsetof(var)] as String*)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_atomic"><a class="link" href="#_atomic">6.6. Atomic</a></h3>
<div class="paragraph">
<p>An <code>Atomic&lt;\$tau\$&gt;</code> type implementation contains a set of static atomic operations accepting a pointer to an object of type \$tau\$.
A threadsafe operation overload is performed with sequential consistency, i.e. the strongest memory ordering guarantees.
A fragile operation overload accepts an explicit <code>\MemoryOrdering</code> template argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = Box(42)

threadsafe! {
  fragile! x.value += 1 # Not threadsafe
  Atomic.incr(&amp;x.value) # Increment atomically with sequentially consistent ordering
  fragile! Atomic.incr&lt;:release&gt;(&amp;x.value) # Increment atomically with "release" ordering
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is a number of existing implementations for primitive types, e.g. <code>Atomic&lt;Int32&gt;</code>.
A programmer is also free to implement their own <code>Atomic</code> types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = Atomic&lt;Int32&gt;(0)

threadsafe! {
  x += 1 # Calls `Atomic&lt;Int32&gt;.+=`, which increments self atomically
  fragile! x.incr&lt;:release&gt;(1)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Without a <code>MemoryOrdering</code> template argument, a <code>@fence</code> instrinsic invocation emits a sequentially consistent fence.
Otherwise, the invocation is fragile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = Box(42)

threadsafe! {
  @fence() # Implicitly `@fence&lt;:seqcst&gt;()`, thus threadsafe

  fragile! @fence&lt;:acquire&gt;()
  fragile! box.value += 1
  fragile! @fence&lt;:release&gt;()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Atomic</code> functions and <code>@fence</code> intrinsic also accept a <code>SyncScope ~ \String</code> template argument, which defines its program-wide synchronization scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = 42

# These ops are *not* syncronised.
Atomic.incr&lt;"scope1"&gt;(&amp;x)
Atomic.incr&lt;"scope2"&gt;(&amp;x)</code></pre>
</div>
</div>
<div class="paragraph">
<p>An instance of <code>Atomic&lt;\$tau\$&gt;</code> declares a set of atomic access methods.
The Standards defines a list of atomic specializations, e.g. <code>Atomic&lt;Int32&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = Atomic&lt;Int32&gt;(0)
x += 1 # Atomically increment with implicit sequential consistency
x.+=&lt;:acquire, "scope2"&gt;(1) # A verbose call</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lambda"><a class="link" href="#_lambda">6.7. Lambda</a></h3>
<div class="paragraph">
<p>A <em>lambda</em> in Onyx is a <a href="#_class">class</a> containing a function and a closure instance.
A lambda is denoted by the <code>~&gt;</code> arrow.</p>
</div>
<div class="paragraph">
<p>A lambda&#8217;s closure fields are considered the lambda&#8217;s; it&#8217;s a class, therefore a field access is always fragile.</p>
</div>
<div class="paragraph">
<p>A lambda&#8217;s function is invoked by calling the lambda instance with the function&#8217;s safety.
By default, the function safety is inferred from the scope the lambda is being created in.
The function body has access to the lambda&#8217;s instance variable via \$tt "this"\$.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = 0

# The storage modifier can be omitted here
# due the containing scope also being fragile.
let lambda = fragile [{
  # Enclosing a variable pointer is deemeed as moving it to an outer scope, which is unsafe.
  # It may be cast to another pointer storage, which would also be unsafe. The exact flow
  # depends on the application's requirements. If the lambda outlies this function,
  # the pointer is better have undefined storage for unsafe access.
  final ptr = unsafe! &amp;x as Int32*w
}](mod : Int32) ~&gt; {
  *this.ptr += mod
}

lambda(1)
lambda.Lambda(2)
Lambda:Lambda(lambda, 3)

assert(x == (unsafe! *lambda.ptr) ==&lt; 6)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_literal"><a class="link" href="#_literal">7. Literal</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>literal</em> is a hard-coded value, e.g. <code>42</code> or <code>"foo"</code>.</p>
</div>
<div class="paragraph">
<p>When used in runtime, a literal creates an instance of inferred or restricted type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = 42           # : Int32
let x = 42f          # : Float64
let x : Float64 = 42 # : Float64

def foo(arg : Float64) -&gt; arg : Float64
assert(foo(42) == foo(42f))</code></pre>
</div>
</div>
<div class="paragraph">
<p>A literal may also be used as a template argument.
The template argument may then be used as if it was a real literal.
Only <code>\Int</code>, <code>\UInt</code>, <code>\Bool</code>, <code>\String</code> and enum (see <a href="#_enum_template_argument">Section 5.4.2, &#8220;Enum template argument&#8221;</a>) may be used as a literal restriction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo&lt;L ~ \UInt&gt; {
  def foo() -&gt; L
}

assert(Foo&lt;42&gt;().foo() == 42 : UInt32)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_literal_suffix"><a class="link" href="#_literal_suffix">7.1. Literal suffix</a></h3>
<div class="paragraph">
<p>A literal may have a <em>literal suffix</em> to narrow the resulting type.
For example, <code>42 : Float64</code> is legal, but <code>42i : Float64</code> is not: the latter is narrowed to be an integer.</p>
</div>
</div>
<div class="sect2">
<h3 id="_magic_literal"><a class="link" href="#_magic_literal">7.2. Magic literal</a></h3>
<div class="paragraph">
<p>A <em>magic literal</em> (a term borrowed from Ruby) begins with <code>%</code>.</p>
</div>
<div class="paragraph">
<p>An <a href="#_array">array</a> or <a href="#_tensor">tensor</a> magic literal only contains literal values, which allows to get rid of commas, and to append an underlying type <a href="#_literal_suffix">suffix</a>.</p>
</div>
<div class="paragraph">
<p>If the very first value of an array magic literal is an alpha character, then it&#8217;s deemed to be a <code>String</code> array (it can be enforced with a <code>s</code> suffix).
The <code>c</code> suffix would make it an array of <code>Char</code> instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">%[hello world] : String[2]
%[hello world]c : Char[11]</code></pre>
</div>
</div>
<div class="paragraph">
<p>A magic literal wrapped in parentheses or brackets is deemed to be a single <code>String</code> literal allowing double quotes within.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">%("Hello, world") == %{"Hello, world"} |== %&lt;"Hello, world"&gt; : String</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_variable"><a class="link" href="#_variable">8. Variable</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>An Onyx <em>variable</em> is defined with \$tt "let"\$ keyword.
For C variables, see <a href="#_interoperability">Section 13, &#8220;Interoperability&#8221;</a>.</p>
</div>
<div class="paragraph">
<p>A variable can be reassgined and mutated.
If a variable declared with \$tt "let final"\$ or simply \$tt "final"\$, it becomes a <em>final</em> variable.
A final variable can not be reassigned.
A final <a href="#_record">record</a> or <a href="#_struct">struct</a> variable is deemed a collection of forcebly-final fields and thus becomes immutable; whereas a final <a href="#_class">class</a> variable is still mutable, i.e. its fields may be changed.</p>
</div>
<div class="paragraph">
<p>A variable identifier shall match the following regular expression: <code>/[a-zA-Z_](a-zA-Z0-9_)*/</code>.
Otherwise, it is wrapped in backticks; in that case, the identifer may contain any Unicode character except a backtick.</p>
</div>
<div class="paragraph">
<p>A variable always has concrete type in runtime.
It may be restricted to a type upon definition or access using the <code>\$var\$ : \$tau\$</code> notation.
Otherwise the type is inferred, if possible.
See <a href="#_type_restriction">[_type_restriction]</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let x = 42
x = 43 # OK

final `ё` : Int32 = 44
# `ё` = 45 # Panic! Can not assign to a final variable</code></pre>
</div>
</div>
<div class="paragraph">
<p>A redefinition of a variable with the same identifer and type is legal.</p>
</div>
<div class="sect2">
<h3 id="_variable_storage"><a class="link" href="#_variable_storage">8.1. Variable storage</a></h3>
<div class="paragraph">
<p>A variable has <em>storage</em>.
An on-stack variable is <em>local</em>, accessing it is threadsafe.
A <em>static</em> variable is defined in the top-level or <a href="#_unit">unit</a> scope, or with an explicit \$tt "static"\$ modifier; accessing it is fragile.
A class field has <em>instance storage</em>, and its access is fragile as well.</p>
</div>
<div class="paragraph">
<p>A pointer to a variable respects its writeability and storage.
A class field pointer has undefined storage, because the class instance may eventually die.
See <a href="#_pointer">Section 6.2, &#8220;Pointer&#8221;</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_assignment"><a class="link" href="#_assignment">8.2. Assignment</a></h3>
<div class="paragraph">
<p>A <a href="#_record">record</a>, <a href="#_struct">struct</a>, <a href="#_enum">enum</a>, <a href="#_variant">variant</a> or <a href="#_function">function</a> instance is assigned by value, i.e. copied.
A <a href="#_class">class</a> (including <a href="#_lambda">lambda</a>) instance is assigned by reference; the reference counter is implicitly incremented upon assignment and decremented upon leaving the scope (see <a href="#_gc">Section 5.3.2, &#8220;GC&#8221;</a>).
A freestanding (i.e. not contained in a variant) <a href="#_unit">unit</a> and <a href="#_void">\$tt "void"\$</a> don&#8217;t have size and therefore its underlying assignment mechanism is undefined; moreover, \$tt "void"\$ can not be assigned at all.</p>
</div>
<div class="paragraph">
<p>If an assignment operation has a receiver, its result would be yet another copy of the assigned value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">class Dog {
  let name : String
  static self(name) -&gt; self({ name })
}

final spike = Dog("Spike")        # Reference is created, RC = 1
final friend = spike              # Reference is copied, RC = 2
final good_boy = (friend = spike) # Another reference is copied, RC = 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assigning or passing a <a href="#_literal">literal</a> creates a new object instance with type depending on the literal itself and its restriction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let x : UInt32 = 42 # Would be `Int32` without the restriction
let y = x           # Copy the `x` value and set `y` to it</code></pre>
</div>
</div>
<div class="paragraph">
<p>A compiler would panic if it detects a use of an undefined yet variable or a variable which hasn&#8217;t been assigned yet.
A variable may be unsafely assigned an explicitly \$tt "unitialized"\$ value, though.
Accessing it would be an undefined behaviour.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx"># x = 42 # Panic! Undeclared variable `x`

let x = unsafe! uninitialized Int32 # OK

x # Accessing `x` here is undefined behaviour

x = 42
x # OK, it's now safe</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_multi_assignment"><a class="link" href="#_multi_assignment">8.2.1. Multi-assignment</a></h4>
<div class="paragraph">
<p>Multiple variables can be assigned at once, also during definition (called <em>multi-definition</em>).</p>
</div>
<div class="paragraph">
<p>When assigning to a single value, <code>x, y = z</code> ≡ <code>(x = (y = z))</code>.
Therefore, the latest inferred type wins, unless explicitly restricted.</p>
</div>
<div class="listingblock">
<div class="title">Multi-assignment of a single value</div>
<div class="content">
<pre class="highlight"><code class="language-onyx==" data-lang="onyx==">let x, y, final z : UInt32 = 1 # OK, all three are `UInt32`

# Equivalent to:
#

final z = 1 : UInt32
let y = z
let x = y</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple variables may also be assigned to the same amount of values, not just a single one.</p>
</div>
<div class="listingblock">
<div class="title">Multi-assignment of multiple values</div>
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx"># final x, y = 1, 2, 3 # =&gt; Panic! Multiple assignment mismatch
  final x, y = 1, 2    # OK</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_splatting"><a class="link" href="#_splatting">Splatting</a></h5>
<div class="paragraph">
<p>A record, tuple, array or tensor container can be <em>splatted</em> using the <code>*</code> operator.
A compiler treats a splatted container as if its elements were hard-coded into the source code one-by-one, comma-separated, which suits multi-assignment.
A splatted record also includes its fields' labels.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You may imagine the splat operator as a road roller flattening its operand into the source code.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx"># These are all equivalent.
let x, y = *(a, b)
let x, y = *[a, b]
let x, y = *|a, b|
let x, y = *{ x: a, y: b }
let x, y = a, b</code></pre>
</div>
</div>
<div class="paragraph">
<p>A variable definition may be labeled to map a splatted record&#8217;s field.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">final record = { x: 1, y: 2 }

final x: a, y = *record

# assert(x == 1) # =&gt; Panic! Undeclared `x`
assert(a == 1)   # OK
assert(y == 2)   # OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>Pointer dereferencing operation has higher precedence than splatting.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let tuple = (a, b)
let x, y = **&amp;tuple # First, dereference the tuple. Then, splat it</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also see <a href="#_unsplatting">Section 10.1.1, &#8220;Unsplatting&#8221;</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_autocasting"><a class="link" href="#_autocasting">8.2.2. Autocasting</a></h4>
<div class="paragraph">
<p>There is just a little assignment autocasting in Onyx.
Note that assignment is a copy operation, passing an argument is therefore also considered an assignment.
Autocasting, on the other hand, is not an operation, but a compiler instruction.</p>
</div>
<div class="paragraph">
<p>A pointer type may be autocast based on its properties.
A variant may be assigned its option type instance.
Callables (function, lambda, <a href="#_generator">generator</a>) also have specific autocasting rules.
A record, struct, class, unit or enum instance may be implicitly upcast to an ancestor type.</p>
</div>
<div class="paragraph">
<p>Anything else requires explicit casting with \$tt "as"\$ operator, or conversion of some sort.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let x : Int32 = 42

# let y : Float64 = x   # Panic! Can not assign `Int32` to `Float64`
let y = x.to&lt;Float64&gt;() # OK

class Animal { }
class Dog : Animal { }

final animal : Animal = Dog() # OK</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_field"><a class="link" href="#_field">8.3. Field</a></h3>
<div class="paragraph">
<p>A variable defined with an (implicit) instance <a href="#_storage">storage</a> within a record, struct or class type is called a <em>field</em>.</p>
</div>
<div class="paragraph">
<p>A \$tt "final"\$ record or struct variable is deemeed immutable: its fields can not be reassigned.
A \$tt "final"\$ class variable, on the other hand, allows updating its fields as long as they are public.</p>
</div>
<div class="paragraph">
<p>Accessing a field of a local record or struct variable is threadsafe.
If the variable is static, the access is fragile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Point {
  let x, y : Float64
  def length() -&gt; (this.x ** 2 + this.y ** 2).sqrt()
}

let point = Point({ x: 3, y: 4}) # A local struct variable

assert(point.x == 3)                # Threadsafe field access
assert(point.length() ~= *(5, 0.1)) # Threadsafe method access</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_default_field_value"><a class="link" href="#_default_field_value">8.3.1. Default field value</a></h4>
<div class="paragraph">
<p>A field may have a <em>default value</em> expression, which is evaluated in a threadsafe context if the field is not explicitly initialized upon the containing object creation.
A unit field must always have a default value set.</p>
</div>
<div class="paragraph">
<p>It is legal to override a field with the same type and any default value, even none.
The latest default value expression wins.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Point {
  let x, y : Float64 = 0
}

assert(Point({ x: 0, y: 0 }) == Point())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Within a field default value expression, another field may be accessed via querying \$tt "this"\$ or directly if it is in the same scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let a = 42 # Static variable

struct Foo {
  let x = a        # OK, `a` defined in the top level
  let y = x        # OK
  let z = this.y   # Also OK
  # let b = this.b # =&gt; Panic! Recursive field access
}

extend Foo {
  let x = 43     # OK, same type
  # let c = y    # =&gt; Panic! Did you mean `this.y`?
  let c = this.y # OK
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_accessor"><a class="link" href="#_accessor">8.3.2. Accessor</a></h4>
<div class="paragraph">
<p>Defining a field with \$tt "let"\$ generates a <a href="#_public">public</a> <a href="#_getter">getter</a> and a public <a href="#_setter">setter</a>, collectively referenced to as <em>accessors</em>.</p>
</div>
<div class="paragraph">
<p>Both fragile and threadsafe accessors are implemented for a field, unless a custom getter or setter is implemented.</p>
</div>
<div class="paragraph">
<p>Within a containing type&#8217;s method, \$tt "this"\$ evaluates to an instance of that type.
A field lookup is only possible on <code>this</code>, i.e. it can&#8217;t be accessed from within a method scope.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct T {
  let field : Int32 = 0

  def foo() {
    # field         # Panic! Undeclared variable `field`
    this.field      # OK, getter
    this.field = 42 # OK, setter
  }
}

T().field
T().field = 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>A \$tt "final"\$ definition generates a public getter only.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct T {
  final field : Int32 = 0

  def foo() {
    this.field
    # this.field = 42 # Panic! Undeclared method `T:field=`
  }
}

T().field
# T().field = 42 # Panic! Ditto</code></pre>
</div>
</div>
<div class="paragraph">
<p>A special \$tt "getter"\$ defintion generates a public getter and a <a href="#_private">private</a> setter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct T {
  getter field : Int32 = 0

  def foo() {
    this.field
    this.field = 42
  }
}

T().field
# T().field = 42 # Panic! `T.field` is private</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getter"><a class="link" href="#_getter">8.3.3. Getter</a></h4>
<div class="paragraph">
<p>A <em>getter</em> counts as a declared function implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">trait Foo {
  decl foo() : Int32
}

struct Bar : Foo {
  let foo : Int32 = 0
}

Bar().foo
Bar().foo()
Bar()~Foo.foo()

struct Baz {
  let foo : Int32 = 0
}

Baz().foo
# Baz().foo() # =&gt; Panic! Undeclared `Baz.foo()`</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setter"><a class="link" href="#_setter">8.3.4. Setter</a></h4>
<div class="paragraph">
<p>A function with name ending with <code>=</code> is called a <em>setter</em>.</p>
</div>
<div class="paragraph">
<p>A setter may be called without parentheses, e.g. <code>obj.field = y</code> ≡ <code>obj.field=(y)</code>.</p>
</div>
<div class="paragraph">
<p>A \$tt "let"\$ or \$tt "getter"\$ field definition implicitly defines a setter for the field, which may be overriden in a class type only.
If a field is defined without a setter (i.e. with \$tt "final"\$), it may still be defined explicitly; it makes little sense for a struct, though, as its \$tt "this"\$ is a read-only copy.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>An assignment almost always implies a copy operation in runtime, so it may be treated as a call.
Sometimes you want a class to be reactive to its field changes.
Therefore it would be handy to be able to override class setters.</p>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class Scheduler {
  # Could've been defined with `let`,
  # but for readability purposes
  # `getter` is preferred here.
  getter workers : USize

  public reimpl workers=(value) {
    # Access the previous value.
    print("Previous value: #{this.workers}")

    # React to the update. Note that `this.workers` value hasn't been updated yet.
    internal_resize(value)

    # Explicitly update the value.
    this.workers = value
  }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_special_field_assignment"><a class="link" href="#_special_field_assignment">Special field assignment</a></h5>
<div class="paragraph">
<p>A <em>special field assignment</em> <code>obj.field \$AA\$= value</code>, where \$AA\$ is a sequence of operator chars (one of <code>~%^&amp;*-+</code>) implicitly expands to <code>obj.field = obj.field \$AA\$ value</code>, e.g. <code>x.y += 1</code> &#8594; <code>x.y = x.y + 1</code> and it <strong>can not</strong> be overriden to avoid unexpected behaviour.</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. Special field assignment</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo {
  let bar : Int32

  # If indirect setter overriding was allowed...
  reimpl bar+=(value) {
    super(value * 2)
  }
}

let foo = Foo({ bar: 0 })
foo.bar += 1
foo.bar == 2 # Wut?</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_index_accessor"><a class="link" href="#_index_accessor">8.3.5. Index accessor</a></h4>
<div class="paragraph">
<p>An <em>index accessor</em> implements indexed access behaviour, where an entity is accessed not by its static name, but some runtime value.
<a href="#_special_field_assignment">Special assignment</a> syntax sugar is preserved.
Index accessors are usually implemented for indexable, e.g. container, types.</p>
</div>
<div class="exampleblock">
<div class="title">Example 15. Index setters</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class List&lt;T&gt; {
  decl [](index : SSize) -&gt; T
  decl []=(index : SSize, value : T) -&gt; T
}

let list = List([1, 2])

assert(list[0] == list.[](0))

list[0] = 3
list.[]=(0, 3)

list[0] += 1
list[0] = list[0] + 1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jump"><a class="link" href="#_jump">9. Jump</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <em>jump</em> statement alters the code execution flow based on some condition.</p>
</div>
<div class="sect2">
<h3 id="_if"><a class="link" href="#_if">9.1. <code>if</code></a></h3>
<div class="paragraph">
<p>An \$tt "if"\$ statement implements conditional jump.
It may have zero or more additional \$tt "elif"\$ branches, and at most one \$tt "else"\$ branch.</p>
</div>
<div class="paragraph">
<p>A branch condition is a runtime expression always wrapped in parentheses.
A branch condition expression is <em>falsey</em> if it evaluates to either <a href="#_bool">\$tt "false"\$</a>, <a href="#_nil">\$tt "nil"\$</a> or <a href="#_void">\$tt "void"\$</a>; otherwise it&#8217;s <em>truthy</em>.</p>
</div>
<div class="paragraph">
<p>A branch body must be wrapped in brackets unless it&#8217;s a single expression.
A branch body may be optionally delimeted with \$tt "then"\$ for readability, regardless of brackets; \$tt "else then"\$ is illegal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let x = 42

if (x &gt; 0) { foo() }
elif (x == 0) then bar()
else
  baz()</code></pre>
</div>
</div>
<div class="paragraph">
<p>A variable defined in a condition expression is accessible from within all following branch bodies.
If a branch condition expression evaluates to a <a href="#_variant">variant</a> instance, then the actual variant option is compared.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let var = rand(42, "foo") : Variant&lt;Int32, String&gt;

if (final x = @get?&lt;Int32&gt;(var) : Int32?) {
  x : Int32
} else {
  # final x = @get&lt;String&gt;(var) # =&gt; Panic! `x` is already declared
  final y = @get&lt;String&gt;(var)   # OK, may throw if variant type is changed
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_while"><a class="link" href="#_while">9.2. <code>while</code></a></h3>
<div class="paragraph">
<p>A \$tt "while"\$ statement implements conditional loops.
A loop condition is similar to <a href="#_if">if</a>'s.
Similarly, a loop body must be wrapped in brackets unless it&#8217;s a single expression.
Also, a loop body may be optionally delimeted with \$tt "do"\$ for readability.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">while (cond?()) do_stuff()
while (cond?()) do { stuff() }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_switch"><a class="link" href="#_switch">9.3. <code>switch</code></a></h3>
<div class="paragraph">
<p>A \$tt "switch"\$ statement jumps based on an integral <em>switcher</em> value.</p>
</div>
<div class="paragraph">
<p>A \$tt "case"\$ branch condition is not a runtime expression: it doesn&#8217;t use parentheses, multiple conditions are comma-delimeted and <em>optionally</em> wrapped in square brackets instead.</p>
</div>
<div class="paragraph">
<p>A switcher may therefore be either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <code>~ Int</code> value with numeric literal cases;</p>
</li>
<li>
<p>A <a href="#_enum">enum</a> value with enum constant (or symbol) cases;</p>
</li>
<li>
<p>A <a href="#_class">class</a> or <a href="#_variant">variant</a> instance with actual type cases.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike in C, there is no waterfall in a \$tt "switch"\$ statement.
Switching is exaustive, but an \$tt "else"\$ branch is allowed.
A \$tt "then"\$ delimeter is optional akin to such in an <a href="#_if">if</a> statement.</p>
</div>
<div class="listingblock">
<div class="title">Switching on an integer</div>
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let x = rand(1, 2, 3, 4, 5) : Int32

# Different syntaxes to showcase.
switch (x) {
  case 1        foo()
  case [2] then bar()
  case 3, 4
    baz()
  else {
    qux()
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Switching on a enum</div>
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">enum Foo {
  Bar,
  Baz
}

switch (rand&lt;Foo&gt;()) {
  case :bar
    print("Is Bar")
  case [Foo::Baz]
    print("Is Baz")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When switching on a class or variant instance, the switched value stays intact.
A compiler does not narrow the instance type due to possible access complexities.
Within a branch body, the switched instance should be cast manually; a compiler may optimize the cast, though.</p>
</div>
<div class="listingblock">
<div class="title">Switching on a class instance</div>
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">let animal : Animal = Dog()

switch (animal) {
  case Dog {
    @inspect(animal)          # =&gt; Animal (intact)
    # animal~Dog.bark()       # =&gt; Panic! Narrowing virtualization is illegal
    @cast&lt;Dog&gt;(animal).bark() # Manual cast, won't throw (may even be optimized out)
    animal = Cat()            # Legal
  }
  case Dog, Cat {
    if (let dog = @cast?&lt;Dog&gt;(animal)) {
      dog.bark()
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Switching on a variant instance</div>
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">switch (let v = rand(42, "foo")) {
  case Int32 {
    @inspect(v)             # =&gt; Variant&lt;Int32, String&gt;
    v = @get&lt;Int32&gt;(v) + 27 # OK, assigning `Int32` is autocast
  }
  case String
    v = @get&lt;String&gt;(v) + "bar"
  # case 42    # =&gt; Panic! Can only switch on a variant type, not its value
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_function"><a class="link" href="#_function">10. Function</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Onyx, a <em>function</em> may be <em>declared</em> with a \$tt "decl function"\$ statement.
A previously declared function may be then <em>implemented</em> using an \$tt "impl function"\$ statement.
A function declaration or call always requires parentheses, which allows to omit the \$tt "function"\$ keyword.
It is illegal to implement an underclared yet function.</p>
</div>
<div class="paragraph">
<p>A function name shall match the following regex: <code>/_?[a-zA-Z][a-zA-Z0-9_#]+/</code> (see <a href="#_function_tagging">Section 10.5, &#8220;Function tagging&#8221;</a>).
Otherwise a Unicode function name may be wrapped in backticks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"># A declaration contains no body.
decl foo()

# impl bar() { } # =&gt; Panic! Undeclared `bar`

impl foo() {
  return 42
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both declaration and implementation may be <em>defined</em> simultaneously with a \$tt "def function"\$ statement.
Once again, the \$tt "function"\$ keyword is optional.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo() {
  return 42
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <em>inline function</em> may be implemented.
Instead of a block body, an inline function expects a single expression body, delimeted with <code>-&gt;</code>.
Also, function body latest expression value is deemed its return value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo() -&gt; 42</code></pre>
</div>
</div>
<div class="paragraph">
<p>A block body may also be delimeted with <code>-&gt;</code>.
In fact, a function prototype should be read as <code>(\$A\$) &#8594; \$R\$</code>, where \$A\$ is the function&#8217;s arguments, and \$R\$ is its return type.
Strictly speaking, a function body is a block or single expression following the function prototype.</p>
</div>
<div class="sect2">
<h3 id="_function_prototype"><a class="link" href="#_function_prototype">10.1. Function prototype</a></h3>
<div class="paragraph">
<p>A function may declare zero or more arguments, which defines its <em>arity</em>.</p>
</div>
<div class="paragraph">
<p>An argument declaration is really a <a href="#_variable">variable</a> declaration with multi-assignment, splatting etc. implicitly declared with \$tt "let"\$.
All arguments therefore are required to have their type concrete and known in advance, or inferred.
An argument may be declared \$tt "final"\$, which would prohibit its rewriting within the function body.</p>
</div>
<div class="paragraph">
<p>An argument may have a default value.
Such an argument can be omitted in a call, which would assign an evaluated default expression result to the argument.
Another call evaluates the default expression once again and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def bind(server : Server, port : UInt16, host: String = "localhost") {
  print("Listening at #{ options.host }:#{ options.port }...")
}

bind(server, 6969) # -&gt; Listening at localhost:6969...</code></pre>
</div>
</div>
<div class="paragraph">
<p>An argument type may be a <a href="#_record">record</a> type.
A record type allows default values to be set for its fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def bind(server : Server, options : { host: String = "localhost", port : UInt16 }) {
  print("Listening at #{ options.host }:#{ options.port }...")
}

bind(server, { port: 6969 }) # -&gt; Listening at localhost:6969...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A record argument may also have a default value by itself.
The actual type may be inferred.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def bind(server : Server, options = { host: "localhost", port: 8000 }) {
  @debug&lt;@typeof(options)&gt;() # =&gt; { host : String = "localhost", port : Int32 = 8000 }
  print("Listening at #{ options.host }:#{ options.port }...")
}

bind(server)                 # -&gt; Listening at localhost:8000...
bind(server, { port: 6969 }) # -&gt; Listening at localhost:6969...</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function always has its <em>return type</em> known in advance, either explicitly set or inferred.
A return type is delimeted with <code>-&gt;</code>.
A function block body shall follow the return type; otherwise the return type would be deemed the function body.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def sum(a, b : Int32) -&gt; Int32 {
  return a + b
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function may be <em>overloaded</em>, i.e. declared for another set of arguments.
In fact, overloading by an argument name is illegal; you may only overload it by its type.
Differences in default values presence also counts as an overload.
A function may also be overloaded with <a href="#_function_storage">storage</a> and <a href="#_function_safety">safety</a> modifiers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def sum(a, b : Float64) -&gt; Float64 {
  return a + b
}

# This is an overload.
def sum(a, b : Int32) -&gt; Int32 {
  return a + b
}

# The function was declared implicitly fragile in the code above.
# This is a safety modifier overload.
threadsafe def sum(a, b : Int32) -&gt; Int32 {
  return a + b
}

# Storage overload would only work within a type declaration, not in the top level.
# static def sum(a, b : Int32) -&gt; Int32 # =&gt; Panic! A top level function can not
                                        # =&gt; have a `static` modifer.</code></pre>
</div>
</div>
<div class="paragraph">
<p>A function may be declared <em>generic</em> by declaring an argument or return value of a <a href="#_template">template</a> type in the function prototype.
A generic function specializes once for each unique combination of its template arguments.
Delayed <a href="#_macros">macros</a> are evaluated during specialization, and template types are concretized.
If an matching implementation already exists, it can be re-implemented using a \$tt "reimpl"\$ statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">decl sum&lt;T ~ Numeric&gt;(a, b : T) -&gt; T # OK, declarations may repeat

# forall T ~ Float impl sum&lt;T&gt;(a, b : T) -&gt; T # =&gt; Panic! Already implemented `sum&lt;Float64&gt;`
forall T ~ Float reimpl sum&lt;T&gt;(a, b : T) -&gt; T { # OK
  \{% print "Specialized #{ `T` }" %}
  return a + b
}

sum(1, 2)          # No input, because `sum&lt;Int32&gt;` is implemented earlier
sum(1.0, 2.0)      # =&gt; Specialized `sum&lt;Float64&gt;`
sum&lt;Float64&gt;(1, 2) # Would not specialize `sum&lt;Float64&gt;` again</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_unsplatting"><a class="link" href="#_unsplatting">10.1.1. Unsplatting</a></h4>
<div class="paragraph">
<p>An argument may be <em>unsplatted</em> by prefixing its name with <code>*</code> during the declaration.
The argument would become a single tuple with each element matching the restriction (if any).
Also see <a href="#_splatting">Section 8.2.1.1, &#8220;Splatting&#8221;</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">def foo&lt;T&gt;(*arg : T) -&gt; @inspect&lt;@typeof(arg)&gt;()
foo&lt;A&gt;(a)    # =&gt; A
foo&lt;A&gt;(a, a) # =&gt; (A, A)

def bar&lt;*T&gt;(arg : T) -&gt; @inspect&lt;@typeof(arg)&gt;()
bar&lt;A&gt;(a)            # =&gt; A
# bar&lt;A, B&gt;(a, b)    # Panic!
bar&lt;A, B&gt;((a, b))    # =&gt; (A, B)

def baz&lt;*T&gt;(*arg : T) -&gt; @inspect&lt;@typeof(arg)&gt;()
baz&lt;A&gt;(a)                 # =&gt; A
baz&lt;A&gt;(a, a)              # =&gt; (A, A)
baz&lt;A, B&gt;((a, b))         # =&gt; (A, B)
baz&lt;A, B&gt;((a, b), (a, b)) # =&gt; ((A, B), (A, B))

# Would expand to `arg : A, B`, which doesn't make sense.
# def qux&lt;*T&gt;(arg : *T); # Panic!
# TODO: qux&lt;Int32, String&gt;(42, "Foo")</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_function_modifier"><a class="link" href="#_function_modifier">10.2. Function modifier</a></h3>
<div class="paragraph">
<p>A function may be declared with a <em>modifier</em>.
When any function modifier is present, a function is implicitly defined, which allows to omit the \$tt "def"\$ keyword, e.g. <code>static self() -&gt; self({ })</code>.</p>
</div>
<div class="sect3">
<h4 id="_function_storage"><a class="link" href="#_function_storage">10.2.1. Function storage</a></h4>
<div class="paragraph">
<p>A function <a href="#_storage">storage</a> default depends on the declaration scope.
A top-level function implicitly has static storage.
Any other function declaration would have an instance storage, i.e. be a <em>method</em> (with an exception for a method declared within a <a href="#_unit">unit</a> type: it&#8217;d have some interim storage, practically static).
To declare an explicitly static function, a \$tt "static"\$ modifier should be used.
A function may be overloaded by storage.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class Foo {
  # An explicitly static function.
  static def bar() -&gt; 42

  # An implicitly instance function, i.e. method.
  def bar() -&gt; 43
}

final foo = Foo()
assert(foo::bar() != foo.bar())</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_function_safety"><a class="link" href="#_function_safety">10.2.2. Function safety</a></h4>
<div class="paragraph">
<p>TODO: Can overload by safety, fragile by default.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_visibility"><a class="link" href="#_function_visibility">10.2.3. Function visibility</a></h4>
<div class="paragraph">
<p>By default, a declared function is publicly accessible.
To declare a function which is only accessible within the declaration scope (e.g. a type implementation), use an explicit \$tt "private"\$ visibitility modifier.
A function shall not be overloaded by visibitility; the only exception is the private <code>self</code> constructor implicitly defined for a class.
A private function can not be accessed by any means; the only workaround would be to declare a public proxy function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class Foo {
  private def bar() -&gt; 42
}

final foo = Foo()

# foo.bar() # Panic! `Foo.bar` is private

# Define a proxy method.
def Foo.get_bar() -&gt; bar()

assert(foo.get_bar() == 42) # OK</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_method"><a class="link" href="#_method">10.3. Method</a></h3>
<div class="paragraph">
<p>A <em>method</em> is a function member with instance storage.</p>
</div>
<div class="paragraph">
<p>A method invocation implicitly passes the caller object of type \$tau\$ as the very first argument implicitly declared as <code>\$tt "final"\$ \$tt "this"\$ : \$tau\$</code>.
A struct method therefore can not modify the caller, a struct method call safety depends on the caller&#8217;s safety.
A class method still allows to mutate \$tt "this"\$, but you can not overwrite it completely.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Point {
  let x, y : Float64

  def length() {
    # this.x = 42 # =&gt; Panic! Can not mutate `this` in a struct method
    return (this.x ** 2 + this.y ** 2).sqrt()
  }
}

class Balance {
  let value : Float64
  def reset() -&gt; this.value = 0 # OK
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get a method, an instance shall be queried with <code>.</code>.
Alternatively, a type may be queried with <code>:</code> for a <a href="https://en.wikipedia.org/wiki/Uniform_Function_Call_Syntax">UFCS</a> variant accepting \$tt "this"\$ argument explicitly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Foo {
  static let bar = 42
  def baz() -&gt; return self::bar
}

let foo = Foo()

assert(foo.baz() == Foo:baz(foo))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Concretizing a method returns a <a href="#_lambda">lambda</a> instance with \$tt "this"\$ being implicitly captured.
The UFCS variant returns a <code>Function</code> instance instead.
See <a href="#_function_object">Section 10.7, &#8220;Function object&#8221;</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">final lambda = foo.baz : Lambda&lt;fragile [{ this: = foo }]() ~&gt; Int32&gt;

# The UFCS variant accepts an object instance explicitly.
final func = Foo:baz : Function&lt;fragile (Foo) -&gt; Int32&gt;

assert(lambda() == func(foo))</code></pre>
</div>
</div>
<div class="paragraph">
<p>A <a href="#_trait">trait</a> method implementation context is not the trait, but a deriving type.
Therefore, \$tt "this"\$ within a trait method evaluates to the deriving type object.
Ditto for \$tt "self"\$.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operator"><a class="link" href="#_operator">10.4. Operator</a></h3>
<div class="paragraph">
<p>An <em>operator</em> is a function declaration with identifier containing mathematical symbols.</p>
</div>
<div class="sect3">
<h4 id="_unary_operator"><a class="link" href="#_unary_operator">10.4.1. Unary operator</a></h4>
<div class="paragraph">
<p>An unary operator function identifier consists of a single symbol, one of <code>~!^-</code>, and it doesn&#8217;t accept any arguments.
An unary operator call may be shortcut as <code>\$@\$\$a\$</code> \$-=\$ <code>\$a\$.\$@\$()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Int {
  decl -()
}

-42 == 42.-()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_binary_operator"><a class="link" href="#_binary_operator">10.4.2. Binary operator</a></h4>
<div class="paragraph">
<p>A binary operator is a function with zero arity and identifier consisting of any sequence of symbols from <code>~!%^&amp;*-+=</code>.</p>
</div>
<div class="paragraph">
<p>A binary operator call may be shortcut as <code>\$a\$ \$@\$ \$b\$</code> \$-=\$ <code>\$a\$.\$@\$(\$b\$)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">struct Int {
  decl +(another : self)
}

1 + 2 == 1.+(2)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A binary operator with identifier ending in <code>=</code> is illegal, with exceptions for <code>&lt;=</code>, <code>&gt;=</code>, <code>==</code> and <code>~=</code>.</p>
</div>
<div class="paragraph">
<p><code>a != b</code> automatically expands to <code>!(a == b)</code>.
<code>===</code> is the builtin equivalence operator with <code>!==</code> counterpart.</p>
</div>
<div class="paragraph">
<p>It is possible to pass multiple arguments to a binary operator while preserving the sugar via <a href="#_splatting">splatting</a>.
For example, <code>(0.1 + 0.2) ~= *(0.3, delta: 0.1)</code> \$-=\$ <code>(0.1 + 0.2).~=(0.3, delta: 0.1)</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ternary_operator"><a class="link" href="#_ternary_operator">10.4.3. Ternary operator</a></h4>
<div class="paragraph">
<p>The only ternary operators are the <a href="https://en.wikipedia.org/wiki/%3F:">ternary if operator</a> (<code>\$cond\$ ? \$a\$ : \$b\$</code>), which can not be overriden; and <a href="#_index_setter">index setters</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_function_tagging"><a class="link" href="#_function_tagging">10.5. Function tagging</a></h3>
<div class="paragraph">
<p>A function name may also contain one or more <code>#</code>-separated <em>tags</em>.
The order of tags doesn&#8217;t matter.
A Unicode-named function isn&#8217;t considered tagged even in the presence of a <code>#</code> character.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def foo() -&gt; {
  print(42)
}

def foo#prefixed() -&gt; {
  print("Prefix")
  foo()
}

def foo#suffixed() -&gt; {
  foo()
  print("Suffix")
}

def foo#prefixed#suffixed() -&gt; {
  foo#prefixed()
  print("Suffix")
}

foo#suffixed#prefixed() # -&gt; Prefix␤42␤Suffix

# This function isn't tagged.
def `Функция#tag` -&gt; { }</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generator"><a class="link" href="#_generator">10.6. Generator</a></h3>
<div class="paragraph">
<p>A function may also accept a <em>generator</em> argument, which defines a block of code to generate upon every invocation.
The generated code is injected on the caller site, which allows to safely reference outer-scope identifiers.</p>
</div>
<div class="paragraph">
<p>A single-argument-yielding generator invocation allows to omit parentheses upon the yield.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class List&lt;T&gt; {
  # A function accepting a generator argument called *yield*.
  # The generator yields a single value of type *T*,
  # the generated block return value is discarded.
  # The function itself returns void.
  def each(yield : (T) =&gt; discard) : void -&gt; {
    (0..this.size).each(i =&gt; yield(this[i]))
  }
}

final console = GetConsole()

# list.each((e : T) =&gt; discard { console.print(e) }) # Too long
list.each(e =&gt; console.print(e))                     # That's better

# Generates code similar to this, with visibility taken care of:
(0..list.size).each(i =&gt; console.print(list[i]))</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_function_object"><a class="link" href="#_function_object">10.7. Function object</a></h3>
<div class="paragraph">
<p>When querying a function specialization, a <code>Function</code> object is returned.
A function object has undefined memory layout, but it certainly can be used in runtime, passed by value and having program-wide lifespan.
A function object may be called at some later point of time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def sum(a, b : Int32) -&gt; return a + b
final sum_obj = sum : Function&lt;fragile (a : Int32, b : Int32) -&gt; Int32&gt;
assert(sum_obj(1, 2) == 3)</code></pre>
</div>
</div>
<div class="paragraph">
<p>ALternatively, a function object may be defined in-place.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let sum = (a, b : Int32) -&gt; a + b
sum(1, 2)
assert(sum(1, 2) == 3)</code></pre>
</div>
</div>
<div class="paragraph">
<p>A single-argument in-place function declaration may have argument parentheses omitted.
This also applies to a <a href="#_generator">generator</a> invocation and <a href="#_lambda">lambda</a> declaration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">let func = x -&gt; x * 2
generator(x =&gt; x * 2)       # Can not assign a generator, only pass it
let lambda = x ~&gt; x * 2     # OK if doesn't have closure
# let lambda = []x ~&gt; x * 2 # What?</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_out_of_scope_declaration"><a class="link" href="#_out_of_scope_declaration">10.8. Out-of-scope declaration</a></h3>
<div class="paragraph">
<p>A function may be declared out of the type implementation scope.
An <em>actor</em> (i.e. the type the function is declared for) may be a type expression, which would only apply the statement if the caller matches the expression.</p>
</div>
<div class="exampleblock">
<div class="title">Example 16. Out-of-scope declaration</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class List&lt;T&gt; : Enumerable&lt;T&gt;, Indexable&lt;Key: USize, Value: T&gt; {
  impl ~Enumerable.each(yield) -&gt; {
    (0..this.size).each(i =&gt; yield(this[i]))
  }
}

# When a type matches both `Enumerable&lt;V&gt;` and `Indexable&lt;K, V&gt;`,
# declare a new method `each#indexed` for it.
forall K, V decl (
  Enumerable&lt;V&gt; &amp;&amp; Indexable&lt;K, V&gt;
).each#indexed(yield : (K, V) =&gt; discard) -&gt; void

# Implement the freshly declared method for a `List` instance.
forall T impl List.each#indexed(yield) -&gt; {
  (0..this.size).each(i =&gt; yield(this[i], i))
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exception_handling"><a class="link" href="#_exception_handling">11. Exception handling</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>An Onyx program may \$tt "throw"\$ an <em>exception</em> in runtime.</p>
</div>
<div class="paragraph">
<p>A potentially throwing region of code may be wrapped in a \$tt "try"\$ statement, which may contain zero or more \$tt "catch"\$ clauses.
A \$tt "catch"\$ clause accepts a <a href="#_generator">generator</a> block with a single argument, which is the caught exception instance.</p>
</div>
<div class="exampleblock">
<div class="title">Example 17. Basic exception handling</div>
<div class="content">
<div class="listingblock">
<div class="title">main.nx</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">try {
  throw Exception("Boom!")
} catch ((e) =&gt; {
  print("Caught exception: #{ e.message }")
})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ fnx main.nx
Caught exception: Boom!
$ echo($?)
0</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A \$tt "catch"\$ clause may be overloaded to be triggered on a matching exception type.
To make an object throwable, it must be or inherit the builtin <code>Exception</code> class.
A <code>String</code> instance may also be thrown; in that case, the string is implicitly passed as the <code>message</code> argument, i.e. <code>throw "Message"</code> \$-=\$ <code>throw Exception("Message")</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 18. Custom exception class</div>
<div class="content">
<div class="listingblock">
<div class="title">main.nx</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">class Boom : Exception {
  static self() -&gt; self({ Exception("Boom!") })
}

try {
  throw Boom()
}

# Would match anything other than `: Boom`.
catch (e =&gt; {
  print("Uncaught exception: #{ @typeof(e) }")
})

# Would match `: Boom` only.
catch ((e : Boom) =&gt; {
  print("Explosion averted")
})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ fnx main.nx
Explosion averted
$ echo($?)
0</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>An Onyx program contains the implicit default last-resort handler which would pretty-print an unhandled exception and gracefully exit the program.
A compiler preserves macro data to ease debugging.</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Rescuing unhandled exception</div>
<div class="content">
<div class="listingblock">
<div class="title">main.nx</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">{{
  %Q[def foo() -&gt; {\nthrow "Oops"\n}]
}}

foo()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ fnx main.nx
Exception! Oops

@ &lt;macro&gt;:2:3

  1. | def foo() -&gt; {
  2. |   throw "Oops"
         ^
  3. | }

  % /main.nx:1:1

    1. | {{
         ^
    2. |   %Q[def foo() -&gt; {\nthrow "Oops"\n}]

@ /main.nx:5:1

  4. |
  5. | foo()
       ^

$ echo($?)
1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_macros"><a class="link" href="#_macros">12. Macros</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Onyx, a <em>macro</em> is code evaluated during program compilation.
Currently, macros are written in embedded Ruby.</p>
</div>
<div class="paragraph">
<p>There are two categories of macros:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Emitting and non-emitting;</p>
</li>
<li>
<p>Immediate and postponed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An emitting macro emits its result into source code, it&#8217;s wrapped in <code>{{ }}</code>.
A non-emitting macro doesn&#8217;t, it is wrapped in <code>{% %}</code>.
An immediate macro is evaluated as soon as it&#8217;s encountered in source code.
A postponed macro is evaluated at some later point of compilation, usually a specialization; it looks like it&#8217;s escaped, e.g. <code>\{% %}</code>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. Basic macros</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">{% %w[hello world].each do |s| %} # A non-emitting immediate macro
  print({{ s.stringify }})        # An emitting immediate macro
{% end %}                         # A non-emitting immediate macro again</code></pre>
</div>
</div>
<div class="paragraph">
<p>After macro evaluation the code would look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx"> # A non-emitting macro
  print("hello")        # An emitting macro
  print("world")        # An emitting macro
                         # A non-emitting immediate macro again</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Macros include API to access and manipulate the AST and the process of compilation.
By default, the macros context is isolated, and there is limited access to the system.
A compiler may provide a way to enable grained permissions, e.g. network access to a certain domain.
See <a href="#_macros_api">Appendix B, <em>Macros API</em></a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Pinging from a macro</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx">print("example.com is " + {%
  if Net::Ping::External.new("example.com").ping?
    print("Ping success")     # Print during compilation
    nx.emit(%Q["reacheable"]) # Emits source code
  else
    print("Ping failure")
    nx.emit(%Q["unreacheable"])
  end
%})</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ fnx main.nx -m.net=example.com
Ping success
$ ./main
example.com is reacheable</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interoperability"><a class="link" href="#_interoperability">13. Interoperability</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Onyx features easy two-way interoperation with C code.</p>
</div>
<div class="sect2">
<h3 id="_calling_c_code_from_onyx"><a class="link" href="#_calling_c_code_from_onyx">13.1. Calling C code from Onyx</a></h3>
<div class="paragraph">
<p>A C code may be embedded into an Onyx source file using the <code>extern</code> directive.
A <em>single</em> C expression or an entire block of C code shall follow the keyword.</p>
</div>
<div class="paragraph">
<p>The C code would be parsed, resulting in C declarations accessible from within the containing Onyx source file.
See <a href="#_c_scope">Section 3.3, &#8220;C scope&#8221;</a>.</p>
</div>
<div id="_example_calling_c_code_from_onyx" class="exampleblock">
<div class="title">Example 22. Calling C code from Onyx</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">extern #include "stdio.h"
final message = "Hello, world!"
unsafe! $puts(message.pointer as char*)</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Fancy Onyx compiler implicitly links <code>libc</code> and <code>libm</code>, and also automatically looks up for the standard C header directories.
<a href="#_example_calling_c_code_from_onyx">Example 22, &#8220;Calling C code from Onyx&#8221;</a> would therefore have been compiled simply with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ fnx main.nx
$ ./main
Hello, world!</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example above doesn&#8217;t require to include the whole header file, however.
An explicit C function declaration would be enough.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">extern void puts(char*);
final message = "Hello, world!"
unsafe! $puts(message.pointer as char*)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calling_onyx_code_from_c"><a class="link" href="#_calling_onyx_code_from_c">13.2. Calling Onyx code from C</a></h3>
<div class="paragraph">
<p>It is possible to call Onyx code from C by doing the exact same thing: prepending <code>$</code> to Onyx entities, also wrapped in backticks if needed.
The entities are implicitly mangled to make the interop work seamlessly.
Even type inferring works as expected.</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. Calling Onyx code from C</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">def sum&lt;T&gt;(a, b : T) -&gt; a + b

extern {
  #include "stdio.h"

  void main() {
    printf("1 + 2 = \d\n", $sum(1, 2));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Would compile to machine code similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-llir" data-lang="llir">declare void @printf(i8*, ...)

; The actual function name would be mangled.
define i32 @"__nx::sum&lt;$int&gt;(a:$int,b:$int):$int"(i32 %0, i32 %1) {
  ; Here goes the generated Onyx code.
}

define void main() {
  %0 = call i32 @"__nx::sum&lt;$int&gt;(a:$int,b:$int):$int"(1, 2)
  call @printf("1 + 2 = \d\n", %0)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_exporting_a_c_library"><a class="link" href="#_exporting_a_c_library">13.3. Exporting a C library</a></h3>
<div class="paragraph">
<p>The Standard declares that an Onyx compiler shall be able to compile a freestanding C library containing all the code from the <code>extern</code> directives contained in Onyx source files referenced by the input file.
A amalgamation header file may also be compiled in a similar fashion.
It would replace function definitions in <code>extern</code> directives with declarations.</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. Exporting a C library</div>
<div class="content">
<div class="listingblock">
<div class="title">main.nx</div>
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">extern {
  #include "stdio.h"

  // This function is implemented in Onyx.
  void print_sum(int a, int b) {
    printf("\d + \d = \d\n", a, b, $sum(a, b));
  }
}

# The Onyx implementation.
def sum(a, b : $int) -&gt; a + b</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh"># Compile the library file
$ fnx lib ./main.nx -o./onyx.a

# Compile the header file
$ fnx header ./main.nx -o./onyx.h</code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates two files: library <code>onyx.a</code> and header <code>onyx.h</code>.
They may be then used in a pure C environment.</p>
</div>
<div class="listingblock">
<div class="title">onyx.h</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include "stdio.h"

// This function is implemented in Onyx.
void print_sum(int a, int b);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">main.c</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include "./onyx.h"

int main() {
  print_sum(1, 2);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">$ cc onyx.a main.c -o./main
$ ./main
$ 1 + 2 = 3</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_intrinsics"><a class="link" href="#_intrinsics">Appendix A: Intrinsics</a></h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-nx" data-lang="nx">builtin threadsafe @fence&lt;
  SyncScope ~ \String = undefined
&gt;()

builtin fragile @fence&lt;
  Ordering : \MemoryOrdering = :seqcst,
  SyncScope ~ \String = undefined
&gt;()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_macros_api"><a class="link" href="#_macros_api">Appendix B: Macros API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section will contain the <a href="#_macros">macros</a> API.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_standard_library"><a class="link" href="#_standard_library">Appendix C: Standard library</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The language Standard defines the <em>standard library</em>: a collection of types and functions for <strong>cross-platform</strong> functionality required for a conforming compiler implementation.
For brewity, the standard library is often referenced to as <em>stdlib</em>.
An stdlib entity must be imported from <code>"std"</code>.</p>
</div>
<div class="paragraph">
<p>The appendix contains the cross-platform <a href="#_standard_library">standard library</a> API.
It is WIP and is soon to be a part of the Standard rather than the Reference.</p>
</div>
<div class="sect2">
<h3 id="_containers"><a class="link" href="#_containers">C.1. Containers</a></h3>
<div class="paragraph">
<p>List, Stack, Queue, Deque, Map, Set</p>
</div>
</div>
<div class="sect2">
<h3 id="_hashing"><a class="link" href="#_hashing">C.2. Hashing</a></h3>
<div class="paragraph">
<p>XXH, SHA, MD</p>
</div>
</div>
<div class="sect2">
<h3 id="_regex"><a class="link" href="#_regex">C.3. Regex</a></h3>

</div>
<div class="sect2">
<h3 id="_streams"><a class="link" href="#_streams">C.4. Streams</a></h3>

</div>
<div class="sect2">
<h3 id="_serialization"><a class="link" href="#_serialization">C.5. Serialization</a></h3>

</div>
<div class="sect2">
<h3 id="_target_specific_libraries"><a class="link" href="#_target_specific_libraries">C.6. Target-specific libraries</a></h3>
<div class="paragraph">
<p>If a compiler claims to be able to target a specific platform, it then shall implement target-specific APIs accessible under a <code>"target/*"</code> meta path, e.g. <code>"target/win32"</code>.</p>
</div>
<div class="sect3">
<h4 id="_isa"><a class="link" href="#_isa">C.6.1. ISA</a></h4>
<div class="paragraph">
<p>A conforming compiler implementation targeting certain Instruction Set Architectures must implement ISA-specific set of standardized APIs at <code>"std/isa/*"</code>, e.g. <code>"std/x86"</code> if it supports X86 processors.</p>
</div>
<div class="sect4">
<h5 id="_x86"><a class="link" href="#_x86">X86</a></h5>
<div class="paragraph">
<p>x86-specific APIs are located in <code>"std/isa/x86"</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_os"><a class="link" href="#_os">C.6.2. OS</a></h4>
<div class="paragraph">
<p>A conforming compiler implementation targeting certain operating systems must implement OS-specific set of standardized APIs at <code>"std/os/*"</code>, e.g. <code>"std/win32"</code> if it supports Windows programs.</p>
</div>
<div class="sect4">
<h5 id="_posix"><a class="link" href="#_posix">POSIX</a></h5>
<div class="paragraph">
<p>POSIX-specific APIs are located in <code>"std/os/posix"</code>.</p>
</div>
<div class="paragraph">
<p>To avoid bloat, a POSIX-compilant OS API doesn&#8217;t expose POSIX functionality, but only a distinct set of features for that OS.
For example, <code>"std/os/linux"</code> won&#8217;t expose <code>Signal</code>, as it&#8217;s already located in <code>"std/os/posix"</code> when targeting Linux.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-onyx" data-lang="onyx"># import { Signal } from "std/os/linux" # =&gt; Panic!
import { Signal } from "std/os/posix"   # OK, POSIX functionality implemented for this target
import { IOUring } from "std/os/linux"  # OK, Linux-specific functionality</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_linux"><a class="link" href="#_linux">Linux</a></h5>
<div class="paragraph">
<p>Linux-specific APIs are located in <code>"std/os/linux"</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>"std/os/linux"</code> doesn&#8217;t expose POSIX APIs.
See <a href="#_posix">Section C.6.2.1, &#8220;POSIX&#8221;</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_windows"><a class="link" href="#_windows">Windows</a></h5>
<div class="paragraph">
<p>Win32-specific APIs are located in <code>"std/os/win32"</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-12-30 17:32:22 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    skipTags: ["script", "noscript", "style", "textarea"],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>